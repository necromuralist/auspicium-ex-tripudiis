<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Some introductory pandas stuff.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pandas Basics | Notes on Kaggle</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Kaggle-Competitions/posts/pandas-basics/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script><meta name="author" content="Cloistered Monkey">
<link rel="prev" href="../will-a-gbdt-performance-drop-if-we-remove-the-first-tree/" title="Will a GBDT's performance drop if we remove the first tree?" type="text/html">
<meta property="og:site_name" content="Notes on Kaggle">
<meta property="og:title" content="Pandas Basics">
<meta property="og:url" content="https://necromuralist.github.io/Kaggle-Competitions/posts/pandas-basics/">
<meta property="og:description" content="Some introductory pandas stuff.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-08-05T12:56:23-07:00">
<meta property="article:tag" content="pandas basics">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/Kaggle-Competitions/">

                <span id="blog-title">Notes on Kaggle</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="https://necromuralist.github.io/">The Cloistered Monkey</a>
                </li>
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/Kaggle-Competitions/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.org" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Pandas Basics</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2018-08-05T12:56:23-07:00" itemprop="datePublished" title="2018-08-05 12:56">2018-08-05 12:56</time></a></p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="outline-container-orgf11083d" class="outline-2">
<h2 id="orgf11083d">Description</h2>
<div class="outline-text-2" id="text-orgf11083d">
<p>
This is a chance to refresh your <b>pandas</b> knowledge. You will need to do several <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.groupby.html"><code>groupby</code></a>s and <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.join.html"><code>join</code></a>`s to solve the task. 
</p>
</div>
</div>

<div id="outline-container-org84f94be" class="outline-2">
<h2 id="org84f94be">Imports</h2>
<div class="outline-text-2" id="text-org84f94be">
<p>
This first block is necessary for the code.
</p>
<div class="highlight"><pre><span></span># pandas standard library
import os
import re

# from pypi
import pandas
import numpy
import matplotlib.pyplot as plt

from tabulate import tabulate
</pre></div>

<div class="highlight"><pre><span></span>get_ipython().run_line_magic('matplotlib', 'inline')
</pre></div>

<p>
This next block is only relevant on Coursera's server.
</p>
<div class="highlight"><pre><span></span>from grader import Grader
</pre></div>
</div>
</div>

<div id="outline-container-org8746356" class="outline-2">
<h2 id="org8746356">The Data</h2>
<div class="outline-text-2" id="text-org8746356">
<div class="highlight"><pre><span></span>DATA_FOLDER = '../readonly/final_project_data/'
</pre></div>

<div class="highlight"><pre><span></span>transactions    = pandas.read_csv(os.path.join(DATA_FOLDER,
					       'sales_train.csv.gz'))
items           = pandas.read_csv(os.path.join(DATA_FOLDER,
					       'items.csv'))
item_categories = pandas.read_csv(os.path.join(DATA_FOLDER,
					       'item_categories.csv'))
shops           = pandas.read_csv(os.path.join(DATA_FOLDER,
					       'shops.csv'))
</pre></div>

<div class="highlight"><pre><span></span>frames = dict(transactions=transactions,
	      items=items,
	      item_categories=item_categories,
	      shops=shops)
</pre></div>
</div>
</div>

<div id="outline-container-org5a81419" class="outline-2">
<h2 id="org5a81419">Data Description</h2>
<div class="outline-text-2" id="text-org5a81419">
<p>
The dataset we loaded is taken from a kaggle competititon. You can find complete data description at the <a href="https://www.kaggle.com/c/competitive-data-science-final-project/data">competition web page</a>. To join the competition use <a href="https://www.kaggle.com/t/1ea93815dca248e99221df42ebde3540">this link</a>.
</p>

<blockquote>
<p>
You are provided with daily historical sales data. The task is to forecast the total amount of products sold in every shop for the test set. Note that the list of shops and products slightly changes every month. Creating a robust model that can handle such situations is part of the challenge.
</p>
</blockquote>
</div>

<div id="outline-container-orgc9854f1" class="outline-3">
<h3 id="orgc9854f1">File descriptions</h3>
<div class="outline-text-3" id="text-orgc9854f1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">File Name</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">sales_train.csv</td>
<td class="org-left">the training set. Daily historical data from January 2013 to October 2015.</td>
</tr>
<tr>
<td class="org-left">test.csv</td>
<td class="org-left">the test set. You need to forecast the sales for these shops and products for November 2015.</td>
</tr>
<tr>
<td class="org-left">sample_submission.csv</td>
<td class="org-left">a sample submission file in the correct format.</td>
</tr>
<tr>
<td class="org-left">items.csv</td>
<td class="org-left">supplemental information about the items/products.</td>
</tr>
<tr>
<td class="org-left">item_categories.csv</td>
<td class="org-left">supplemental information about the items categories.</td>
</tr>
<tr>
<td class="org-left">shops.csv</td>
<td class="org-left">supplemental information about the shops.</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgcc40546" class="outline-3">
<h3 id="orgcc40546">Data Fields</h3>
<div class="outline-text-3" id="text-orgcc40546">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Column</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">ID</td>
<td class="org-left">an Id that represents a (Shop, Item) tuple within the test set</td>
</tr>
<tr>
<td class="org-left">shop_id</td>
<td class="org-left">unique identifier of a shop</td>
</tr>
<tr>
<td class="org-left">item_id</td>
<td class="org-left">unique identifier of a product</td>
</tr>
<tr>
<td class="org-left">item_category_id</td>
<td class="org-left">unique identifier of item category</td>
</tr>
<tr>
<td class="org-left">item_cnt_day</td>
<td class="org-left">number of products sold. You are predicting a monthly amount of this measure</td>
</tr>
<tr>
<td class="org-left">item_price</td>
<td class="org-left">current price of an item</td>
</tr>
<tr>
<td class="org-left">date</td>
<td class="org-left">date in format dd/mm/yyyy</td>
</tr>
<tr>
<td class="org-left">date_block_num</td>
<td class="org-left">a consecutive month number, used for convenience. January 2013 is 0, February 2013 is 1,…, October 2015 is 33</td>
</tr>
<tr>
<td class="org-left">item_name</td>
<td class="org-left">name of item</td>
</tr>
<tr>
<td class="org-left">shop_name</td>
<td class="org-left">name of shop</td>
</tr>
<tr>
<td class="org-left">item_category_name</td>
<td class="org-left">name of item category</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


<div id="outline-container-orgf2be066" class="outline-2">
<h2 id="orgf2be066">The First Problem</h2>
<div class="outline-text-2" id="text-orgf2be066">
<p>
Let's start with a simple task. 
</p>


<p>
Print the shape of the loaded dataframes and use the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.head.html"><code>df.head</code></a> function to print several rows. Examine the features you are given.
</p>

<div class="highlight"><pre><span></span>print("| DataFrame | Rows| Columns|")
print("|-+-+-|")
for name, frame in frames.items():
    rows, columns = frame.shape
    print("|{}| {}|{}|".format(name, rows, columns))
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">DataFrame</th>
<th scope="col" class="org-right">Rows</th>
<th scope="col" class="org-right">Columns</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">transactions</td>
<td class="org-right">2935849</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">items</td>
<td class="org-right">22170</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">item_categories</td>
<td class="org-right">84</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">shops</td>
<td class="org-right">60</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span>for name, frame in frames.items():
    print("** {}".format(name))
    head = frame.head()
    print(tabulate(head, headers="keys", tablefmt="orgtbl", showindex=False))
</pre></div>
</div>
<div id="outline-container-org4cec204" class="outline-3">
<h3 id="org4cec204">transactions</h3>
<div class="outline-text-3" id="text-org4cec204">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org8f18b68" class="outline-3">
<h3 id="org8f18b68">items</h3>
<div class="outline-text-3" id="text-org8f18b68">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org8c30921" class="outline-3">
<h3 id="org8c30921">item_categories</h3>
<div class="outline-text-3" id="text-org8c30921">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_category_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">PC - Гарнитуры/Наушники</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PSP</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgaa56a37" class="outline-3">
<h3 id="orgaa56a37">shops</h3>
<div class="outline-text-3" id="text-orgaa56a37">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">shop_name</th>
<th scope="col" class="org-right">shop_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">!Якутск Орджоникидзе, 56 фран</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">!Якутск ТЦ "Центральный" фран</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Адыгея ТЦ "Мега"</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Балашиха ТРК "Октябрь-Киномир"</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Волжский ТЦ "Волга Молл"</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgc827108" class="outline-3">
<h3 id="orgc827108">transactions</h3>
<div class="outline-text-3" id="text-orgc827108">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org1d9cd0b" class="outline-3">
<h3 id="org1d9cd0b">items</h3>
<div class="outline-text-3" id="text-org1d9cd0b">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgcc4e2bc" class="outline-3">
<h3 id="orgcc4e2bc">item_categories</h3>
<div class="outline-text-3" id="text-orgcc4e2bc">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_category_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">PC - Гарнитуры/Наушники</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PSP</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orga8b9728" class="outline-3">
<h3 id="orga8b9728">shops</h3>
<div class="outline-text-3" id="text-orga8b9728">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">shop_name</th>
<th scope="col" class="org-right">shop_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">!Якутск Орджоникидзе, 56 фран</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">!Якутск ТЦ "Центральный" фран</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Адыгея ТЦ "Мега"</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Балашиха ТРК "Октябрь-Киномир"</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Волжский ТЦ "Волга Молл"</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org62ef115" class="outline-3">
<h3 id="org62ef115">transactions</h3>
<div class="outline-text-3" id="text-org62ef115">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orga63decd" class="outline-3">
<h3 id="orga63decd">items</h3>
<div class="outline-text-3" id="text-orga63decd">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org9b4e8bf" class="outline-3">
<h3 id="org9b4e8bf">item_categories</h3>
<div class="outline-text-3" id="text-org9b4e8bf">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_category_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">PC - Гарнитуры/Наушники</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PSP</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org0f5f693" class="outline-3">
<h3 id="org0f5f693">shops</h3>
<div class="outline-text-3" id="text-org0f5f693">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">shop_name</th>
<th scope="col" class="org-right">shop_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">!Якутск Орджоникидзе, 56 фран</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">!Якутск ТЦ "Центральный" фран</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Адыгея ТЦ "Мега"</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Балашиха ТРК "Октябрь-Киномир"</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Волжский ТЦ "Волга Молл"</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
Unexpectedly, the names are all in <a href="https://en.wikipedia.org/wiki/Cyrillic_script">cyrillic</a>, so I guess this will be a black-box in more ways than is usual
</p>
</div>
</div>
</div>

<div id="outline-container-orgaccaad4" class="outline-2">
<h2 id="orgaccaad4">Questions</h2>
<div class="outline-text-2" id="text-orgaccaad4">
</div>
<div id="outline-container-org168aad2" class="outline-3">
<h3 id="org168aad2">Question 1: <b>What was the maximum total revenue among all the shops in September, 2014?</b>
</h3>
<div class="outline-text-3" id="text-org168aad2">
<p>
From here on out <b>revenue</b> refers to total sales minus value of goods returned.
</p>

<ul class="org-ul">
<li>Sometimes items are returned, find such examples in the dataset.</li>
<li>It is handy to split `date` field into [`day`, `month`, `year`] components and use ` df.year <code>= 14` and `df.month =</code> 9` in order to select target subset of dates.</li>
<li>You may work with `date` feature as with srings, or you may first convert it to ` pd.datetime` type with `pd.to_datetime` function, but do not forget to set correct ` ormat` argument.</li>
</ul>
</div>

<div id="outline-container-org2c10ee5" class="outline-4">
<h4 id="org2c10ee5">Answer</h4>
<div class="outline-text-4" id="text-org2c10ee5">
</div>
<ul class="org-ul">
<li>
<a id="orgdc70bb5"></a>Sales Per Item<br><div class="outline-text-5" id="text-orgdc70bb5">
<p>
First I'll add a column with the total revenue for each item (the price times the number sold).
</p>

<div class="highlight"><pre><span></span>transactions["item_revenue"] = transactions.item_price * transactions.item_cnt_day
</pre></div>

<div class="highlight"><pre><span></span>print(transactions.describe())
</pre></div>

<p>
       date_block_num       shop_id       item_id    item_price  item_cnt_day  \
count    2.935849e+06  2.935849e+06  2.935849e+06  2.935849e+06  2.935849e+06   
mean     1.456991e+01  3.300173e+01  1.019723e+04  8.908532e+02  1.242641e+00   
std      9.422988e+00  1.622697e+01  6.324297e+03  1.729800e+03  2.618834e+00   
min      0.000000e+00  0.000000e+00  0.000000e+00 -1.000000e+00 -2.200000e+01   
25%      7.000000e+00  2.200000e+01  4.476000e+03  2.490000e+02  1.000000e+00   
50%      1.400000e+01  3.100000e+01  9.343000e+03  3.990000e+02  1.000000e+00   
75%      2.300000e+01  4.700000e+01  1.568400e+04  9.990000e+02  1.000000e+00   
max      3.300000e+01  5.900000e+01  2.216900e+04  3.079800e+05  2.169000e+03   
</p>

<p>
       item_revenue  
count  2.935849e+06  
mean   1.157732e+03  
std    5.683604e+03  
min   -6.897000e+04  
25%    2.490000e+02  
50%    4.490000e+02  
75%    1.078200e+03  
max    1.829990e+06  
</p>
</div>
</li>

<li>
<a id="orgfca0dad"></a>Filter Out the Month<br><div class="outline-text-5" id="text-orgfca0dad">
<p>
I was originally filtering using a regular expression, but the other questions use date-filtering too so I decided to create the extra day, month, and year columns once to avoid the extra regular expression overhead later on.
</p>

<div class="highlight"><pre><span></span>class Dates:
    date_expression = r'(?P&lt;day&gt;\d{2})\.(?P&lt;month&gt;\d{2})\.(?P&lt;year&gt;\d{4})'
    september = '09'
    summer = ['06', '07', '08']
</pre></div>

<div class="highlight"><pre><span></span>dates = transactions.date.str.extract(Dates.date_expression)
print(dates.head())
</pre></div>

<p>
  day month  year
0  02    01  2013
1  03    01  2013
2  05    01  2013
3  06    01  2013
4  15    01  2013
  day month  year
0  02    01  2013
1  03    01  2013
2  05    01  2013
3  06    01  2013
4  15    01  2013
</p>

<p>
Now we can smash our new data frame to the transactions using the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.concat.html">concat</a> function. By default it will try to add the rows from the second data frame to the rows of the first, but since we're adding new columns we need to pass in the <code>axis='columns'</code> argument.
</p>

<div class="highlight"><pre><span></span>transactions = pandas.concat((transactions, dates), axis='columns')
print(transactions.head())
</pre></div>

<p>
         date  date_block_num  shop_id  item_id  item_price  item_cnt_day  \
0  02.01.2013               0       59    22154      999.00           1.0   
1  03.01.2013               0       25     2552      899.00           1.0   
2  05.01.2013               0       25     2552      899.00          -1.0   
3  06.01.2013               0       25     2554     1709.05           1.0   
4  15.01.2013               0       25     2555     1099.00           1.0   
</p>

<p>
   item_revenue day month  year  
0        999.00  02    01  2013  
1        899.00  03    01  2013  
2       -899.00  05    01  2013  
3       1709.05  06    01  2013  
4       1099.00  15    01  2013  
</p>

<p>
First, as a sanity check, we'll make sure that all the date cells have values.
</p>

<div class="highlight"><pre><span></span>assert not transactions.date.hasnans
</pre></div>

<p>
Now let's filter on the date-expression we created for september. The next problem also uses 2014 so save that as a separate sub-set.
</p>

<div class="highlight"><pre><span></span>twenty_fourteen = transactions[transactions.year.isin(["2014"])]
september = twenty_fourteen[twenty_fourteen.month.isin([Dates.september])]
print(september.shape)
print(september.head())
</pre></div>

<p>
(73157, 10)
               date  date_block_num  shop_id  item_id  item_price  \
1953691  24.09.2014              20        5     1039       899.0   
1953692  27.09.2014              20        5     1015       449.0   
1953693  07.09.2014              20        5     1329       399.0   
1953694  27.09.2014              20        5      984       399.0   
1953695  08.09.2014              20        5      984       399.0   
</p>

<p>
         item_cnt_day  item_revenue day month  year  
1953691           1.0         899.0  24    09  2014  
1953692           1.0         449.0  27    09  2014  
1953693           1.0         399.0  07    09  2014  
1953694           1.0         399.0  27    09  2014  
1953695           1.0         399.0  08    09  2014  
</p>

<div class="highlight"><pre><span></span>assert all(twenty_fourteen.year == "2014")
assert all(september.month == "09")
</pre></div>

<p>
That seems like a lot of transactions. What fraction of the total is it?
</p>

<div class="highlight"><pre><span></span>rows, columns = september.shape
print("{:.2f} %".format(100 * rows/transactions.shape[0]))
</pre></div>

<p>
2.49 %
</p>

<p>
Not as much as I would have thought, <code>transactions</code> is much larger than I first took it to be.
</p>

<div class="highlight"><pre><span></span>grouped = september.groupby(["shop_id"])
summed = grouped.item_revenue.agg(numpy.sum)
print(summed.head())
</pre></div>

<p>
shop_id
2    1473540.00
3    1228425.00
4    1211556.00
5    1350828.02
6    3480397.00
Name: item_revenue, dtype: float64
</p>

<div class="highlight"><pre><span></span>max_revenue = summed.loc[summed.idxmax()]
print("Highest Revenue Earned by a shop in September of 2014: $ {:,.2f}".format(max_revenue))
</pre></div>

<p>
Highest Revenue Earned by a shop in September of 2014: $ 7,982,852.20
</p>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org59f72a4" class="outline-3">
<h3 id="org59f72a4">Question 2: What item category generated the highest revenue in the Summer of 2014?</h3>
<div class="outline-text-3" id="text-org59f72a4">
<ul class="org-ul">
<li>Submit the <code>id</code> of the category found.</li>
<li>Here we call "summer" the period from June to August.</li>
</ul>
<p>
<b>Hints:</b>
</p>

<p>
Note, that for an object `x` of type `pd.Series`: `x.argmax()` returns <b><b>index</b></b> of the maximum element. `pd.Series` can have non-trivial index (not `[1, 2, 3, … ]`).
</p>
</div>
<div id="outline-container-orgb1458f4" class="outline-4">
<h4 id="orgb1458f4">Get the Summer months</h4>
<div class="outline-text-4" id="text-orgb1458f4">
<div class="highlight"><pre><span></span>summer = twenty_fourteen[twenty_fourteen.month.isin(Dates.summer)]
print(summer.head())
for month in summer.month.unique():
    assert month in Dates.summer
print(summer.shape)
</pre></div>

<p>
               date  date_block_num  shop_id  item_id  item_price  \
1705909  15.06.2014              17       26     9532      399.00   
1705910  10.06.2014              17       26     9507      149.00   
1705911  13.06.2014              17       26     9509      246.32   
1705912  03.06.2014              17       26     9532      399.00   
1705913  08.06.2014              17       26     9532      399.00   
</p>

<p>
         item_cnt_day  item_revenue day month  year  
1705909           1.0        399.00  15    06  2014  
1705910           1.0        149.00  10    06  2014  
1705911           1.0        246.32  13    06  2014  
1705912           1.0        399.00  03    06  2014  
1705913           1.0        399.00  08    06  2014  
(247782, 10)
</p>
</div>
</div>

<div id="outline-container-org80079d9" class="outline-4">
<h4 id="org80079d9">Map in the Category IDs</h4>
<div class="outline-text-4" id="text-org80079d9">
<p>
If you look at <code>items.item_id</code> you can see that the id's are really just the numerical index to the <code>items.item_category_id</code> series. I was originally add the category ids for all the transactions but it takes a long time so I'm just adding it to this group.
</p>

<div class="highlight"><pre><span></span>assert all(items.item_id == range(len(items)))
</pre></div>

<p>
So we can map them back into our summer transactions.
</p>

<div class="highlight"><pre><span></span>summer["item_category_id"] = summer.item_id.apply(lambda item: items.item_category_id.loc[item])
</pre></div>

<div class="highlight"><pre><span></span>print(summer.head())
</pre></div>

<p>
               date  date_block_num  shop_id  item_id  item_price  \
1705909  15.06.2014              17       26     9532      399.00   
1705910  10.06.2014              17       26     9507      149.00   
1705911  13.06.2014              17       26     9509      246.32   
1705912  03.06.2014              17       26     9532      399.00   
1705913  08.06.2014              17       26     9532      399.00   
</p>

<p>
         item_cnt_day  item_revenue day month  year  item_category_id  
1705909           1.0        399.00  15    06  2014                30  
1705910           1.0        149.00  10    06  2014                40  
1705911           1.0        246.32  13    06  2014                37  
1705912           1.0        399.00  03    06  2014                30  
1705913           1.0        399.00  08    06  2014                30  
</p>

<div class="highlight"><pre><span></span>
</pre></div>

<div class="highlight"><pre><span></span>category_id_with_max_revenue = # PUT YOUR ANSWER IN THIS VARIABLE
</pre></div>


<p>
grader.submit_tag('category_id_with_max_revenue', category_id_with_max_revenue)
</p>


<p>
num_items_constant_price = # PUT YOUR ANSWER IN THIS VARIABLE
grader.submit_tag('num_items_constant_price', num_items_constant_price)
</p>


<p>
shop_id = 25
</p>

<p>
total_num_items_sold = # YOUR CODE GOES HERE
days = # YOUR CODE GOES HERE
</p>

<p>
plt.plot(days, total_num_items_sold)
plt.ylabel('Num items')
plt.xlabel('Day')
plt.title("Daily revenue for shop_id = 25")
plt.show()
</p>

<p>
total_num_items_sold_var = # PUT YOUR ANSWER IN THIS VARIABLE
grader.submit_tag('total_num_items_sold_var', total_num_items_sold_var)
</p>


<p>
STUDENT_EMAIL = # EMAIL HERE
STUDENT_TOKEN = # TOKEN HERE
grader.status()
</p>


<p>
grader.submit(STUDENT_EMAIL, STUDENT_TOKEN)
</p>
</div>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/pandas-basics/" rel="tag">pandas basics</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../will-a-gbdt-performance-drop-if-we-remove-the-first-tree/" rel="prev" title="Will a GBDT's performance drop if we remove the first tree?">Previous post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2018         <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
