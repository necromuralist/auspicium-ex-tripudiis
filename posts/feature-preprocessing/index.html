<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Preprocessing data features.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Feature Preprocessing | Notes on Kaggle</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Kaggle-Competitions/posts/feature-preprocessing/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script><meta name="author" content="Cloistered Monkey">
<link rel="prev" href="../pandas-basics/" title="Revisiting Pandas (Yet Again)" type="text/html">
<link rel="next" href="../the-competition/" title="The Competition" type="text/html">
<meta property="og:site_name" content="Notes on Kaggle">
<meta property="og:title" content="Feature Preprocessing">
<meta property="og:url" content="https://necromuralist.github.io/Kaggle-Competitions/posts/feature-preprocessing/">
<meta property="og:description" content="Preprocessing data features.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-08-07T21:41:10-07:00">
<meta property="article:tag" content="features preprocessing notes">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/Kaggle-Competitions/">

                <span id="blog-title">Notes on Kaggle</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="https://necromuralist.github.io/">The Cloistered Monkey</a>
                </li>
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/Kaggle-Competitions/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.org" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Feature Preprocessing</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2018-08-07T21:41:10-07:00" itemprop="datePublished" title="2018-08-07 21:41">2018-08-07 21:41</time></a></p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3b179ea">Preprocessing</a></li>
<li><a href="#orga780e53">Numeric Feature Preprocessing</a></li>
<li><a href="#org4ff427b">Categorical And Ordinal Features</a></li>
<li><a href="#org602aeb2">Dates and Times</a></li>
<li><a href="#orgec3d360">Coordinates</a></li>
<li><a href="#orgaa2c940">Missing Data</a></li>
<li><a href="#orge9338db">Links</a></li>
</ul>
</div>
</div>
<div id="outline-container-org3b179ea" class="outline-2">
<h2 id="org3b179ea">Preprocessing</h2>
<div class="outline-text-2" id="text-org3b179ea">
<p>
In every competition you need to:
</p>

<ul class="org-ul">
<li>pre-process the data</li>
<li>generate new features from the existing ones</li>
</ul>
</div>
</div>
<div id="outline-container-orga780e53" class="outline-2">
<h2 id="orga780e53">Numeric Feature Preprocessing</h2>
<div class="outline-text-2" id="text-orga780e53">
<p>
Some models (e.g. Linear Classification) need you to convert numeric-looking data to categorical data. Tree-based models don't need pre-processing as much as non tree-based models do.
</p>
</div>

<div id="outline-container-org09bb1a3" class="outline-3">
<h3 id="org09bb1a3">Scaling</h3>
<div class="outline-text-3" id="text-org09bb1a3">
<p>
If features have different value ranges then the model will  treat them differently.
</p>
<ul class="org-ul">
<li>
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html">sklearn.preprocessing.MinMaxScalar</a>
Scale by the range of values</li>
<li>
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html">sklearn.preprocessing.StandardScalar</a>
Scale the data to have a mean of 0 and a standard deviation of 1</li>
</ul>
</div>
</div>
<div id="outline-container-org9cf21a1" class="outline-3">
<h3 id="org9cf21a1">Outliers</h3>
<div class="outline-text-3" id="text-org9cf21a1">
<ul class="org-ul">
<li>Clip (<a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.clip.html">numpy.clip</a>)values to get rid of unusual values that mess with the model. (Winsorization)</li>
<li>Rank Transform them (<a href="https://docs.scipy.org/doc/scipy-0.16.0/reference/generated/scipy.stats.rankdata.html">scipy.stats.rankdata</a>) so that they are ordered and have the same distance between them (they are uniformly distributed)</li>
</ul>
</div>
</div>
<div id="outline-container-org726d89b" class="outline-3">
<h3 id="org726d89b">Transformation</h3>
<div class="outline-text-3" id="text-org726d89b">
<p>
For linear models and neural networks, transforming the data can sometimes help.
</p>
<ul class="org-ul">
<li>Log Transform: <a href="https://duckduckgo.com/?q=numpy+log&amp;t=canonical&amp;ia=web">numpy.log(1 + x)</a>
</li>
<li>Power Less Than 1 Transform: <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.sqrt.html">numpy.sqrt(x + 2/3)</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgee6c30b" class="outline-3">
<h3 id="orgee6c30b">Feature Generation</h3>
<div class="outline-text-3" id="text-orgee6c30b">
<p>
Sometimes you can convert separate columns to get new ones. This requires exploratory data analysis.
</p>
<ul class="org-ul">
<li>Fractional Parts: people perceive numbers with fractions differently so sometime separating out the fractional part makes the model perform better because it is the more important part</li>
<li>You can derive new values mathematically (e.g. distance using height and width)</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org4ff427b" class="outline-2">
<h2 id="org4ff427b">Categorical And Ordinal Features</h2>
<div class="outline-text-2" id="text-org4ff427b">
<ul class="org-ul">
<li>Ordinal Features have an ordering but even if they are labeled numerically (e.g. 1, 2, 3) they aren't numeric because there is no implication about the distance between them</li>
<li>label and frequency encoding are commonly used for tree-based models</li>
<li>one-hot encoding is more common for non-tree-based models</li>
</ul>
</div>
<div id="outline-container-orge25d071" class="outline-3">
<h3 id="orge25d071">Label Encoding</h3>
<div class="outline-text-3" id="text-orge25d071">
<p>
Some models need numeric values or numeric values that don't have implied ordering so you want to encode them.
</p>
<ul class="org-ul">
<li>
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.LabelEncoder.html">sklearn.preprocessing.LabelEncoder</a>
Sorts the labels then encodes them as integers</li>
<li>
<a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.factorize.html">Pandas.factorize</a>
Encodes the labels in the order they appear. This makes more sense if there is a meaning to the order in which labels appear.</li>
<li>This is more commonly used with tree-based methods.</li>
</ul>
</div>
</div>
<div id="outline-container-org2f84a20" class="outline-3">
<h3 id="org2f84a20">Frequency Encoding</h3>
<div class="outline-text-3" id="text-org2f84a20">
<p>
Encode the values to a fraction of all the labels. Can work with linear models if the frequency is correlated with the target value.
</p>
<ul class="org-ul">
<li><code>titanic.groupby("Embarked").size()/len(titanic)</code></li>
<li>
<code>from scipy.stats import rankedata</code> (<a href="https://docs.scipy.org/doc/scipy-0.16.0/reference/generated/scipy.stats.rankdata.html">rankedata</a>)</li>
<li>More common with tree-based methods</li>
</ul>
</div>
</div>
<div id="outline-container-org371b388" class="outline-3">
<h3 id="org371b388">One Hot Encoding</h3>
<div class="outline-text-3" id="text-org371b388">
<p>
Creates one column for each label and puts a 1 in the column that matches. Works with both linear and tree-based models, but can be inefficient with tree-based models.
</p>
<ul class="org-ul">
<li>
<a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.get_dummies.html">pandas.get_dummies</a> - converts strings into column encodings</li>
<li>
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html">sklearn.preprocessing.OneHotEncoder</a> - converts numeric categorical data into column encodings</li>
<li>One hot encoding is better for non-tree models.</li>
<li>This allows easier feature interactions (encode combined features (e.g. gender and class) rather than encoding them separately) 
<ul class="org-ul">
<li>This is more common with linear models and KNN</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org602aeb2" class="outline-2">
<h2 id="org602aeb2">Dates and Times</h2>
<div class="outline-text-2" id="text-org602aeb2">
<p>
When working with seasonal data, sometimes the relative date-stamps are more important than the actual dates (how close to Christmas?).
Sometimes you want the time between events.
</p>
</div>
</div>
<div id="outline-container-orgec3d360" class="outline-2">
<h2 id="orgec3d360">Coordinates</h2>
<div class="outline-text-2" id="text-orgec3d360">
<p>
Sometimes you want exact coordinates, but most times you want distances to some center.
</p>
</div>
</div>
<div id="outline-container-orgaa2c940" class="outline-2">
<h2 id="orgaa2c940">Missing Data</h2>
<div class="outline-text-2" id="text-orgaa2c940">
<ul class="org-ul">
<li>"missing" data might mean outliers - values that are probably wrong</li>
<li>avoid replacing missing values before feature engineering - it can throw off what you do</li>
<li>Gradient Boost Trees can handle isNaN, so you don't have to do anything</li>
</ul>
</div>
<div id="outline-container-orga05c8a1" class="outline-3">
<h3 id="orga05c8a1">Numeric</h3>
<div class="outline-text-3" id="text-orga05c8a1">
</div>
<div id="outline-container-org4b9f89c" class="outline-4">
<h4 id="org4b9f89c">Fill NA Approaches</h4>
<div class="outline-text-4" id="text-org4b9f89c">
<ul class="org-ul">
<li>-999, -1, other numbers
<ul class="org-ul">
<li>lets you categorize missing values</li>
<li>throws some models off (e.g. linear models and neural networks)</li>
<li>one solution is to create a new feature for missing values, but this has now increased the amount of data you need (curse of dimensionality)</li>
</ul>
</li>
<li>mean, median, some central tendency
<ul class="org-ul">
<li>This can throw the model off</li>
<li>it is sometimes better to ignore missing data</li>
</ul>
</li>
<li>recronstructed value</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-orge9338db" class="outline-2">
<h2 id="orge9338db">Links</h2>
<div class="outline-text-2" id="text-orge9338db">
</div>
<div id="outline-container-org2761a50" class="outline-3">
<h3 id="org2761a50">Feature Pre-processing</h3>
<div class="outline-text-3" id="text-org2761a50">
<ul class="org-ul">
<li><a href="http://scikit-learn.org/stable/modules/preprocessing.html">SKlearn's Preprocessing Documentation</a></li>
<li><a href="https://www.coursera.org/learn/machine-learning/lecture/xx3Da/gradient-descent-in-practice-i-feature-scaling">Andrew Ng on Feature Scaling and its effect on Gradient Descent</a></li>
<li><a href="http://sebastianraschka.com/Articles/2014_about_feature_scaling.html">Sebastian Raschka on Feature Scaling</a></li>
</ul>
</div>
</div>
<div id="outline-container-org596abeb" class="outline-3">
<h3 id="org596abeb">Feature Engineering</h3>
<div class="outline-text-3" id="text-org596abeb">
<ul class="org-ul">
<li><a href="https://machinelearningmastery.com/discover-feature-engineering-how-to-engineer-features-and-how-to-get-good-at-it/">Machine Learning Mastery on Feature Engineering</a></li>
<li><a href="https://www.quora.com/What-are-some-best-practices-in-Feature-Engineering">Quora: What are some best practices in Feature Engineering?</a></li>
</ul>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/features-preprocessing-notes/" rel="tag">features preprocessing notes</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../pandas-basics/" rel="prev" title="Revisiting Pandas (Yet Again)">Previous post</a>
            </li>
            <li class="next">
                <a href="../the-competition/" rel="next" title="The Competition">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents Â© 2018         <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
