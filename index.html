<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Notes on studying kaggle.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Notes on Kaggle</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Kaggle-Competitions/">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script><link rel="prefetch" href="posts/references/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/Kaggle-Competitions/">

                <span id="blog-title">Notes on Kaggle</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="active">
<a href=".">The Cloistered Monkey <span class="sr-only">(active)</span></a>
                </li>
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/Kaggle-Competitions/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/references/" class="u-url">References</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/references/" rel="bookmark"><time class="published dt-published" datetime="2018-09-01T12:16:46-07:00" title="2018-09-01 12:16">2018-09-01 12:16</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orge20137e" class="outline-2">
<h2 id="orge20137e">Bibliography</h2>
<div class="outline-text-2" id="text-orge20137e">
<ul class="org-ul">
<li>[B1] 1. Albon C. Machine learning with Python cookbook: practical solutions from preprocessing to deep learning. First edition. Beijing Boston Farnham: O’Reilly; 2018. 349 p.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/the-target/" class="u-url">The Target</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/the-target/" rel="bookmark"><time class="published dt-published" datetime="2018-08-31T13:29:42-07:00" title="2018-08-31 13:29">2018-08-31 13:29</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/the-target/#org0f6a87e">Introduction</a></li>
<li><a href="posts/the-target/#orgc89b38d">Imports</a></li>
<li><a href="posts/the-target/#orgfa55ea5">The Data</a></li>
<li><a href="posts/the-target/#orgd91ba5e">Dates</a></li>
</ul>
</div>
</div>

<div id="outline-container-org0f6a87e" class="outline-2">
<h2 id="org0f6a87e">Introduction</h2>
<div class="outline-text-2" id="text-org0f6a87e">
<p>
This is some stuff about what we are trying to predict. I realized that the description of the competition says that we are trying to predict the number of items sold per shop for the next month after the data, but I never said what that month is, so I'm making this just to put it somewhere.
</p>
</div>
</div>
<div id="outline-container-orgc89b38d" class="outline-2">
<h2 id="orgc89b38d">Imports</h2>
<div class="outline-text-2" id="text-orgc89b38d">
<div class="highlight"><pre><span></span>import warnings
warnings.filterwarnings("ignore", message="numpy.dtype size changed")
warnings.filterwarnings("ignore", message="numpy.ufunc size changed")
</pre></div>
</div>

<div id="outline-container-org20ac23e" class="outline-3">
<h3 id="org20ac23e">From pypi</h3>
<div class="outline-text-3" id="text-org20ac23e">
<div class="highlight"><pre><span></span>import pandas
import matplotlib.pyplot as pyplot
import seaborn
</pre></div>
</div>
</div>

<div id="outline-container-org6614d60" class="outline-3">
<h3 id="org6614d60">This project</h3>
<div class="outline-text-3" id="text-org6614d60">
<div class="highlight"><pre><span></span>from kaggler.helpers.build_training_data import Pickles
from kaggler.helpers.helpers import (
    DataKeys,
    Helpers,
    )
</pre></div>
</div>
</div>

<div id="outline-container-orgcab3349" class="outline-3">
<h3 id="orgcab3349">Setting up the plotting</h3>
<div class="outline-text-3" id="text-orgcab3349">
<div class="highlight"><pre><span></span>% matplotlib inline
seaborn.set_style("whitegrid")
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orgfa55ea5" class="outline-2">
<h2 id="orgfa55ea5">The Data</h2>
<div class="outline-text-2" id="text-orgfa55ea5">
<div class="highlight"><pre><span></span>x_train = Helpers.unpickle(Pickles.x_train)
y_train = Helpers.unpickle(Pickles.y_train)
x_test = Helpers.unpickle(Pickles.x_test)
</pre></div>

<p>
Although it seem unlikely, it's possible that there are months in either the test or training set that aren't shared, so I'm going to concatenate them.
</p>

<div class="highlight"><pre><span></span>concatenated = pandas.concat([x_train, x_test], axis="rows")
assert concatenated.shape == (len(x_train) + len(x_test), len(x_train.columns))
</pre></div>
</div>
</div>

<div id="outline-container-orgd91ba5e" class="outline-2">
<h2 id="orgd91ba5e">Dates</h2>
<div class="outline-text-2" id="text-orgd91ba5e">
<p>
Unfortunately I got rid of the days, which are required by the <a href="https://pandas.pydata.org/pandas-docs/stable/timeseries.html">to_datetime</a> function provided by pandas, so I'm going to construct a new date column with a day of 1 for each date.
</p>

<div class="highlight"><pre><span></span>DataKeys.date = "Date"
DataKeys.datetime = "Date Time"
concatenated[DataKeys.date] = "01-" + concatenated.month + '-' + concatenated.year
concatenated[DataKeys.datetime] = pandas.to_datetime(
    concatenated[DataKeys.date], format="%d-%m-%Y")
Helpers.print_head(concatenated)
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">Date</th>
<th scope="col" class="org-left">Date Time</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">11</td>
<td class="org-right">15</td>
<td class="org-right">1324</td>
<td class="org-right">499</td>
<td class="org-right">55</td>
<td class="org-right">12</td>
<td class="org-right">2013</td>
<td class="org-right">01-12-2013</td>
<td class="org-left">2013-12-01 00:00:00</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">31</td>
<td class="org-right">19981</td>
<td class="org-right">499</td>
<td class="org-right">43</td>
<td class="org-right">07</td>
<td class="org-right">2014</td>
<td class="org-right">01-07-2014</td>
<td class="org-left">2014-07-01 00:00:00</td>
</tr>
<tr>
<td class="org-right">32</td>
<td class="org-right">28</td>
<td class="org-right">7934</td>
<td class="org-right">398</td>
<td class="org-right">7</td>
<td class="org-right">09</td>
<td class="org-right">2015</td>
<td class="org-right">01-09-2015</td>
<td class="org-left">2015-09-01 00:00:00</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">43</td>
<td class="org-right">13518</td>
<td class="org-right">1499</td>
<td class="org-right">19</td>
<td class="org-right">01</td>
<td class="org-right">2014</td>
<td class="org-right">01-01-2014</td>
<td class="org-left">2014-01-01 00:00:00</td>
</tr>
<tr>
<td class="org-right">28</td>
<td class="org-right">25</td>
<td class="org-right">19927</td>
<td class="org-right">329</td>
<td class="org-right">57</td>
<td class="org-right">05</td>
<td class="org-right">2015</td>
<td class="org-right">01-05-2015</td>
<td class="org-left">2015-05-01 00:00:00</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span>print(concatenated[DataKeys.datetime].max())
</pre></div>

<p>
So the last month in the data-set is October 2015, and we want to predict what the counts will be for November 2015.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/some-plots-of-the-data/" class="u-url">Some Plots of the Data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/some-plots-of-the-data/" rel="bookmark"><time class="published dt-published" datetime="2018-08-29T14:19:26-07:00" title="2018-08-29 14:19">2018-08-29 14:19</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/some-plots-of-the-data/#org43496dc">Imports</a></li>
<li><a href="posts/some-plots-of-the-data/#org681b960">Build the data</a></li>
<li><a href="posts/some-plots-of-the-data/#org60f4748">More Helpers</a></li>
<li><a href="posts/some-plots-of-the-data/#orgb501729">Features vs Target</a></li>
</ul>
</div>
</div>

<div id="outline-container-org43496dc" class="outline-2">
<h2 id="org43496dc">Imports</h2>
<div class="outline-text-2" id="text-org43496dc">
<div class="highlight"><pre><span></span>import warnings
warnings.filterwarnings("ignore", message="numpy.dtype size changed")
warnings.filterwarnings("ignore", message="numpy.ufunc size changed")
</pre></div>
</div>

<div id="outline-container-org39cccf3" class="outline-3">
<h3 id="org39cccf3">From pypi</h3>
<div class="outline-text-3" id="text-org39cccf3">
<div class="highlight"><pre><span></span>import matplotlib.pyplot as pyplot
import numpy
import seaborn
</pre></div>

<div class="highlight"><pre><span></span>%matplotlib inline
seaborn.set_style("whitegrid")
</pre></div>
</div>
</div>

<div id="outline-container-org03cdeac" class="outline-3">
<h3 id="org03cdeac">This project</h3>
<div class="outline-text-3" id="text-org03cdeac">
<div class="highlight"><pre><span></span>from kaggler.helpers.build_training_data import Pickles
from kaggler.helpers.helpers import (
    DataKeys,
    Helpers,
    )
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org681b960" class="outline-2">
<h2 id="org681b960">Build the data</h2>
<div class="outline-text-2" id="text-org681b960">
<div class="highlight"><pre><span></span>x_train = Helpers.unpickle(Pickles.x_train)
y_train = Helpers.unpickle(Pickles.y_train)
DataKeys.target = "Month Count"
x_train[DataKeys.target] = y_train.values
Helpers.print_head(x_train)
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">Month Count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">11</td>
<td class="org-right">15</td>
<td class="org-right">1324</td>
<td class="org-right">499</td>
<td class="org-right">55</td>
<td class="org-right">12</td>
<td class="org-right">2013</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">31</td>
<td class="org-right">19981</td>
<td class="org-right">499</td>
<td class="org-right">43</td>
<td class="org-right">07</td>
<td class="org-right">2014</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-right">32</td>
<td class="org-right">28</td>
<td class="org-right">7934</td>
<td class="org-right">398</td>
<td class="org-right">7</td>
<td class="org-right">09</td>
<td class="org-right">2015</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">43</td>
<td class="org-right">13518</td>
<td class="org-right">1499</td>
<td class="org-right">19</td>
<td class="org-right">01</td>
<td class="org-right">2014</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">28</td>
<td class="org-right">25</td>
<td class="org-right">19927</td>
<td class="org-right">329</td>
<td class="org-right">57</td>
<td class="org-right">05</td>
<td class="org-right">2015</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org60f4748" class="outline-2">
<h2 id="org60f4748">More Helpers</h2>
<div class="outline-text-2" id="text-org60f4748">
<div class="highlight"><pre><span></span>def make_figure_and_axis(x_label, y_label, title, figsize=(10, 8)):
    """make a matplotlib figure

    Args:
     x_label (str): label for the x-axis
     y_label (str): label for the y-axis
     title (str): title for the plot
     figsize: tuple of width, height
    Returns:
     tuple: figure, axis
    """
    figure = pyplot.figure(figsize=figsize)
    axe = figure.gca()
    axe.set_xlabel(x_label)
    axe.set_ylabel(y_label)
    axe.set_title(title)
    return figure, axe
</pre></div>
</div>
</div>
<div id="outline-container-orgb501729" class="outline-2">
<h2 id="orgb501729">Features vs Target</h2>
<div class="outline-text-2" id="text-orgb501729">
</div>
<div id="outline-container-org5282eb5" class="outline-3">
<h3 id="org5282eb5">Date Block</h3>
<div class="outline-text-3" id="text-org5282eb5">
<div class="highlight"><pre><span></span>figure, axis = make_figure_and_axis("Date Block", "Count", "Date-Block Counts")
grid = seaborn.catplot(ax=axis, x=DataKeys.date_block, kind="count", data=x_train)
</pre></div>

<p>
The counts represent the number of shop-product pairs per-month, which isn't really what we want. We want the count per-product per month. As an intermediary step, why don't we look at the total count as it changes over time.
</p>

<div class="highlight"><pre><span></span>date_group = x_train.groupby(DataKeys.date_block)
summed = date_group.sum()
summed = summed.reset_index()
figure, axis = make_figure_and_axis("Date Block", "Monthly Count",
				    "Total Items Sold Per Month")
grid = seaborn.relplot(x=DataKeys.date_block, y=DataKeys.target, ax=axis,
		       data=summed, kind="line")
</pre></div>

<p>
This seems to indicate that sales are going down overall over time. Those spikes are interesting, maybe the months would be interesting. First we need to re-join the month and year together so the sorting of the x-axis will work okay.
</p>

<div class="highlight"><pre><span></span>DataKeys.date = "Date"
x_train[DataKeys.date] = x_train.year + "-" + x_train.month
month_grouped = x_train.groupby(DataKeys.date)
month_summed = month_grouped.sum().reset_index()
</pre></div>

<div class="highlight"><pre><span></span>top_two = month_summed.sort_values(DataKeys.target, ascending=False)[:2]
figure, axis = make_figure_and_axis("Month", "Count", "Items Sold Per Month",
				    figsize=(12,10))

pyplot.xticks(rotation=45, ha="right")
grid = seaborn.relplot(x=DataKeys.date, y=DataKeys.target, data=month_summed,
		       ax=axis, kind="line")
axis.axvline(top_two.index[0], color='r')
line = axis.axvline(top_two.index[1], color='r')
</pre></div>

<div class="highlight"><pre><span></span>Helpers.print_table(top_two[[DataKeys.date, DataKeys.target]])
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right"> </th>
<th scope="col" class="org-right">Date</th>
<th scope="col" class="org-right">Month Count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">11</td>
<td class="org-right">2013-12</td>
<td class="org-right">147909</td>
</tr>
<tr>
<td class="org-right">23</td>
<td class="org-right">2014-12</td>
<td class="org-right">134785</td>
</tr>
</tbody>
</table>
<p>
Perhaps not surprisingly, the month of December, when holiday sales spike, is the month with the most sales.
</p>
</div>
</div>
<div id="outline-container-orge521700" class="outline-3">
<h3 id="orge521700">Shop</h3>
<div class="outline-text-3" id="text-orge521700">
<div class="highlight"><pre><span></span>group = x_train.groupby(DataKeys.shop).sum().reset_index().sort_values(DataKeys.target)
</pre></div>


<div class="highlight"><pre><span></span>figure, axis = make_figure_and_axis("Shop", "Count", "Shop Sales For Total Time")
grid = seaborn.relplot(x=DataKeys.shop, y=DataKeys.target, data=group,
		       ax=axis)
</pre></div>

<p>
There appears to be seven or eight shops that dominate the sales.
</p>
</div>
</div>

<div id="outline-container-orgfbe0bc4" class="outline-3">
<h3 id="orgfbe0bc4">Item Category</h3>
<div class="outline-text-3" id="text-orgfbe0bc4">
<div class="highlight"><pre><span></span>group = x_train.groupby(DataKeys.item_category).sum().reset_index()
</pre></div>

<div class="highlight"><pre><span></span>figure, axis = make_figure_and_axis("Category", "Count", "Category Sales For Total Time")
grid = seaborn.relplot(x=DataKeys.item_category, y=DataKeys.target, data=group,
		       ax=axis)
</pre></div>

<p>
Some kind of weirdly coincidental linear relationship between the category ID and the total sales. 
</p>
</div>
</div>

<div id="outline-container-org4018aae" class="outline-3">
<h3 id="org4018aae">Biggest Over Time</h3>
<div class="outline-text-3" id="text-org4018aae">
</div>
<div id="outline-container-orgf1535ce" class="outline-4">
<h4 id="orgf1535ce">Category</h4>
<div class="outline-text-4" id="text-orgf1535ce">
<div class="highlight"><pre><span></span>category_group = x_train.groupby([DataKeys.date, DataKeys.item_category]).sum().reset_index()
biggest = category_group.iloc[category_group[DataKeys.target].idxmax()]
biggest_category = category_group[category_group.item_category_id == biggest.item_category_id]
figure, axis = make_figure_and_axis("Month", "Count", "Category {} Sales For Total Time".format(biggest[DataKeys.item_category]))
pyplot.xticks(rotation=45, ha="right")
grid = seaborn.relplot(x=DataKeys.date, y=DataKeys.target, data=biggest_category,
		       ax=axis, kind="line")
</pre></div>

<p>
Even the most popular item declines over time.
</p>

<div class="highlight"><pre><span></span>big = biggest_category[DataKeys.target]
big_max = big.max()
big_min = big.min()
difference = big_max - big_min
print("Max: {}".format(big_max))
print("Min: {}".format(big_min))
print("Difference: {}".format(difference))
print("Percent Decline: {:.1f} %".format(100 * (difference/big_max)))
</pre></div>

<p>
Max: 28987.0
Min: 5413.0
Difference: 23574.0
Percent Decline: 81.3 %
</p>
</div>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/preprocessing-the-kaggle-data/" class="u-url">Preprocessing the Kaggle Data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/preprocessing-the-kaggle-data/" rel="bookmark"><time class="published dt-published" datetime="2018-08-25T13:05:56-07:00" title="2018-08-25 13:05">2018-08-25 13:05</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/preprocessing-the-kaggle-data/#orged6c8f9">Introduction</a></li>
<li><a href="posts/preprocessing-the-kaggle-data/#orga0a03fe">Tangle</a></li>
<li><a href="posts/preprocessing-the-kaggle-data/#org669470e">Imports</a></li>
<li><a href="posts/preprocessing-the-kaggle-data/#org1372e04">Loading the Data</a></li>
<li><a href="posts/preprocessing-the-kaggle-data/#org05825a1">Limit the Target Range</a></li>
</ul>
</div>
</div>

<div id="outline-container-orged6c8f9" class="outline-2">
<h2 id="orged6c8f9">Introduction</h2>
<div class="outline-text-2" id="text-orged6c8f9">
<p>
This is a post to do some basic pre-processing on the data. It won't do anything fancy (i.e. no Feature Engineering), but will just get the data ready to be used by the models. In particular, the rules say that the test data target will be limited to a range and the features are categorical so we need to transform them for non-tree models.
</p>
</div>
</div>
<div id="outline-container-orga0a03fe" class="outline-2">
<h2 id="orga0a03fe">Tangle</h2>
<div class="outline-text-2" id="text-orga0a03fe">
<div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">pypi</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">local</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">clip</span><span class="o">-</span><span class="n">it</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
</div>
<div id="outline-container-org669470e" class="outline-2">
<h2 id="org669470e">Imports</h2>
<div class="outline-text-2" id="text-org669470e">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.dtype size changed"</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.ufunc size changed"</span><span class="p">)</span>
</pre></div>
</div>

<div id="outline-container-org0eb96df" class="outline-3">
<h3 id="org0eb96df">From pypi</h3>
<div class="outline-text-3" id="text-org0eb96df">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgef2cfb6" class="outline-3">
<h3 id="orgef2cfb6">This project</h3>
<div class="outline-text-3" id="text-orgef2cfb6">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kaggler.helpers.build_training_data</span> <span class="kn">import</span> <span class="n">Pickles</span>
<span class="kn">from</span> <span class="nn">kaggler.helpers.helpers</span> <span class="kn">import</span> <span class="n">Helpers</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org1372e04" class="outline-2">
<h2 id="org1372e04">Loading the Data</h2>
<div class="outline-text-2" id="text-org1372e04">
<p>
This assumes you've run the <code>build_training_data.py</code> code to get the testing and training data sets. The <code>Helpers</code> class also expects a specific path, so you have to have the repository set up in <code>~/projects/kaggle-competitions/</code>.
</p>

<div class="highlight"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">Helpers</span><span class="o">.</span><span class="n">unpickle</span><span class="p">(</span><span class="n">Pickles</span><span class="o">.</span><span class="n">x_train</span><span class="p">)</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">Helpers</span><span class="o">.</span><span class="n">unpickle</span><span class="p">(</span><span class="n">Pickles</span><span class="o">.</span><span class="n">x_test</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">Helpers</span><span class="o">.</span><span class="n">unpickle</span><span class="p">(</span><span class="n">Pickles</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">Helpers</span><span class="o">.</span><span class="n">unpickle</span><span class="p">(</span><span class="n">Pickles</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org05825a1" class="outline-2">
<h2 id="org05825a1">Limit the Target Range</h2>
<div class="outline-text-2" id="text-org05825a1">
<p>
According to the contest description the true target values are clipped to the <code>[0,20]</code> range, so it might make sense to clip the target data in our training and testing data to the given range.
</p>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">11</td>
<td class="org-right">15</td>
<td class="org-right">1324</td>
<td class="org-right">499</td>
<td class="org-right">55</td>
<td class="org-right">12</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">31</td>
<td class="org-right">19981</td>
<td class="org-right">499</td>
<td class="org-right">43</td>
<td class="org-right">07</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">32</td>
<td class="org-right">28</td>
<td class="org-right">7934</td>
<td class="org-right">398</td>
<td class="org-right">7</td>
<td class="org-right">09</td>
<td class="org-right">2015</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">43</td>
<td class="org-right">13518</td>
<td class="org-right">1499</td>
<td class="org-right">19</td>
<td class="org-right">01</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">28</td>
<td class="org-right">25</td>
<td class="org-right">19927</td>
<td class="org-right">329</td>
<td class="org-right">57</td>
<td class="org-right">05</td>
<td class="org-right">2015</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>

<pre class="example">
count    1.287299e+06
mean     2.264775e+00
std      8.693074e+00
min     -2.200000e+01
25%      1.000000e+00
50%      1.000000e+00
75%      2.000000e+00
max      2.253000e+03
Name: item_count_month, dtype: float64

</pre>

<p>
Looking at the y-train data you can see that it ranges for -22 to 2,253 - so there is actually a huge amount of reduction in the range of the target data, but the median is only 1, so it might be that there are outliers in the data.
</p>

<div class="highlight"><pre><span></span><span class="n">figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Monthly Sales Distribution"</span><span class="p">)</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Monthly Sales"</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/preprocessing-the-kaggle-data/target_distribution.png" alt="target_distribution.png"></p>
</div>

<p>
It looks like the target is strongly right-skewed. So I guess it makes sense to <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.clip.html">clip</a> it.
</p>

<div class="highlight"><pre><span></span><span class="n">y_train_clipped</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">y_test_clipped</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">(</span><span class="n">y_train_clipped</span><span class="p">,</span> <span class="n">y_test_clipped</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">20</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">y_train_clipped</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Monthly Sales Distribution Clipped"</span><span class="p">)</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Monthly Sales"</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/preprocessing-the-kaggle-data/y_train_clipped.png" alt="y_train_clipped.png"></p>
</div>

<p>
That actually didn't really fix the distribution, strangely.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/building-the-training-set/" class="u-url">Building The Training Set</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/building-the-training-set/" rel="bookmark"><time class="published dt-published" datetime="2018-08-25T09:31:43-07:00" title="2018-08-25 09:31">2018-08-25 09:31</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/building-the-training-set/#org82438b9">The Tangle</a></li>
<li><a href="posts/building-the-training-set/#orga319808">Imports</a></li>
<li><a href="posts/building-the-training-set/#org113b4ba">Helpers</a></li>
<li><a href="posts/building-the-training-set/#orga915c5b">Building Up the Super Set</a></li>
<li><a href="posts/building-the-training-set/#org346293b">Setting up the Training and Validation Data</a></li>
<li><a href="posts/building-the-training-set/#org75c74a7">Creating the Validation Set</a></li>
</ul>
</div>
</div>

<div id="outline-container-org82438b9" class="outline-2">
<h2 id="org82438b9">The Tangle</h2>
<div class="outline-text-2" id="text-org82438b9">
<p>
This is the exporter for stuff to be re-used outside of this post.
</p>
<div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">python</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">suppress</span><span class="o">-</span><span class="n">warnings</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">pypi</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">local</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">pickles</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">creator</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">data</span><span class="o">-</span><span class="n">source</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="nb">set</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">load</span><span class="o">-</span><span class="n">items</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="n">duper</span><span class="o">-</span><span class="nb">set</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="n">dates</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">clean</span><span class="o">-</span><span class="nb">super</span><span class="o">-</span><span class="nb">set</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">make</span><span class="o">-</span><span class="n">grouper</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">make</span><span class="o">-</span><span class="n">chunked</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">merge</span><span class="o">-</span><span class="n">chunked</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">delete</span><span class="o">-</span><span class="n">day</span><span class="o">-</span><span class="n">count</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">targets</span><span class="o">-</span><span class="n">features</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">train</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">split</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga319808" class="outline-2">
<h2 id="orga319808">Imports</h2>
<div class="outline-text-2" id="text-orga319808">
</div>
<div id="outline-container-org8268ff2" class="outline-3">
<h3 id="org8268ff2">Python Standard Library</h3>
<div class="outline-text-3" id="text-org8268ff2">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge6397f2" class="outline-3">
<h3 id="orge6397f2">Suppressing the Numpy Warnings</h3>
<div class="outline-text-3" id="text-orge6397f2">
<p>
This is to suppress the warnings when we import pandas.
</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.dtype size changed"</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.ufunc size changed"</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd7ba4a4" class="outline-3">
<h3 id="orgd7ba4a4">From pypi</h3>
<div class="outline-text-3" id="text-orgd7ba4a4">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgee232e4" class="outline-3">
<h3 id="orgee232e4">This Project</h3>
<div class="outline-text-3" id="text-orgee232e4">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kaggler.helpers.helpers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataKeys</span><span class="p">,</span>
    <span class="n">DataNames</span><span class="p">,</span>
    <span class="n">DataSource</span><span class="p">,</span>
    <span class="n">Helpers</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org113b4ba" class="outline-2">
<h2 id="org113b4ba">Helpers</h2>
<div class="outline-text-2" id="text-org113b4ba">
</div>
<div id="outline-container-orge7249cc" class="outline-3">
<h3 id="orge7249cc">Pickles</h3>
<div class="outline-text-3" id="text-orge7249cc">
<p>
I'm going to pickle the data to re-load them later so this will hold the names.
</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Pickles</span><span class="p">:</span>
    <span class="sd">"""Holder of the pickle names"""</span>
    <span class="n">super_set</span> <span class="o">=</span> <span class="s2">"training_data"</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="s2">"grouped_months_data"</span>
    <span class="n">x_train</span> <span class="o">=</span> <span class="s2">"x_train"</span>
    <span class="n">x_test</span> <span class="o">=</span> <span class="s2">"x_test"</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="s2">"y_train"</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="s2">"y_test"</span>
    <span class="n">train_test</span> <span class="o">=</span> <span class="s2">"train_test"</span>
</pre></div>
</div>
</div>
</div>


<div id="outline-container-orga915c5b" class="outline-2">
<h2 id="orga915c5b">Building Up the Super Set</h2>
<div class="outline-text-2" id="text-orga915c5b">
<p>
Since we have some variables in separate sets I thought it would be useful to combine them into a single training set.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperSet</span><span class="p">:</span>
    <span class="sd">"""Creates the super-set of data"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>
</pre></div>
</div>

<div id="outline-container-orgdf67298" class="outline-3">
<h3 id="orgdf67298">The Data Source</h3>
<div class="outline-text-3" id="text-orgdf67298">
<p>
I put the paths into a class called DataSource, this is just to instantiate it.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">data_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""string-values for the data sources"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga3d07a2" class="outline-3">
<h3 id="orga3d07a2">Building the Super Set</h3>
<div class="outline-text-3" id="text-orga3d07a2">
<p>
The <code>super_set</code> will be a combination of the different data-sources.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""the super-set"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">data_sources</span><span class="o">.</span><span class="n">file_name_paths</span><span class="p">[</span><span class="n">DataNames</span><span class="o">.</span><span class="n">training</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2e4c1c6" class="outline-3">
<h3 id="org2e4c1c6">Adding the Category IDs</h3>
<div class="outline-text-3" id="text-org2e4c1c6">
<p>
The <code>items.csv</code> file holds a map of the item-ids to category-ids so we can <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.merge.html">merge</a> it in to get the category ids for our data-set.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Items</span><span class="p">:</span>
    <span class="sd">"""sale items data"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""a Data-Source object"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""dataframe of sale items"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data_sources</span><span class="o">.</span><span class="n">file_name_paths</span><span class="p">[</span><span class="n">DataNames</span><span class="o">.</span><span class="n">items</span><span class="p">])</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
<p>
This is also going to add the name of the item, which I'm thinking won't be as useful, but we can clean that out later.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperDuper</span><span class="p">:</span>
    <span class="sd">"""super set with item counts"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""super-set of data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="n">SuperSet</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""sale-items data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="n">Items</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""super set with sale items"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_set</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
					      <span class="n">on</span><span class="o">=</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">,</span>
					      <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span>

	    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_set</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
<td class="org-left">ЯВЛЕНИЕ 2012 (BD)</td>
<td class="org-right">37</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE  The House Of Blue Light  LP</td>
<td class="org-right">58</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
<td class="org-left">DEEP PURPLE  The House Of Blue Light  LP</td>
<td class="org-right">58</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE  Who Do You Think We Are  LP</td>
<td class="org-right">58</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE 30 Very Best Of 2CD (Фирм.)</td>
<td class="org-right">56</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org469c5e2" class="outline-3">
<h3 id="org469c5e2">Splitting the Dates</h3>
<div class="outline-text-3" id="text-org469c5e2">
<p>
The <code>date</code> column has a string formatted <code>dd.mm.yy</code>. Since we want sales per month and it might change over time, I'll split the date-stamp up into day, month, and year (although I don't think I'll be keeping day).
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperDates</span><span class="p">:</span>
    <span class="sd">"""Super-set with dates split out"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_duper</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_date_expression</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_dates</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_duper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""A super-duper data set"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_duper</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_duper</span> <span class="o">=</span> <span class="n">SuperDuper</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_duper</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">date_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""regular expression to parse the dates"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_date_expression</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_date_expression</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">'(?P&lt;{}&gt;\d{{2}})\.'</span>
				     <span class="s1">'(?P&lt;{}&gt;\d{{2}})\.'</span>
				     <span class="s1">'(?P&lt;{}&gt;\d{{4}})'</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
					 <span class="n">DataKeys</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
					 <span class="n">DataKeys</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
					 <span class="n">DataKeys</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_date_expression</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""dataframe of dates"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dates</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_duper</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">date_expression</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dates</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""data set with date columns"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
		<span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_duper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">),</span>
		<span class="n">axis</span><span class="o">=</span><span class="s1">'columns'</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"={}="</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date_expression</span><span class="p">))</span>
</pre></div>

<p>
<code>(?P&lt;day&gt;\d{2})\.(?P&lt;month&gt;\d{2})\.(?P&lt;year&gt;\d{4})</code>
</p>




<p>
Here's what <code>dates</code> looks like.
</p>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">03</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">05</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">06</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
<p>
Now we can smash our new data frame onto the transactions using the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.concat.html">concat</a> function. By default it will try to add the rows from the second data frame to the rows of the first, but since we're adding new columns we need to pass in the <code>axis='columns'</code> argument.
</p>

<p>
Nowe we can see what our <code>super_set</code> looks like.
</p>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
<td class="org-left">ЯВЛЕНИЕ 2012 (BD)</td>
<td class="org-right">37</td>
<td class="org-right">02</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE  The House Of Blue Light  LP</td>
<td class="org-right">58</td>
<td class="org-right">03</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
<td class="org-left">DEEP PURPLE  The House Of Blue Light  LP</td>
<td class="org-right">58</td>
<td class="org-right">05</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE  Who Do You Think We Are  LP</td>
<td class="org-right">58</td>
<td class="org-right">06</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE 30 Very Best Of 2CD (Фирм.)</td>
<td class="org-right">56</td>
<td class="org-right">15</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org5c55d54" class="outline-3">
<h3 id="org5c55d54">Cleaning Up</h3>
<div class="outline-text-3" id="text-org5c55d54">
<p>
The <code>date</code> column is now superfluous, and I don't think we need the day, since we are predicting by month. I'm also going to assume that names aren't as useful as the numeric ids. This might not be true, but I think using the text would require pre-processing which is beyond what I'm doing here, so I'm going to leave them out (there is another file with shop names that needs to be loaded if the text turns out to be significant). I'm going to <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.drop.html">drop</a> the columns that I don't think I'll need.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperClean</span><span class="p">:</span>
    <span class="sd">"""The super-set data with extra columns removed"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="p">[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">day</span><span class="p">]):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">drop</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the super-set data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="n">SuperDates</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The cleaned data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_set</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""Saves the data as a pickle"""</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">super_set</span><span class="p">)</span>
	<span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
<td class="org-right">37</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
<td class="org-right">58</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
<td class="org-right">58</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
<td class="org-right">58</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
<td class="org-right">56</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgaeeef54" class="outline-3">
<h3 id="orgaeeef54">Saving the Super Set</h3>
<div class="outline-text-3" id="text-orgaeeef54">
<p>
Now I'll pickle it up so it can be loaded later.
</p>


<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="n">super_set</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org346293b" class="outline-2">
<h2 id="org346293b">Setting up the Training and Validation Data</h2>
<div class="outline-text-2" id="text-org346293b">
<p>
Although I went through the trouble of smashing all the values into one Data Frame, it turns out that I need things grouped by month, and doing the grouping after adding the columns just make it messy, so I'm going to back-track a little here to set up the data we need for training and testing.
</p>
</div>

<div id="outline-container-orgb087d57" class="outline-3">
<h3 id="orgb087d57">The Grouper</h3>
<div class="outline-text-3" id="text-orgb087d57">
<p>
Since I'm going to aggregate by the month (really the <code>date_block_num</code>), leaving in things like the price doesn't really make sense so I'll make a sub-frame that I can <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.groupby.html">group</a>.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Grouper</span><span class="p">:</span>
    <span class="sd">"""Data Grouped by month, shop, item"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_cleaned</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_grouper</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cleaned</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""cleaned super-set"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleaned</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_cleaned</span> <span class="o">=</span> <span class="n">SuperClean</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleaned</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">grouper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""goups the data by columns"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouper</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_grouper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned</span><span class="p">[[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">,</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">shop</span><span class="p">,</span>
					  <span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">,</span>
					  <span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouper</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the summed group-data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouper</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">,</span>
					       <span class="n">DataKeys</span><span class="o">.</span><span class="n">shop</span><span class="p">,</span>
					       <span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">grouped</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-right"></colgroup>
<thead><tr>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<p>
The reason why it looks like we lost most of the data is that the <code>groupy</code> method moved the groups into the index.
</p>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">grouped</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

<p>
                                item_cnt_day
date_block_num shop_id item_id              
0              0       32                6.0
                       33                3.0
                       35                1.0
                       43                1.0
                       51                2.0
</p>

<p>
So we're going to <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.reset_index.html">reset the index</a>, which will convert the <a href="https://pandas.pydata.org/pandas-docs/stable/advanced.html">multiindex</a> into columns. I'm also going to re-name the <code>item_cnt_day</code> column since it now represents the count for the whole month, not one day.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Chunked</span><span class="p">:</span>
    <span class="sd">"""Data set chunked-up to the months"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_grouped</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">grouped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""grouped data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouped</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_grouped</span> <span class="o">=</span> <span class="n">Grouper</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouped</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The chunked data with the counts renamed"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">grouped</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
		<span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span><span class="p">:</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">},</span>
		<span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">chunked</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_count_month</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">32</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">33</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">35</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">43</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">51</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org2195a9a" class="outline-3">
<h3 id="org2195a9a">Adding the Columns Back</h3>
<div class="outline-text-3" id="text-org2195a9a">
</div>
<div id="outline-container-org3d17bb1" class="outline-4">
<h4 id="org3d17bb1">Group the Super Set</h4>
<div class="outline-text-4" id="text-org3d17bb1">
<p>
Back to the super-set. Since there are multiple entries for items in a given month, I'm going to group the items by shop and date-block (month) and then grab the last entry for each group. 
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperGroup</span><span class="p">:</span>
    <span class="sd">"""Super Set grouped</span>

<span class="sd">    Args:</span>
<span class="sd">     groups: list of columns to form the groups</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">,</span>
			       <span class="n">DataKeys</span><span class="o">.</span><span class="n">shop</span><span class="p">,</span>
			       <span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">]):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""cleaned super set of data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="n">SuperClean</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the super group data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_set</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_group</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">32</td>
<td class="org-right">221</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">33</td>
<td class="org-right">347</td>
<td class="org-right">1</td>
<td class="org-right">37</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">35</td>
<td class="org-right">247</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">43</td>
<td class="org-right">221</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">51</td>
<td class="org-right">127</td>
<td class="org-right">1</td>
<td class="org-right">57</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orgf738f9b" class="outline-4">
<h4 id="orgf738f9b">Re-add the missing columns</h4>
<div class="outline-text-4" id="text-orgf738f9b">
<p>
Now we need to get the category id, price, etc, back into the grouped data by merging it with the de-duplicated one we just created.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MergeChunked</span><span class="p">:</span>
    <span class="sd">"""merge the super-set and the chunked data"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_group</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chunked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="o">=</span> <span class="n">Chunked</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_group</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_group</span> <span class="o">=</span> <span class="n">SuperGroup</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_group</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_group</span><span class="p">,</span>
			<span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">,</span>
			    <span class="n">DataKeys</span><span class="o">.</span><span class="n">shop</span><span class="p">,</span>
			    <span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">],</span>
			<span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""save the data as a pickle"""</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">grouped</span><span class="p">)</span>
	<span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">chunked</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_count_month</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">32</td>
<td class="org-right">6</td>
<td class="org-right">221</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">33</td>
<td class="org-right">3</td>
<td class="org-right">347</td>
<td class="org-right">1</td>
<td class="org-right">37</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">35</td>
<td class="org-right">1</td>
<td class="org-right">247</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">43</td>
<td class="org-right">1</td>
<td class="org-right">221</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">51</td>
<td class="org-right">2</td>
<td class="org-right">127</td>
<td class="org-right">1</td>
<td class="org-right">57</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org0ce6468" class="outline-4">
<h4 id="org0ce6468">Save the grouped-up data</h4>
<div class="outline-text-4" id="text-org0ce6468">
<p>
I'm calling it <code>grouped_months_data.pkl</code>, but since the name is in the <code>Pickles</code> class, I'll just have to remember to use <code>grouped</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org75c74a7" class="outline-2">
<h2 id="org75c74a7">Creating the Validation Set</h2>
<div class="outline-text-2" id="text-org75c74a7">
<p>
To make my validation and training set I'm going to use sklearn's <a href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html">train_test_split</a>. 
</p>
</div>
<div id="outline-container-org6542f5b" class="outline-3">
<h3 id="org6542f5b">Targets and Features</h3>
<div class="outline-text-3" id="text-org6542f5b">
<p>
First we need to split the data up into inputs and targets
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TrainValidation</span><span class="p">:</span>
    <span class="sd">"""Makes the training and validation sets</span>

<span class="sd">    Args:</span>
<span class="sd">     test_size: fraction of data to use as validaiton data</span>
<span class="sd">     seed: random seed</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2018</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="n">test_size</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_features</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_x_train</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_x_test</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_y_test</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chunked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the data chunked by month"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="o">=</span> <span class="n">MergeChunked</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the target data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="p">[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The feature data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="p">[</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span>
		    <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">,</span>
						<span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span><span class="p">])]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_train</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_train</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_test</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_test</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_test</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_test</span>

    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_x_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
	    <span class="n">test_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">test_size</span><span class="p">,</span>
	    <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
	<span class="p">)</span>
	<span class="k">return</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""stores the data-files"""</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">x_train</span><span class="p">)</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">x_test</span><span class="p">)</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span>
	<span class="k">return</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""checks the columns for the data"""</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"Features has target"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"x_train has target"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"x_test has target"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"Features has day count"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"x_train has day count"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"x_test has day count"</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">,</span> <span class="s2">"Target not month count"</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">,</span> <span class="s2">"y-test not month count"</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">,</span> <span class="s2">"y-train not month count"</span>
	<span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

<p>
(1609124,)
(1609124, 7)
</p>
</div>
</div>

<div id="outline-container-org3c6f7d6" class="outline-3">
<h3 id="org3c6f7d6">Make Like a Banana</h3>
<div class="outline-text-3" id="text-org3c6f7d6">
<p>
I'm going to create a training set with 80% of the data and leave the other 20% as the validation data.
</p>

<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">TrainValidation</span><span class="p">()</span>
    <span class="n">data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

<p>
(1287299, 7)
(321825, 7)
(1287299,)
(321825,)
</p>

<p>
So now we're set to get started.
</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/feature-extraction-from-text-and-images/" class="u-url">Feature Extraction From Text and Images</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/feature-extraction-from-text-and-images/" rel="bookmark"><time class="published dt-published" datetime="2018-08-13T07:17:52-07:00" title="2018-08-13 07:17">2018-08-13 07:17</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/feature-extraction-from-text-and-images/#org74c7872">How do you convert text to data?</a></li>
<li><a href="posts/feature-extraction-from-text-and-images/#orga937f80">Practice Quiz</a></li>
<li><a href="posts/feature-extraction-from-text-and-images/#orga832511">Quiz</a></li>
<li><a href="posts/feature-extraction-from-text-and-images/#org6ebf169">Links</a></li>
</ul>
</div>
</div>

<div id="outline-container-org74c7872" class="outline-2">
<h2 id="org74c7872">How do you convert text to data?</h2>
<div class="outline-text-2" id="text-org74c7872">
</div>
<div id="outline-container-org274b922" class="outline-3">
<h3 id="org274b922">Two Main Methods</h3>
<div class="outline-text-3" id="text-org274b922">
</div>
<div id="outline-container-org47dbf05" class="outline-4">
<h4 id="org47dbf05">Bag Of Words</h4>
<div class="outline-text-4" id="text-org47dbf05">
</div>
<ul class="org-ul">
<li>
<a id="orgb8c8631"></a>Vectorization<br><div class="outline-text-5" id="text-orgb8c8631">
<p>
This method counts the number of occurrences of each word in the source. For each word it creates a column and then in the row puts the counts for that instance of data.
</p>
<ul class="org-ul">
<li>Sklearn implements this with <a href="http://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">CountVectorizer</a>
</li>
</ul>
</div>
</li>
<li>
<a id="orga56eb05"></a>Term Frequency/Inverse Document Frequency (TF/IDF)<br><div class="outline-text-5" id="text-orga56eb05">
<p>
This method tries to make word counts comparable even if the texts are of different sizes and also to emphasize more important words.
</p>
<ul class="org-ul">
<li>Term Frequency: Normalize rows so all values are from 0 to 1 to make texts of different sizes comparable</li>
<li>Inverse Document Frequency: Normalize columns to make emphasize more important features</li>
<li>Sklearn implements this with <a href="http://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html">TfidVectorizer</a>
</li>
</ul>
</div>
</li>
<li>
<a id="org04f849d"></a>N-Grams<br><div class="outline-text-5" id="text-org04f849d">
<p>
This method that creates a bag of words by grouping them into sub-sequences of words. A 3-gram, for instance, sweeps the text to create sequences of words made up of 3 adjacent words.
</p>
<ul class="org-ul">
<li>
<a href="http://sklearn.feature_extraction.text.countvectorizer">Count Vectorizer</a> is sklearn's implementation</li>
</ul>
</div>
</li>
<li>
<a id="orgef78e4c"></a>Text Preprocessing<br><div class="outline-text-5" id="text-orgef78e4c">
<ul class="org-ul">
<li>lowercase
Change all the words to lower-case</li>
<li>lemmatization
Try to reduce word to a common case (e.g. democratization, democracy, democratic all become democracy)</li>
<li>stemming
Try to reduce word to a root (e.g. democratization, democracy, democratic all become democ)</li>
<li>stopwords
Remove common words (e.g. a, and, or, etc.)</li>
</ul>
</div>
</li>
<li>
<a id="orge8c4797"></a>The Bag Of Words Pipeline<br><div class="outline-text-5" id="text-orge8c4797">
<ol class="org-ol">
<li>Preprocessing (lowercase, lemmatization, stemming, stopwords)</li>
<li>Create n-grams</li>
<li>Postprocessing: TF/IDF</li>
</ol>
</div>
</li>
</ul>
</div>
<div id="outline-container-org83df017" class="outline-4">
<h4 id="org83df017">Embeddings (e.g. Word2Vec)</h4>
<div class="outline-text-4" id="text-org83df017">
<ul class="org-ul">
<li>Uses neural-nets</li>
<li>much smaller vectors than bag of words</li>
<li>But each word gets a vector so many more vectors</li>
<li>similar words have similar word-vectors</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-orga937f80" class="outline-2">
<h2 id="orga937f80">Practice Quiz</h2>
<div class="outline-text-2" id="text-orga937f80">
</div>
<div id="outline-container-org1b7954e" class="outline-3">
<h3 id="org1b7954e">One</h3>
<div class="outline-text-3" id="text-org1b7954e">
<p>
TF-IDF is applied to a matrix where each column represents a word, each row represents a document, and each value shows the number of times a particular word occurred in a particular document. Choose the correct statements.
</p>
<ul class="org-ul">
<li class="on">
<code>[X]</code> IDF scales features inversely proprotionally to a number of word occurrences over documents</li>
<li class="off">
<code>[ ]</code> IDF scales features proportionally to the frequency of the a word's occurrences</li>
<li class="on">
<code>[X]</code> TF normalizes sums of the row values to 1</li>
<li class="off">
<code>[ ]</code> TF normalizes sums of the column values to 1</li>
</ul>
</div>
</div>
<div id="outline-container-org9830be7" class="outline-3">
<h3 id="org9830be7">Two</h3>
<div class="outline-text-3" id="text-org9830be7">
<p>
Which of these methods can be used to preprocess text?
</p>
<ul class="org-ul">
<li class="on">
<code>[X]</code> stemming</li>
<li class="on">
<code>[X]</code> Lower-case transformation</li>
<li class="on">
<code>[X]</code> Lemmatization</li>
<li class="on">
<code>[X]</code> Stopword removal</li>
<li class="off">
<code>[ ]</code> Levenshteining</li>
<li class="off">
<code>[ ]</code> plumping</li>
<li class="off">
<code>[ ]</code> plumbing</li>
</ul>
</div>
</div>
<div id="outline-container-org7757a35" class="outline-3">
<h3 id="org7757a35">Three</h3>
<div class="outline-text-3" id="text-org7757a35">
<p>
What is the main purpose of lemmatization and stemming?
</p>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> to remove words which are not useful</li>
<li class="on">
<code>[X]</code> to remove inflectional forms and sometimes derivationally related forms of a word to a common base form</li>
<li class="off">
<code>[ ]</code> To reduce the significance of common words</li>
<li class="off">
<code>[ ]</code> to induce common word amplification standards to the most useful for machine learning algorithms form</li>
</ul>
</div>
</div>
<div id="outline-container-org916272d" class="outline-3">
<h3 id="org916272d">Four</h3>
<div class="outline-text-3" id="text-org916272d">
<p>
To learn Word2Vec embeddings we need:
</p>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> GloVe embeddings</li>
<li class="off">
<code>[ ]</code> Labels for the documents in the corpora</li>
<li class="on">
<code>[X]</code> Labels for each word in the documents in the corpora</li>
<li class="on">
<code>[X]</code> Text corpora</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orga832511" class="outline-2">
<h2 id="orga832511">Quiz</h2>
<div class="outline-text-2" id="text-orga832511">
</div>
<div id="outline-container-org288ffdf" class="outline-3">
<h3 id="org288ffdf">One</h3>
<div class="outline-text-3" id="text-org288ffdf">
<p>
Select true statements about n-grams.
</p>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> Levenshteining should always be applied before computing n-grams (there is no such thing as Levenshteining)</li>
<li class="off">
<code>[ ]</code> n-grams always help increase significance of important words (n-grams are about counts, not importance)</li>
<li class="on">
<code>[X]</code> n-grams features are typically sparse (n-grams count occurrences of words and not every word will be found in every document)</li>
<li class="on">
<code>[X]</code> n-grams can help utilize local context around each word (n-grams encode sequences of words)</li>
</ul>
</div>
</div>
<div id="outline-container-org34de6b2" class="outline-3">
<h3 id="org34de6b2">Two</h3>
<div class="outline-text-3" id="text-org34de6b2">
<p>
Select the true statements.
</p>
<ul class="org-ul">
<li class="on">
<code>[X]</code> Bag of words usually produces longer vectors than Word2Vec (The number of features with BOW is equal to the number of unique words, Word2Vec limit is set beforehand)</li>
<li class="on">
<code>[X]</code> Semantically similar words usually have similar word2vec embeddings</li>
<li class="off">
<code>[ ]</code> You do not need bag of words features in a competition if you have word2vec features (both approaches are useful and can work together)
<ul class="org-ul">
<li class="off">
<code>[ ]</code> The meaning of each value in the Bag of Words matrix is unknown (The meaning of each value is how many times it occurred)</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org4c77f05" class="outline-3">
<h3 id="org4c77f05">Three</h3>
<div class="outline-text-3" id="text-org4c77f05">
<p>
Suppose in a new competition we are given a dataset of 2D medical images. We want to extract image descriptors from a hidden layer of a neural network pretrained on the ImageNet dataset. We will then use extracted descriptors to train a simple logistic regression model to classify images from our dataset.
</p>

<p>
We are considering using two networks: ResNet-50 with an ImageNet accuracy of X and VGG-16 with an ImageNet accuracy of Y (X &lt; Y). Select the true statements.
</p>

<ul class="org-ul">
<li class="off">
<code>[ ]</code> With one pretrained CNN model you can get only one vector of descriptors for an image</li>
<li class="off">
<code>[ ]</code> Descriptors from ResNet 50 will always be better than the ones from VG-16 in our pipeline</li>
<li class="on">
<code>[X]</code> It is not clear what descriptors are better on our dataset. We should evaluate both.
<ul class="org-ul">
<li class="off">
<code>[ ]</code> Descriptors from ResNet-50 and VGG-16 are always very similar in cosine distance</li>
<li class="off">
<code>[ ]</code> For any image, descriptors from the last hidden layer of ResNet-50 are the same as the descriptors from the last hidden layer of VGG-16</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org8c22edd" class="outline-3">
<h3 id="org8c22edd">Four</h3>
<div class="outline-text-3" id="text-org8c22edd">
<p>
Data augmentation can be used at (1) train time and (2) test time
</p>
<ul class="org-ul">
<li class="off">
<code>[ ]</code> True, False</li>
<li class="off">
<code>[ ]</code> False, True</li>
<li class="on">
<code>[X]</code> True, True</li>
<li class="off">
<code>[ ]</code> False, False</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org6ebf169" class="outline-2">
<h2 id="org6ebf169">Links</h2>
<div class="outline-text-2" id="text-org6ebf169">
</div>
<div id="outline-container-org8c5af0f" class="outline-3">
<h3 id="org8c5af0f">Text</h3>
<div class="outline-text-3" id="text-org8c5af0f">
</div>
<div id="outline-container-orgd94221f" class="outline-4">
<h4 id="orgd94221f">Bag Of Words</h4>
<div class="outline-text-4" id="text-orgd94221f">
<ul class="org-ul">
<li><a href="http://scikit-learn.org/stable/modules/feature_extraction.html">SKlearn on feature extraction</a></li>
<li>
<a href="https://andhint.github.io/machine-learning/nlp/Feature-Extraction-From-Text/">blog post</a> on extracting features from text</li>
</ul>
</div>
</div>
<div id="outline-container-org5740868" class="outline-4">
<h4 id="org5740868">Word2Vec</h4>
<div class="outline-text-4" id="text-org5740868">
<ul class="org-ul">
<li><a href="https://www.tensorflow.org/tutorials/representation/word2vec">TensorFlow tutorial</a></li>
<li>
<a href="https://rare-technologies.com/word2vec-tutorial/">Blog post tutorial</a> by the author of gensim</li>
<li><a href="https://nadbordrozd.github.io/blog/2016/05/20/text-classification-with-word2vec/">Text Classification post</a></li>
<li><a href="https://taylorwhitten.github.io/blog/word2vec">Another introduction</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgb566b02" class="outline-4">
<h4 id="orgb566b02">Natural Language Processing with Python</h4>
<div class="outline-text-4" id="text-orgb566b02">
<ul class="org-ul">
<li><a href="http://www.nltk.org/">nltk</a></li>
<li><a href="https://textblob.readthedocs.io/en/dev/">TextBlob</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orga03e1f7" class="outline-3">
<h3 id="orga03e1f7">Images</h3>
<div class="outline-text-3" id="text-orga03e1f7">
</div>
<div id="outline-container-org301a6c6" class="outline-4">
<h4 id="org301a6c6">Pre-trained Models</h4>
<div class="outline-text-4" id="text-org301a6c6">
<ul class="org-ul">
<li><a href="https://keras.io/applications/">Keras</a></li>
<li><a href="https://www.kernix.com/blog/image-classification-with-a-pre-trained-deep-neural-network_p11">How To use a pre-trained model</a></li>
</ul>
</div>
</div>
<div id="outline-container-orge2b3820" class="outline-4">
<h4 id="orge2b3820">Fine-Tuning</h4>
<div class="outline-text-4" id="text-orge2b3820">
<ul class="org-ul">
<li><a href="https://www.tensorflow.org/hub/tutorials/image_retraining">Re-train a tensorflow image classifier</a></li>
<li><a href="https://flyyufelix.github.io/2016/10/08/fine-tuning-in-keras-part2.html">Fine-tuning deep learning models in keras</a></li>
</ul>
</div>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/first-naive-try/" class="u-url">First Naive Try</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/first-naive-try/" rel="bookmark"><time class="published dt-published" datetime="2018-08-11T19:37:37-07:00" title="2018-08-11 19:37">2018-08-11 19:37</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/first-naive-try/#org6a9b6df">Introduction</a></li>
<li><a href="posts/first-naive-try/#orgdf4f390">Imports</a></li>
<li><a href="posts/first-naive-try/#orgaff2504">Loading the Data</a></li>
<li><a href="posts/first-naive-try/#orgad199c8">November Only</a></li>
<li><a href="posts/first-naive-try/#orgf6caac3">The Linear Model</a></li>
</ul>
</div>
</div>
<div id="outline-container-org6a9b6df" class="outline-2">
<h2 id="org6a9b6df">Introduction</h2>
<div class="outline-text-2" id="text-org6a9b6df">
<p>
Our goal is to predict the number of sales for each shop for November 2015 (based on the prior months). I'm going to make some very naive guesses here with some models that only use the prior dates and the target counts.
</p>
</div>
</div>
<div id="outline-container-orgdf4f390" class="outline-2">
<h2 id="orgdf4f390">Imports</h2>
<div class="outline-text-2" id="text-orgdf4f390">
</div>
<div id="outline-container-org5297699" class="outline-3">
<h3 id="org5297699">Python Standard Library</h3>
<div class="outline-text-3" id="text-org5297699">
<div class="highlight"><pre><span></span># python standard library
import warnings
import os
import pickle
</pre></div>
</div>
</div>

<div id="outline-container-org1e06f9e" class="outline-3">
<h3 id="org1e06f9e">Supress the Warnings</h3>
<div class="outline-text-3" id="text-org1e06f9e">
<div class="highlight"><pre><span></span>warnings.filterwarnings("ignore", message="numpy.dtype size changed")
warnings.filterwarnings("ignore", message="numpy.ufunc size changed")
</pre></div>
</div>
</div>

<div id="outline-container-org1f76a2f" class="outline-3">
<h3 id="org1f76a2f">From pypi</h3>
<div class="outline-text-3" id="text-org1f76a2f">
<div class="highlight"><pre><span></span>import numpy
import pandas
from sklearn.metrics import mean_squared_error
from sklearn.model_selection import cross_val_score
from sklearn.ensemble import RandomTreesRegressor
from tabulate import tabulate
</pre></div>
</div>
</div>

<div id="outline-container-org6cdd4e0" class="outline-3">
<h3 id="org6cdd4e0">This Project</h3>
<div class="outline-text-3" id="text-org6cdd4e0">
<div class="highlight"><pre><span></span># this project
from helpers.helpers import (
    Helpers,
    DataSource,
    DataKeys,
    Pickles,
    )
</pre></div>
</div>
</div>
</div>
<div id="outline-container-orgaff2504" class="outline-2">
<h2 id="orgaff2504">Loading the Data</h2>
<div class="outline-text-2" id="text-orgaff2504">
<div class="highlight"><pre><span></span>x_train = Helpers.unpickle(Pickles.x_train)
x_test = Helpers.unpickle(Pickles.x_test)
y_train = Helpers.unpickle(Pickles.y_train)
y_test = Helpers.unpickle(Pickles.y_test)
</pre></div>

<p>
To make it easier to filter I'm going to combine the x and y data.
</p>

<div class="highlight"><pre><span></span>DataKeys.target = "Month Count"
x_train[DataKeys.target] = y_train.values
x_test[DataKeys.target] = y_test.values
</pre></div>

<div class="highlight"><pre><span></span>Helpers.print_head(x_train)
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">Month Count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">11</td>
<td class="org-right">15</td>
<td class="org-right">1324</td>
<td class="org-right">499</td>
<td class="org-right">55</td>
<td class="org-right">12</td>
<td class="org-right">2013</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">31</td>
<td class="org-right">19981</td>
<td class="org-right">499</td>
<td class="org-right">43</td>
<td class="org-right">07</td>
<td class="org-right">2014</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-right">32</td>
<td class="org-right">28</td>
<td class="org-right">7934</td>
<td class="org-right">398</td>
<td class="org-right">7</td>
<td class="org-right">09</td>
<td class="org-right">2015</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">43</td>
<td class="org-right">13518</td>
<td class="org-right">1499</td>
<td class="org-right">19</td>
<td class="org-right">01</td>
<td class="org-right">2014</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">28</td>
<td class="org-right">25</td>
<td class="org-right">19927</td>
<td class="org-right">329</td>
<td class="org-right">57</td>
<td class="org-right">05</td>
<td class="org-right">2015</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgad199c8" class="outline-2">
<h2 id="orgad199c8">November Only</h2>
<div class="outline-text-2" id="text-orgad199c8">
<p>
What happens if we only use the month of November in the data?
</p>

<div class="highlight"><pre><span></span>training = x_train[x_train.month == "11"]
</pre></div>

<div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div id="outline-container-orgf6caac3" class="outline-2">
<h2 id="orgf6caac3">The Linear Model</h2>
<div class="outline-text-2" id="text-orgf6caac3">
<p>
What happens if we just use the default linear regression model? The first problem we have is that we have both non-numeric data and categorical data. I think removing the <code>item_name</code> variable seems reasonable at this point, since we have unique <code>item_id</code> values for each item, although it's possible that some text-mining might reveal something in the names, because this is just a naive approach that will use linear regression.
</p>

<div class="highlight"><pre><span></span>del(x_train[DataKeys.name])
</pre></div>

<div class="highlight"><pre><span></span>regression = linear_model.LinearRegression()
regression.fit(x_train, y_train)
</pre></div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/exploring-the-data/" class="u-url">Exploring The Data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/exploring-the-data/" rel="bookmark"><time class="published dt-published" datetime="2018-08-11T15:26:40-07:00" title="2018-08-11 15:26">2018-08-11 15:26</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/exploring-the-data/#org0ee684d">Imports</a></li>
<li><a href="posts/exploring-the-data/#org8af51fe">The Tangle</a></li>
<li><a href="posts/exploring-the-data/#org6b4e49d">Helpers</a></li>
<li><a href="posts/exploring-the-data/#org7cf0494">Constants</a></li>
<li><a href="posts/exploring-the-data/#org749d6e3">The Files</a></li>
<li><a href="posts/exploring-the-data/#org39c0786">Some Counts</a></li>
<li><a href="posts/exploring-the-data/#org8be93ec">The Official Feature Descriptions</a></li>
<li><a href="posts/exploring-the-data/#org019513e">The Training Set</a></li>
</ul>
</div>
</div>
<div id="outline-container-org0ee684d" class="outline-2">
<h2 id="org0ee684d">Imports</h2>
<div class="outline-text-2" id="text-org0ee684d">
</div>
<div id="outline-container-org445967f" class="outline-3">
<h3 id="org445967f">Suppressing the Numpy Warnings</h3>
<div class="outline-text-3" id="text-org445967f">
<p>
When you import pandas you get some warnings:
</p>

<pre class="example">
/usr/lib/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility. Expected 96, got 88
  return f(*args, **kwds)
/usr/lib/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility. Expected 96, got 88
  return f(*args, **kwds)
</pre>

<p>
According to <a href="https://stackoverflow.com/questions/40845304/runtimewarning-numpy-dtype-size-changed-may-indicate-binary-incompatibility">Stack Overflow</a>, this is because <a href="https://www.scipy.org/">scipy</a> is built against an older version of <a href="http://www.numpy.org/">numpy</a>, but it shouldn't actually affect the way it works, so we should just suppress it.
</p>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.dtype size changed"</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.ufunc size changed"</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2832107" class="outline-3">
<h3 id="org2832107">The rest of the imports</h3>
<div class="outline-text-3" id="text-org2832107">
<div class="highlight"><pre><span></span><span class="c1"># python standard library</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>


<p>
<code>=====</code>
</p>
</div>
</div>
<div id="outline-container-orgd50493f" class="outline-3">
<h3 id="orgd50493f">This is used for the tangle</h3>
<div class="outline-text-3" id="text-orgd50493f">
<div class="highlight"><pre><span></span><span class="c1"># from pypi</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
</pre></div>
</div>
</div>
<div id="outline-container-org1bcd3df" class="outline-3">
<h3 id="org1bcd3df">Set up the plotting</h3>
<div class="outline-text-3" id="text-org1bcd3df">
<div class="highlight"><pre><span></span>% matplotlib inline
seaborn.set_style("whitegrid")
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org8af51fe" class="outline-2">
<h2 id="org8af51fe">The Tangle</h2>
<div class="outline-text-2" id="text-org8af51fe">
<p>
Exports so some of this can be re-used.
</p>
</div>
</div>

<div id="outline-container-org6b4e49d" class="outline-2">
<h2 id="org6b4e49d">Helpers</h2>
<div class="outline-text-2" id="text-org6b4e49d">
<p>
Just some functions that keep coming up.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Helpers</span><span class="p">:</span>
    <span class="sd">"""Helper functions"""</span>
    <span class="n">pickle_target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">"~/projects/kaggle-competitions/pickles/"</span><span class="p">)</span>
    <span class="n">pickle_target_string</span> <span class="o">=</span> <span class="n">pickle_target</span> <span class="o">+</span> <span class="s2">"{}.pkl"</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">print_head</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">"""prints the head of the given data frame</span>

<span class="sd">	Args:</span>
<span class="sd">	 frame (pandas.DataFrame): data frame to print as a table</span>
<span class="sd">	 showindex (bool): whether to print the index</span>
<span class="sd">	"""</span>
	<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span>
		       <span class="n">showindex</span><span class="o">=</span><span class="n">showindex</span><span class="p">))</span>
	<span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">print_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
	<span class="sd">"""print the data</span>

<span class="sd">	Args:</span>
<span class="sd">	 data: some kind of data-frame</span>
<span class="sd">	"""</span>
	<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span>
		       <span class="n">showindex</span><span class="o">=</span><span class="n">showindex</span><span class="p">))</span>
	<span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">pickle_it</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">"""save the object to a pickle in the data folder</span>

<span class="sd">	Args:</span>
<span class="sd">	 thing: object to pickle</span>
<span class="sd">	 name: thing to call the pickle</span>
<span class="sd">	"""</span>
	<span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">thing</span><span class="o">.</span><span class="vm">__name__</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
		<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
		    <span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_target_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
		<span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">pickler</span><span class="p">:</span>
	    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">pickler</span><span class="p">)</span>
	<span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">unpickle</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
	<span class="sd">"""loads the pickled object from the data folder</span>

<span class="sd">	Args:</span>
<span class="sd">	 name: name of the pickle without the folder or extension</span>

<span class="sd">	Returns:</span>
<span class="sd">	 object: the un-pickled object</span>
<span class="sd">	"""</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_target_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
		  <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">unpickler</span><span class="p">:</span>
	    <span class="n">unpickled</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">unpickler</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">unpickled</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
	<span class="sd">"""checks if the thing is already a pickle</span>

<span class="sd">	Args:</span>
<span class="sd">	 name: name of the pickle without folder or extension</span>

<span class="sd">	Returns:</span>
<span class="sd">	 bool: True if the pickle exists</span>
<span class="sd">	"""</span>
	<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_target_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7cf0494" class="outline-2">
<h2 id="org7cf0494">Constants</h2>
<div class="outline-text-2" id="text-org7cf0494">
<p>
As always, I'll try to put constants in the same place.
</p>
</div>
<div id="outline-container-org64be644" class="outline-3">
<h3 id="org64be644">Data Names</h3>
<div class="outline-text-3" id="text-org64be644">
<p>
This is just a re-mapping of the file-names since I keep forgetting them.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataNames</span><span class="p">:</span>
    <span class="sd">"""thing with the data-file-names (without extensions) as attributes"""</span>
    <span class="n">training</span> <span class="o">=</span> <span class="s2">"sales_train"</span>
    <span class="n">items</span> <span class="o">=</span> <span class="s2">"items"</span>
    <span class="n">item_categories</span> <span class="o">=</span> <span class="s2">"item_categories"</span>
    <span class="n">shops</span> <span class="o">=</span> <span class="s2">"shops"</span>
</pre></div>
</div>
</div>

<div id="outline-container-org393abec" class="outline-3">
<h3 id="org393abec">Data Source</h3>
<div class="outline-text-3" id="text-org393abec">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataSource</span><span class="p">:</span>
    <span class="sd">"""Strings for the files</span>

<span class="sd">    Args:</span>
<span class="sd">     directory: path to the data-folder</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s2">"~/projects/kaggle-competitions/data/"</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_file_names</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_file_name_paths</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The path to the data"""</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span>

    <span class="nd">@directory.setter</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
	<span class="sd">"""expands the user and saves the path</span>

<span class="sd">	Args:</span>
<span class="sd">	 path (str): path to the data folder</span>
<span class="sd">	"""</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="p">):</span>
	    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
		<span class="s2">"This file doesn't exist: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="p">))</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""list of file names in the data directory"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_names</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_file_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">))</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""list of paths to the file names"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
		    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">]</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_name_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""dict of name: path"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name_paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_file_name_paths</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">)}</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name_paths</span>

    <span class="k">def</span> <span class="nf">set_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""attaches the file names to this object"""</span>
	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">:</span>
	    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
	<span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4b211b0" class="outline-3">
<h3 id="org4b211b0">Data Keys</h3>
<div class="outline-text-3" id="text-org4b211b0">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataKeys</span><span class="p">:</span>
    <span class="sd">"""Column names/keys for the data."""</span>
    <span class="n">item_category</span> <span class="o">=</span> <span class="s2">"item_category_id"</span>
    <span class="n">shop</span> <span class="o">=</span> <span class="s2">"shop_id"</span>
    <span class="n">item</span> <span class="o">=</span> <span class="s2">"item_id"</span>
    <span class="n">date</span> <span class="o">=</span> <span class="s2">"date"</span>
    <span class="n">date_block</span> <span class="o">=</span> <span class="s2">"date_block_num"</span>
    <span class="n">price</span> <span class="o">=</span> <span class="s2">"item_price"</span>
    <span class="n">day_count</span> <span class="o">=</span> <span class="s2">"item_cnt_day"</span>
    <span class="n">month_count</span> <span class="o">=</span> <span class="s1">'item_count_month'</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"item_name"</span>
    <span class="n">day</span> <span class="o">=</span> <span class="s2">"day"</span>
    <span class="n">month</span> <span class="o">=</span> <span class="s2">"month"</span>
    <span class="n">year</span> <span class="o">=</span> <span class="s2">"year"</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">data_source</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">()</span>
<span class="n">data_source</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org749d6e3" class="outline-2">
<h2 id="org749d6e3">The Files</h2>
<div class="outline-text-2" id="text-org749d6e3">
<p>
These are the files we are given.
</p>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_source</span><span class="o">.</span><span class="n">file_names</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">" - {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</pre></div>

<ul class="org-ul">
<li>item_categories.csv</li>
<li>items.csv</li>
<li>sales_train.csv.gz</li>
<li>sample_submission.csv.gz</li>
<li>shops.csv</li>
<li>test.csv.gz</li>
</ul>
<p>
I was originally thinking I would need to unzip the gzipped files but apparently the <a href="https://pandas.pydata.org/pandas-docs/stable/io.html#io-read-csv-table"><code>Pandas.read_csv</code></a> function will decompress them automagically, so I guess I can leave them.
</p>

<div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="p">{</span><span class="n">data_source</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	  <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_source</span><span class="o">.</span><span class="n">paths</span><span class="p">)}</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">** {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>

<div id="outline-container-org446d5f8" class="outline-3">
<h3 id="org446d5f8">item_categories.csv</h3>
<div class="outline-text-3" id="text-org446d5f8">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_category_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">PC - Гарнитуры/Наушники</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PSP</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 84 entries, 0 to 83
Data columns (total 2 columns):
item_category_name    84 non-null object
item_category_id      84 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.4+ KB
None
</p>
</div>
</div>

<div id="outline-container-org82beb4a" class="outline-3">
<h3 id="org82beb4a">items.csv</h3>
<div class="outline-text-3" id="text-org82beb4a">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 22170 entries, 0 to 22169
Data columns (total 3 columns):
item_name           22170 non-null object
item_id             22170 non-null int64
item_category_id    22170 non-null int64
dtypes: int64(2), object(1)
memory usage: 519.7+ KB
None
</p>
</div>
</div>

<div id="outline-container-org14aa6d5" class="outline-3">
<h3 id="org14aa6d5">sales_train.csv.gz</h3>
<div class="outline-text-3" id="text-org14aa6d5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2935849 entries, 0 to 2935848
Data columns (total 6 columns):
date              object
date_block_num    int64
shop_id           int64
item_id           int64
item_price        float64
item_cnt_day      float64
dtypes: float64(2), int64(3), object(1)
memory usage: 134.4+ MB
None
</p>
</div>
</div>

<div id="outline-container-orgd967f54" class="outline-3">
<h3 id="orgd967f54">sample_submission.csv.gz</h3>
<div class="outline-text-3" id="text-orgd967f54">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">item_cnt_month</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">0.5</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 2 columns):
ID                214200 non-null int64
item_cnt_month    214200 non-null float64
dtypes: float64(1), int64(1)
memory usage: 3.3 MB
None
</p>
</div>
</div>

<div id="outline-container-org609b7ac" class="outline-3">
<h3 id="org609b7ac">shops.csv</h3>
<div class="outline-text-3" id="text-org609b7ac">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">shop_name</th>
<th scope="col" class="org-right">shop_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">!Якутск Орджоникидзе, 56 фран</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">!Якутск ТЦ "Центральный" фран</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Адыгея ТЦ "Мега"</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Балашиха ТРК "Октябрь-Киномир"</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Волжский ТЦ "Волга Молл"</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 60 entries, 0 to 59
Data columns (total 2 columns):
shop_name    60 non-null object
shop_id      60 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.0+ KB
None
</p>
</div>
</div>

<div id="outline-container-org8a88d1c" class="outline-3">
<h3 id="org8a88d1c">test.csv.gz</h3>
<div class="outline-text-3" id="text-org8a88d1c">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">5</td>
<td class="org-right">5037</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">5320</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">5</td>
<td class="org-right">5233</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">5</td>
<td class="org-right">5232</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">5268</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 3 columns):
ID         214200 non-null int64
shop_id    214200 non-null int64
item_id    214200 non-null int64
dtypes: int64(3)
memory usage: 4.9 MB
None
</p>
</div>
</div>
</div>

<div id="outline-container-org39c0786" class="outline-2">
<h2 id="org39c0786">Some Counts</h2>
<div class="outline-text-2" id="text-org39c0786">
</div>
<div id="outline-container-org8dfba4f" class="outline-3">
<h3 id="org8dfba4f">How much data is there in the training set?</h3>
<div class="outline-text-3" id="text-org8dfba4f">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {:,} rows in the training set."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">])))</span>
</pre></div>

<p>
There are 2,935,849 rows in the training set.
</p>
</div>
</div>

<div id="outline-container-orgf502243" class="outline-3">
<h3 id="orgf502243">How many shops are there?</h3>
<div class="outline-text-3" id="text-orgf502243">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {} shops."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">shops</span><span class="p">])))</span>
</pre></div>

<p>
There are 60 shops.
</p>
</div>
</div>

<div id="outline-container-org8a69099" class="outline-3">
<h3 id="org8a69099">How Many Items Are There?</h3>
<div class="outline-text-3" id="text-org8a69099">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {:,} items."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">items</span><span class="p">])))</span>
</pre></div>

<p>
There are 22,170 items.
</p>
</div>
</div>

<div id="outline-container-org0d8b21c" class="outline-3">
<h3 id="org0d8b21c">How Many Item Categories are there?</h3>
<div class="outline-text-3" id="text-org0d8b21c">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {:,} categories."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">item_categories</span><span class="p">])))</span>
</pre></div>

<p>
There are 84 categories.
</p>
</div>
</div>

<div id="outline-container-org1d47463" class="outline-3">
<h3 id="org1d47463">How many date-blocks are there?</h3>
<div class="outline-text-3" id="text-org1d47463">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {} date-blocks."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">][</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())))</span>
</pre></div>

<p>
There are 34 date-blocks.
</p>
</div>
</div>
</div>

<div id="outline-container-org8be93ec" class="outline-2">
<h2 id="org8be93ec">The Official Feature Descriptions</h2>
<div class="outline-text-2" id="text-org8be93ec">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Column Name</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">ID</td>
<td class="org-left">an Id that represents a (Shop, Item) tuple within the test set</td>
</tr>
<tr>
<td class="org-left">shop_id</td>
<td class="org-left">unique identifier of a shop</td>
</tr>
<tr>
<td class="org-left">item_id</td>
<td class="org-left">unique identifier of a product</td>
</tr>
<tr>
<td class="org-left">item_category_id</td>
<td class="org-left">unique identifier of item category</td>
</tr>
<tr>
<td class="org-left">item_cnt_day</td>
<td class="org-left">number of products sold. You are predicting a monthly amount of this measure</td>
</tr>
<tr>
<td class="org-left">item_price</td>
<td class="org-left">current price of an item</td>
</tr>
<tr>
<td class="org-left">date</td>
<td class="org-left">date in format dd/mm/yyyy</td>
</tr>
<tr>
<td class="org-left">date_block_num</td>
<td class="org-left">a consecutive month number, used for convenience. January 2013 is 0, February 2013 is 1,…, October 2015 is 33</td>
</tr>
<tr>
<td class="org-left">item_name</td>
<td class="org-left">name of item</td>
</tr>
<tr>
<td class="org-left">shop_name</td>
<td class="org-left">name of shop</td>
</tr>
<tr>
<td class="org-left">item_category_name</td>
<td class="org-left">name of item category</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org019513e" class="outline-2">
<h2 id="org019513e">The Training Set</h2>
<div class="outline-text-2" id="text-org019513e">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>

<p>
date               object
date_block_num      int64
shop_id             int64
item_id             int64
item_price        float64
item_cnt_day      float64
dtype: object
</p>
</div>

<div id="outline-container-orge4364c1" class="outline-3">
<h3 id="orge4364c1">Numeric Features</h3>
<div class="outline-text-3" id="text-orge4364c1">
<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_table</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left"> </th>
<th scope="col" class="org-right">count</th>
<th scope="col" class="org-right">mean</th>
<th scope="col" class="org-right">std</th>
<th scope="col" class="org-right">min</th>
<th scope="col" class="org-right">25%</th>
<th scope="col" class="org-right">50%</th>
<th scope="col" class="org-right">75%</th>
<th scope="col" class="org-right">max</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">date_block_num</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">14.5699</td>
<td class="org-right">9.42299</td>
<td class="org-right">0</td>
<td class="org-right">7</td>
<td class="org-right">14</td>
<td class="org-right">23</td>
<td class="org-right">33</td>
</tr>
<tr>
<td class="org-left">shop_id</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">33.0017</td>
<td class="org-right">16.227</td>
<td class="org-right">0</td>
<td class="org-right">22</td>
<td class="org-right">31</td>
<td class="org-right">47</td>
<td class="org-right">59</td>
</tr>
<tr>
<td class="org-left">item_id</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">10197.2</td>
<td class="org-right">6324.3</td>
<td class="org-right">0</td>
<td class="org-right">4476</td>
<td class="org-right">9343</td>
<td class="org-right">15684</td>
<td class="org-right">22169</td>
</tr>
<tr>
<td class="org-left">item_price</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">890.853</td>
<td class="org-right">1729.8</td>
<td class="org-right">-1</td>
<td class="org-right">249</td>
<td class="org-right">399</td>
<td class="org-right">999</td>
<td class="org-right">307980</td>
</tr>
<tr>
<td class="org-left">item_cnt_day</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">1.24264</td>
<td class="org-right">2.61883</td>
<td class="org-right">-22</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">2169</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgb869d73" class="outline-3">
<h3 id="orgb869d73">Categorical Features</h3>
<div class="outline-text-3" id="text-orgb869d73">
<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_table</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Categorical</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left"> </th>
<th scope="col" class="org-right">count</th>
<th scope="col" class="org-right">unique</th>
<th scope="col" class="org-right">top</th>
<th scope="col" class="org-right">freq</th>
</tr></thead>
<tbody><tr>
<td class="org-left">date</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">1034</td>
<td class="org-right">28.12.2013</td>
<td class="org-right">9434</td>
</tr></tbody>
</table>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/set-up-the-kaggle-command-line-command/" class="u-url">Set Up the Kaggle Command-Line Command</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/set-up-the-kaggle-command-line-command/" rel="bookmark"><time class="published dt-published" datetime="2018-08-11T13:37:44-07:00" title="2018-08-11 13:37">2018-08-11 13:37</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/set-up-the-kaggle-command-line-command/#org615e90f">Install the Command</a></li>
<li><a href="posts/set-up-the-kaggle-command-line-command/#org91e3109">Get Your Credentials</a></li>
<li><a href="posts/set-up-the-kaggle-command-line-command/#org2df4a2d">Test it out</a></li>
<li><a href="posts/set-up-the-kaggle-command-line-command/#org27c7035">The Actual API</a></li>
</ul>
</div>
</div>

<p>
These are my notes as I set up the command-line interface. The official instructions are in the <a href="https://github.com/Kaggle/kaggle-api">README on github</a>.
</p>

<div id="outline-container-org615e90f" class="outline-2">
<h2 id="org615e90f">Install the Command</h2>
<div class="outline-text-2" id="text-org615e90f">
<p>
The code is available through <a href="https://pypi.org/project/kaggle/">pypi</a> so you can install it through pip. Their instructions say to install it at the user-level but I'm doing it in a <code>virtualenv</code> so that actually doesn't work for me, instead I did a regular <code>pip</code> install (after installing <code>wheel</code>).
</p>

<pre class="example">
pip install kaggle
</pre>
</div>
</div>

<div id="outline-container-org91e3109" class="outline-2">
<h2 id="org91e3109">Get Your Credentials</h2>
<div class="outline-text-2" id="text-org91e3109">
</div>
<div id="outline-container-org003b2cb" class="outline-3">
<h3 id="org003b2cb">Download the JSON File From Kaggle</h3>
<div class="outline-text-3" id="text-org003b2cb">
<p>
Log in to your kaggle account and click on the <i>Account</i> menu (it's hidden until you hover over the drop-down widget).
</p>


<div class="figure">
<p><img src="posts/set-up-the-kaggle-command-line-command/kaggle_account_menu.png" alt="kaggle_account_menu.png"></p>
</div>

<p>
Scroll down to the <i>API</i> box and click on <b>Create New API Token</b>.
</p>


<div class="figure">
<p><img src="posts/set-up-the-kaggle-command-line-command/api_box.png" alt="api_box.png"></p>
</div>

<p>
This will start a file download, if it prompts you save it to your computer.
</p>


<div class="figure">
<p><img src="posts/set-up-the-kaggle-command-line-command/download_json.png" alt="download_json.png"></p>
</div>
</div>
</div>

<div id="outline-container-orga2349fb" class="outline-3">
<h3 id="orga2349fb">Set Up the File</h3>
<div class="outline-text-3" id="text-orga2349fb">
<p>
Store this file in a folder named <code>.kaggle</code>.
</p>

<pre class="example">
mkdir ~/.kaggle
mv ~/Downloads/kaggle.json ~/.kaggle/
</pre>

<p>
To be on the safe side, change the permissions on the file so that other users can't read it.
</p>

<pre class="example">
chmod 600 ~/.kaggle/kaggle.json
</pre>

<p>
If you look in the file you'll see that it just has a JSON object with your username and API key.
</p>

<pre class="example">
{"username":"bumblebee","key":"8b970a13a2cfcfb7a77bdb8b4effaebc"}
</pre>

<p>
The instructions say you could also export the values as environment variables, but I'll leave it like this for now.
</p>
</div>
</div>
</div>

<div id="outline-container-org2df4a2d" class="outline-2">
<h2 id="org2df4a2d">Test it out</h2>
<div class="outline-text-2" id="text-org2df4a2d">
<p>
It's a python command that uses the basic help system you would expect if you've used python command-line programs before.
</p>

<div class="highlight"><pre><span></span>kaggle --help
</pre></div>

<pre class="example">
usage: kaggle [-h] [-v] {competitions,c,datasets,d,kernels,k,config} ...

optional arguments:
  -h, --help            show this help message and exit
  -v, --version         show program's version number and exit

commands:
  {competitions,c,datasets,d,kernels,k,config}
                        Use one of:
                        competitions {list, files, download, submit, submissions, leaderboard}
                        datasets {list, files, download, create, version, init, metadata, status}
                        config {view, set, unset}
    competitions (c)    Commands related to Kaggle competitions
    datasets (d)        Commands related to Kaggle datasets
    kernels (k)         Commands related to Kaggle kernels
    config              Configuration settings
</pre>

<p>
For this project you would download the data like this (downloading to a folder named <code>data</code>).
</p>

<pre class="example">
kaggle competitions download -c competitive-data-science-final-project data
</pre>
</div>
</div>
<div id="outline-container-org27c7035" class="outline-2">
<h2 id="org27c7035">The Actual API</h2>
<div class="outline-text-2" id="text-org27c7035">
<p>
If you look under the hood the command is just doing REST calls. To make it programattic you could probably use <a href="http://docs.python-requests.org/en/master/">requests</a> or something similar to interact with it directly. You can see the calls you need to make by looking at the <a href="https://github.com/Kaggle/kaggle-api/blob/master/KaggleSwagger.yaml">swagger file</a>.
</p>
</div>

<div id="outline-container-orgdbc496b" class="outline-3">
<h3 id="orgdbc496b">How the CLI does it</h3>
<div class="outline-text-3" id="text-orgdbc496b">
<p>
If you look in the <code>kaggle.__init__.py</code> file in the repository you'll see these imports.
</p>

<div class="highlight"><pre><span></span>from kaggle.api.kaggle_api_extended import KaggleApi
from kaggle.api_client import ApiClient
</pre></div>

<p>
Then when the command-line is called to download the data set it does this.
</p>

<div class="highlight"><pre><span></span>api = KaggleApi(ApiClient())
api.competition_download_cli(competition=None, competition_opt="competitive-data-science-final-project", path="data")
</pre></div>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/the-competition/" class="u-url">The Competition</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/the-competition/" rel="bookmark"><time class="published dt-published" datetime="2018-08-11T13:14:17-07:00" title="2018-08-11 13:14">2018-08-11 13:14</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/the-competition/#orgcf9f54b">What is this about?</a></li>
<li><a href="posts/the-competition/#org33bed42">What is the data made up of?</a></li>
<li><a href="posts/the-competition/#org4a427b6">How will you be evaluated?</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgcf9f54b" class="outline-2">
<h2 id="orgcf9f54b">What is this about?</h2>
<div class="outline-text-2" id="text-orgcf9f54b">
<p>
This is about the <a href="https://www.kaggle.com/c/competitive-data-science-final-project">kaggle competition</a> to predict future sales based on prior sale data. You are given a data set made up of prior sales and asked to predict how much each product will sell over the next month.
</p>
</div>
</div>

<div id="outline-container-org33bed42" class="outline-2">
<h2 id="org33bed42">What is the data made up of?</h2>
<div class="outline-text-2" id="text-org33bed42">
</div>
<div id="outline-container-org405beab" class="outline-3">
<h3 id="org405beab">The Source</h3>
<div class="outline-text-3" id="text-org405beab">
<p>
The data comes from the <a href="http://1c.ru/eng/title.htm">1C Company</a>, a Russian company that describes themselves on their website like this.
</p>

<blockquote>
<p>
Founded in 1991 1C Company specializes in development, distribution, publishing and support of mass-market software.
</p>

<p>
At present 8000 dealers from 600 cities cooperate with 1C. About 7500 teams constitute the 1C:Franchising partner network,which is a main channel of value-adding for 1C products. Service-partners provide regular information and technological support for 1C software customers. The network of authorized training centers is also operating.
</p>

<p>
1C is the official distributor of such world-famous vendors as Microsoft, Novell, Borland, Symantec, ABBYY, Kaspersky Lab, ProMT, Eset Software and over 100 other software vendors. 1C offers more than 10 000 titles of software for office and home use. 
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org49a65fd" class="outline-3">
<h3 id="org49a65fd">Getting it</h3>
<div class="outline-text-3" id="text-org49a65fd">
<p>
It looks like the data-set is the same one that I used for the Pandas example, but I'll download it anyway to be safe.
</p>

<pre class="example">
mkdir data
kaggle competitions download competitive-data-science-final-project --path data
</pre>
</div>
</div>

<div id="outline-container-org3580325" class="outline-3">
<h3 id="org3580325">The Description</h3>
<div class="outline-text-3" id="text-org3580325">
<blockquote>
<p>
You are provided with daily historical sales data. The task is to forecast the total amount of products sold in every shop for the test set. Note that the list of shops and products slightly changes every month. Creating a robust model that can handle such situations is part of the challenge.
</p>
</blockquote>
</div>


<div id="outline-container-orgc417592" class="outline-4">
<h4 id="orgc417592">Files</h4>
<div class="outline-text-4" id="text-orgc417592">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">File Name</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">sales_train.csv</td>
<td class="org-left">the training set. Daily historical data from January 2013 to October 2015.</td>
</tr>
<tr>
<td class="org-left">test.csv</td>
<td class="org-left">the test set. You need to forecast the sales for these shops and products for November 2015.</td>
</tr>
<tr>
<td class="org-left">sample_submission.csv</td>
<td class="org-left">a sample submission file in the correct format.</td>
</tr>
<tr>
<td class="org-left">items.csv</td>
<td class="org-left">supplemental information about the items/products.</td>
</tr>
<tr>
<td class="org-left">item_categories.csv</td>
<td class="org-left">supplemental information about the items categories.</td>
</tr>
<tr>
<td class="org-left">shops.csv</td>
<td class="org-left">supplemental information about the shops.</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-org21c0d90" class="outline-4">
<h4 id="org21c0d90">Features</h4>
<div class="outline-text-4" id="text-org21c0d90">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Column Name</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">ID</td>
<td class="org-left">an Id that represents a (Shop, Item) tuple within the test set</td>
</tr>
<tr>
<td class="org-left">shop_id</td>
<td class="org-left">unique identifier of a shop</td>
</tr>
<tr>
<td class="org-left">item_id</td>
<td class="org-left">unique identifier of a product</td>
</tr>
<tr>
<td class="org-left">item_category_id</td>
<td class="org-left">unique identifier of item category</td>
</tr>
<tr>
<td class="org-left">item_cnt_day</td>
<td class="org-left">number of products sold. You are predicting a monthly amount of this measure</td>
</tr>
<tr>
<td class="org-left">item_price</td>
<td class="org-left">current price of an item</td>
</tr>
<tr>
<td class="org-left">date</td>
<td class="org-left">date in format dd/mm/yyyy</td>
</tr>
<tr>
<td class="org-left">date_block_num</td>
<td class="org-left">a consecutive month number, used for convenience. January 2013 is 0, February 2013 is 1,…, October 2015 is 33</td>
</tr>
<tr>
<td class="org-left">item_name</td>
<td class="org-left">name of item</td>
</tr>
<tr>
<td class="org-left">shop_name</td>
<td class="org-left">name of shop</td>
</tr>
<tr>
<td class="org-left">item_category_name</td>
<td class="org-left">name of item category</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

<div id="outline-container-org4a427b6" class="outline-2">
<h2 id="org4a427b6">How will you be evaluated?</h2>
<div class="outline-text-2" id="text-org4a427b6">
</div>
<div id="outline-container-org347dc2e" class="outline-3">
<h3 id="org347dc2e">Submission Format</h3>
<div class="outline-text-3" id="text-org347dc2e">
<p>
You will submit a comma-separated file with two columns, the product ID and the total number of sales. It should look like this.
</p>

<pre class="example">
ID,item_cnt_month
0,5
1,3
2,6
</pre>
</div>
</div>

<div id="outline-container-org7d3bf4f" class="outline-3">
<h3 id="org7d3bf4f">Scoring</h3>
<div class="outline-text-3" id="text-org7d3bf4f">
<p>
You will be scored base on the <a href="https://en.wikipedia.org/wiki/Root-mean-square_deviation">Root Mean Square Error (RMSE)</a>. The page says that the true target values are clipped to the <code>[0,20]</code> range and the example given shows <code>0.5</code> as the <code>item_cnt_month</code> values, neither of which makes any sense to me at the moment.
</p>
</div>
</div>
<div id="outline-container-org1a56c84" class="outline-3">
<h3 id="org1a56c84">The meaning of the target</h3>
<div class="outline-text-3" id="text-org1a56c84">
<p>
According to <a href="https://www.kaggle.com/c/competitive-data-science-final-project/discussion/48251">this thread</a> you need to <a href="https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.clip.html">clip</a> the predictions back to that range (make anything less than zero a zero and anything more than twenty a twenty).
</p>
</div>
</div>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-1.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2018         <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
