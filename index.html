<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Notes on studying kaggle.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Notes on Kaggle</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Kaggle-Competitions/">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script><link rel="prefetch" href="posts/preprocessing-the-kaggle-data/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/Kaggle-Competitions/">

                <span id="blog-title">Notes on Kaggle</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="active">
<a href=".">The Cloistered Monkey <span class="sr-only">(active)</span></a>
                </li>
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/Kaggle-Competitions/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/preprocessing-the-kaggle-data/" class="u-url">Preprocessing the Kaggle Data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/preprocessing-the-kaggle-data/" rel="bookmark"><time class="published dt-published" datetime="2018-08-25T13:05:56-07:00" title="2018-08-25 13:05">2018-08-25 13:05</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org2d93121" class="outline-2">
<h2 id="org2d93121">Introduction</h2>
<div class="outline-text-2" id="text-org2d93121">
<p>
This is a post to do some basic pre-processing on the data. It won't do anything fancy (i.e. no Feature Engineering), but will just get the data ready to be used by the models. In particular, the rules say that the test data target will be limited to a range and the features are categorical so we need to transform them for non-tree models.
</p>
</div>
</div>
<div id="outline-container-org888f96d" class="outline-2">
<h2 id="org888f96d">Tangle</h2>
<div class="outline-text-2" id="text-org888f96d">
<div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">pypi</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">local</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">clip</span><span class="o">-</span><span class="n">it</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
</div>
<div id="outline-container-org93b1991" class="outline-2">
<h2 id="org93b1991">Imports</h2>
<div class="outline-text-2" id="text-org93b1991">
</div>
<div id="outline-container-org413172e" class="outline-3">
<h3 id="org413172e">From pypi</h3>
<div class="outline-text-3" id="text-org413172e">
<div class="highlight"><pre><span></span>import numpy
</pre></div>
</div>
</div>

<div id="outline-container-org0e22c2e" class="outline-3">
<h3 id="org0e22c2e">This project</h3>
<div class="outline-text-3" id="text-org0e22c2e">
<div class="highlight"><pre><span></span>from kaggler.helpers.build_training_data import Pickles
from kaggler.helpers.helpers import Helpers
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org8d77a47" class="outline-2">
<h2 id="org8d77a47">Loading the Data</h2>
<div class="outline-text-2" id="text-org8d77a47">
<div class="highlight"><pre><span></span>x_train = Helpers.unpickle(Pickles.x_train)
x_test = Helpers.unpickle(Pickles.x_test)
y_train = Helpers.unpickle(Pickles.y_train)
y_test = Helpers.unpickle(Pickles.y_test)
</pre></div>

<div class="highlight"><pre><span></span>print(x_train.shape)
print(x_test.shape)
print(y_train.shape)
print(y_test.shape)
</pre></div>
</div>
</div>

<div id="outline-container-orgc08c76f" class="outline-2">
<h2 id="orgc08c76f">Limit the Target Range</h2>
<div class="outline-text-2" id="text-orgc08c76f">
<p>
According to the contest description the true target values are clipped to the <code>[0,20]</code> range, so it might make sense to clip the target data in our training and testing data to the given range.
</p>

<div class="highlight"><pre><span></span>Helpers.print_head(x_test)
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date<sub>block</sub><sub>num</sub>
</th>
<th scope="col" class="org-right">shop<sub>id</sub>
</th>
<th scope="col" class="org-right">item<sub>id</sub>
</th>
<th scope="col" class="org-right">item<sub>price</sub>
</th>
<th scope="col" class="org-right">item<sub>category</sub><sub>id</sub>
</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">18</td>
<td class="org-right">48</td>
<td class="org-right">5440</td>
<td class="org-right">399</td>
<td class="org-right">55</td>
<td class="org-right">07</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">13</td>
<td class="org-right">5</td>
<td class="org-right">10487</td>
<td class="org-right">399</td>
<td class="org-right">40</td>
<td class="org-right">02</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">28</td>
<td class="org-right">12616</td>
<td class="org-right">98</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">20</td>
<td class="org-right">56</td>
<td class="org-right">18361</td>
<td class="org-right">299</td>
<td class="org-right">57</td>
<td class="org-right">09</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">35</td>
<td class="org-right">1249</td>
<td class="org-right">299</td>
<td class="org-right">55</td>
<td class="org-right">05</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span>Helpers.print_head(x_train)
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date<sub>block</sub><sub>num</sub>
</th>
<th scope="col" class="org-right">shop<sub>id</sub>
</th>
<th scope="col" class="org-right">item<sub>id</sub>
</th>
<th scope="col" class="org-right">item<sub>price</sub>
</th>
<th scope="col" class="org-right">item<sub>category</sub><sub>id</sub>
</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">11</td>
<td class="org-right">15</td>
<td class="org-right">1324</td>
<td class="org-right">499</td>
<td class="org-right">55</td>
<td class="org-right">12</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">31</td>
<td class="org-right">19981</td>
<td class="org-right">499</td>
<td class="org-right">43</td>
<td class="org-right">07</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">32</td>
<td class="org-right">28</td>
<td class="org-right">7934</td>
<td class="org-right">398</td>
<td class="org-right">7</td>
<td class="org-right">09</td>
<td class="org-right">2015</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">43</td>
<td class="org-right">13518</td>
<td class="org-right">1499</td>
<td class="org-right">19</td>
<td class="org-right">01</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">28</td>
<td class="org-right">25</td>
<td class="org-right">19927</td>
<td class="org-right">329</td>
<td class="org-right">57</td>
<td class="org-right">05</td>
<td class="org-right">2015</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/building-the-training-set/" class="u-url">Building The Training Set</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/building-the-training-set/" rel="bookmark"><time class="published dt-published" datetime="2018-08-25T09:31:43-07:00" title="2018-08-25 09:31">2018-08-25 09:31</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/building-the-training-set/#org82438b9">The Tangle</a></li>
<li><a href="posts/building-the-training-set/#orga319808">Imports</a></li>
<li><a href="posts/building-the-training-set/#org113b4ba">Helpers</a></li>
<li><a href="posts/building-the-training-set/#orga915c5b">Building Up the Super Set</a></li>
<li><a href="posts/building-the-training-set/#org346293b">Setting up the Training and Validation Data</a></li>
<li><a href="posts/building-the-training-set/#org75c74a7">Creating the Validation Set</a></li>
</ul>
</div>
</div>

<div id="outline-container-org82438b9" class="outline-2">
<h2 id="org82438b9">The Tangle</h2>
<div class="outline-text-2" id="text-org82438b9">
<p>
This is the exporter for stuff to be re-used outside of this post.
</p>
<div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">python</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">suppress</span><span class="o">-</span><span class="n">warnings</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">pypi</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">local</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">pickles</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">creator</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">data</span><span class="o">-</span><span class="n">source</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="nb">set</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">load</span><span class="o">-</span><span class="n">items</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="n">duper</span><span class="o">-</span><span class="nb">set</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="n">dates</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">clean</span><span class="o">-</span><span class="nb">super</span><span class="o">-</span><span class="nb">set</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">make</span><span class="o">-</span><span class="n">grouper</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">make</span><span class="o">-</span><span class="n">chunked</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="nb">super</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">merge</span><span class="o">-</span><span class="n">chunked</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">delete</span><span class="o">-</span><span class="n">day</span><span class="o">-</span><span class="n">count</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">targets</span><span class="o">-</span><span class="n">features</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">train</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">split</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga319808" class="outline-2">
<h2 id="orga319808">Imports</h2>
<div class="outline-text-2" id="text-orga319808">
</div>
<div id="outline-container-org8268ff2" class="outline-3">
<h3 id="org8268ff2">Python Standard Library</h3>
<div class="outline-text-3" id="text-org8268ff2">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge6397f2" class="outline-3">
<h3 id="orge6397f2">Suppressing the Numpy Warnings</h3>
<div class="outline-text-3" id="text-orge6397f2">
<p>
This is to suppress the warnings when we import pandas.
</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.dtype size changed"</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.ufunc size changed"</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd7ba4a4" class="outline-3">
<h3 id="orgd7ba4a4">From pypi</h3>
<div class="outline-text-3" id="text-orgd7ba4a4">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgee232e4" class="outline-3">
<h3 id="orgee232e4">This Project</h3>
<div class="outline-text-3" id="text-orgee232e4">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kaggler.helpers.helpers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataKeys</span><span class="p">,</span>
    <span class="n">DataNames</span><span class="p">,</span>
    <span class="n">DataSource</span><span class="p">,</span>
    <span class="n">Helpers</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org113b4ba" class="outline-2">
<h2 id="org113b4ba">Helpers</h2>
<div class="outline-text-2" id="text-org113b4ba">
</div>
<div id="outline-container-orge7249cc" class="outline-3">
<h3 id="orge7249cc">Pickles</h3>
<div class="outline-text-3" id="text-orge7249cc">
<p>
I'm going to pickle the data to re-load them later so this will hold the names.
</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Pickles</span><span class="p">:</span>
    <span class="sd">"""Holder of the pickle names"""</span>
    <span class="n">super_set</span> <span class="o">=</span> <span class="s2">"training_data"</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="s2">"grouped_months_data"</span>
    <span class="n">x_train</span> <span class="o">=</span> <span class="s2">"x_train"</span>
    <span class="n">x_test</span> <span class="o">=</span> <span class="s2">"x_test"</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="s2">"y_train"</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="s2">"y_test"</span>
    <span class="n">train_test</span> <span class="o">=</span> <span class="s2">"train_test"</span>
</pre></div>
</div>
</div>
</div>


<div id="outline-container-orga915c5b" class="outline-2">
<h2 id="orga915c5b">Building Up the Super Set</h2>
<div class="outline-text-2" id="text-orga915c5b">
<p>
Since we have some variables in separate sets I thought it would be useful to combine them into a single training set.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperSet</span><span class="p">:</span>
    <span class="sd">"""Creates the super-set of data"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>
</pre></div>
</div>

<div id="outline-container-orgdf67298" class="outline-3">
<h3 id="orgdf67298">The Data Source</h3>
<div class="outline-text-3" id="text-orgdf67298">
<p>
I put the paths into a class called DataSource, this is just to instantiate it.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">data_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""string-values for the data sources"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga3d07a2" class="outline-3">
<h3 id="orga3d07a2">Building the Super Set</h3>
<div class="outline-text-3" id="text-orga3d07a2">
<p>
The <code>super_set</code> will be a combination of the different data-sources.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""the super-set"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">data_sources</span><span class="o">.</span><span class="n">file_name_paths</span><span class="p">[</span><span class="n">DataNames</span><span class="o">.</span><span class="n">training</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2e4c1c6" class="outline-3">
<h3 id="org2e4c1c6">Adding the Category IDs</h3>
<div class="outline-text-3" id="text-org2e4c1c6">
<p>
The <code>items.csv</code> file holds a map of the item-ids to category-ids so we can <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.merge.html">merge</a> it in to get the category ids for our data-set.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Items</span><span class="p">:</span>
    <span class="sd">"""sale items data"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""a Data-Source object"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_sources</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""dataframe of sale items"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data_sources</span><span class="o">.</span><span class="n">file_name_paths</span><span class="p">[</span><span class="n">DataNames</span><span class="o">.</span><span class="n">items</span><span class="p">])</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
<p>
This is also going to add the name of the item, which I'm thinking won't be as useful, but we can clean that out later.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperDuper</span><span class="p">:</span>
    <span class="sd">"""super set with item counts"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""super-set of data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="n">SuperSet</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""sale-items data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="n">Items</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""super set with sale items"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_set</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
					      <span class="n">on</span><span class="o">=</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">,</span>
					      <span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span>

	    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_set</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
<td class="org-left">ЯВЛЕНИЕ 2012 (BD)</td>
<td class="org-right">37</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE  The House Of Blue Light  LP</td>
<td class="org-right">58</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
<td class="org-left">DEEP PURPLE  The House Of Blue Light  LP</td>
<td class="org-right">58</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE  Who Do You Think We Are  LP</td>
<td class="org-right">58</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE 30 Very Best Of 2CD (Фирм.)</td>
<td class="org-right">56</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org469c5e2" class="outline-3">
<h3 id="org469c5e2">Splitting the Dates</h3>
<div class="outline-text-3" id="text-org469c5e2">
<p>
The <code>date</code> column has a string formatted <code>dd.mm.yy</code>. Since we want sales per month and it might change over time, I'll split the date-stamp up into day, month, and year (although I don't think I'll be keeping day).
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperDates</span><span class="p">:</span>
    <span class="sd">"""Super-set with dates split out"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_duper</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_date_expression</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_dates</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_duper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""A super-duper data set"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_duper</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_duper</span> <span class="o">=</span> <span class="n">SuperDuper</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_duper</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">date_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""regular expression to parse the dates"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_date_expression</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_date_expression</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">'(?P&lt;{}&gt;\d{{2}})\.'</span>
				     <span class="s1">'(?P&lt;{}&gt;\d{{2}})\.'</span>
				     <span class="s1">'(?P&lt;{}&gt;\d{{4}})'</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
					 <span class="n">DataKeys</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
					 <span class="n">DataKeys</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
					 <span class="n">DataKeys</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_date_expression</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""dataframe of dates"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dates</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_duper</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">date_expression</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dates</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""data set with date columns"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
		<span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_duper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">),</span>
		<span class="n">axis</span><span class="o">=</span><span class="s1">'columns'</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"={}="</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date_expression</span><span class="p">))</span>
</pre></div>

<p>
<code>(?P&lt;day&gt;\d{2})\.(?P&lt;month&gt;\d{2})\.(?P&lt;year&gt;\d{4})</code>
</p>




<p>
Here's what <code>dates</code> looks like.
</p>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">03</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">05</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">06</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
<p>
Now we can smash our new data frame onto the transactions using the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.concat.html">concat</a> function. By default it will try to add the rows from the second data frame to the rows of the first, but since we're adding new columns we need to pass in the <code>axis='columns'</code> argument.
</p>

<p>
Nowe we can see what our <code>super_set</code> looks like.
</p>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
<td class="org-left">ЯВЛЕНИЕ 2012 (BD)</td>
<td class="org-right">37</td>
<td class="org-right">02</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE  The House Of Blue Light  LP</td>
<td class="org-right">58</td>
<td class="org-right">03</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
<td class="org-left">DEEP PURPLE  The House Of Blue Light  LP</td>
<td class="org-right">58</td>
<td class="org-right">05</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE  Who Do You Think We Are  LP</td>
<td class="org-right">58</td>
<td class="org-right">06</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
<td class="org-left">DEEP PURPLE 30 Very Best Of 2CD (Фирм.)</td>
<td class="org-right">56</td>
<td class="org-right">15</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org5c55d54" class="outline-3">
<h3 id="org5c55d54">Cleaning Up</h3>
<div class="outline-text-3" id="text-org5c55d54">
<p>
The <code>date</code> column is now superfluous, and I don't think we need the day, since we are predicting by month. I'm also going to assume that names aren't as useful as the numeric ids. This might not be true, but I think using the text would require pre-processing which is beyond what I'm doing here, so I'm going to leave them out (there is another file with shop names that needs to be loaded if the text turns out to be significant). I'm going to <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.drop.html">drop</a> the columns that I don't think I'll need.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperClean</span><span class="p">:</span>
    <span class="sd">"""The super-set data with extra columns removed"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="p">[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">day</span><span class="p">]):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">drop</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the super-set data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="n">SuperDates</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The cleaned data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_set</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""Saves the data as a pickle"""</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">super_set</span><span class="p">)</span>
	<span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
<td class="org-right">37</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
<td class="org-right">58</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
<td class="org-right">58</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
<td class="org-right">58</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
<td class="org-right">56</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgaeeef54" class="outline-3">
<h3 id="orgaeeef54">Saving the Super Set</h3>
<div class="outline-text-3" id="text-orgaeeef54">
<p>
Now I'll pickle it up so it can be loaded later.
</p>


<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="n">super_set</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">super_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org346293b" class="outline-2">
<h2 id="org346293b">Setting up the Training and Validation Data</h2>
<div class="outline-text-2" id="text-org346293b">
<p>
Although I went through the trouble of smashing all the values into one Data Frame, it turns out that I need things grouped by month, and doing the grouping after adding the columns just make it messy, so I'm going to back-track a little here to set up the data we need for training and testing.
</p>
</div>

<div id="outline-container-orgb087d57" class="outline-3">
<h3 id="orgb087d57">The Grouper</h3>
<div class="outline-text-3" id="text-orgb087d57">
<p>
Since I'm going to aggregate by the month (really the <code>date_block_num</code>), leaving in things like the price doesn't really make sense so I'll make a sub-frame that I can <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.groupby.html">group</a>.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Grouper</span><span class="p">:</span>
    <span class="sd">"""Data Grouped by month, shop, item"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_cleaned</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_grouper</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cleaned</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""cleaned super-set"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleaned</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_cleaned</span> <span class="o">=</span> <span class="n">SuperClean</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleaned</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">grouper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""goups the data by columns"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouper</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_grouper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned</span><span class="p">[[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">,</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">shop</span><span class="p">,</span>
					  <span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">,</span>
					  <span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouper</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the summed group-data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouper</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">,</span>
					       <span class="n">DataKeys</span><span class="o">.</span><span class="n">shop</span><span class="p">,</span>
					       <span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">grouped</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-right"></colgroup>
<thead><tr>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<p>
The reason why it looks like we lost most of the data is that the <code>groupy</code> method moved the groups into the index.
</p>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">grouped</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

<p>
                                item_cnt_day
date_block_num shop_id item_id              
0              0       32                6.0
                       33                3.0
                       35                1.0
                       43                1.0
                       51                2.0
</p>

<p>
So we're going to <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.reset_index.html">reset the index</a>, which will convert the <a href="https://pandas.pydata.org/pandas-docs/stable/advanced.html">multiindex</a> into columns. I'm also going to re-name the <code>item_cnt_day</code> column since it now represents the count for the whole month, not one day.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Chunked</span><span class="p">:</span>
    <span class="sd">"""Data set chunked-up to the months"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_grouped</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">grouped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""grouped data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouped</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_grouped</span> <span class="o">=</span> <span class="n">Grouper</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouped</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The chunked data with the counts renamed"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">grouped</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
		<span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span><span class="p">:</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">},</span>
		<span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">chunked</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_count_month</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">32</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">33</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">35</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">43</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">51</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org2195a9a" class="outline-3">
<h3 id="org2195a9a">Adding the Columns Back</h3>
<div class="outline-text-3" id="text-org2195a9a">
</div>
<div id="outline-container-org3d17bb1" class="outline-4">
<h4 id="org3d17bb1">Group the Super Set</h4>
<div class="outline-text-4" id="text-org3d17bb1">
<p>
Back to the super-set. Since there are multiple entries for items in a given month, I'm going to group the items by shop and date-block (month) and then grab the last entry for each group. 
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperGroup</span><span class="p">:</span>
    <span class="sd">"""Super Set grouped</span>

<span class="sd">    Args:</span>
<span class="sd">     groups: list of columns to form the groups</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">,</span>
			       <span class="n">DataKeys</span><span class="o">.</span><span class="n">shop</span><span class="p">,</span>
			       <span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">]):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""cleaned super set of data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span> <span class="o">=</span> <span class="n">SuperClean</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the super group data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_set</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">super_group</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">32</td>
<td class="org-right">221</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">33</td>
<td class="org-right">347</td>
<td class="org-right">1</td>
<td class="org-right">37</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">35</td>
<td class="org-right">247</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">43</td>
<td class="org-right">221</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">51</td>
<td class="org-right">127</td>
<td class="org-right">1</td>
<td class="org-right">57</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orgf738f9b" class="outline-4">
<h4 id="orgf738f9b">Re-add the missing columns</h4>
<div class="outline-text-4" id="text-orgf738f9b">
<p>
Now we need to get the category id, price, etc, back into the grouped data by merging it with the de-duplicated one we just created.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MergeChunked</span><span class="p">:</span>
    <span class="sd">"""merge the super-set and the chunked data"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_super_group</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chunked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="o">=</span> <span class="n">Chunked</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">super_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_group</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_super_group</span> <span class="o">=</span> <span class="n">SuperGroup</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_super_group</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_group</span><span class="p">,</span>
			<span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">,</span>
			    <span class="n">DataKeys</span><span class="o">.</span><span class="n">shop</span><span class="p">,</span>
			    <span class="n">DataKeys</span><span class="o">.</span><span class="n">item</span><span class="p">],</span>
			<span class="n">how</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""save the data as a pickle"""</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">grouped</span><span class="p">)</span>
	<span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">chunked</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_count_month</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">32</td>
<td class="org-right">6</td>
<td class="org-right">221</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">33</td>
<td class="org-right">3</td>
<td class="org-right">347</td>
<td class="org-right">1</td>
<td class="org-right">37</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">35</td>
<td class="org-right">1</td>
<td class="org-right">247</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">43</td>
<td class="org-right">1</td>
<td class="org-right">221</td>
<td class="org-right">1</td>
<td class="org-right">40</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">51</td>
<td class="org-right">2</td>
<td class="org-right">127</td>
<td class="org-right">1</td>
<td class="org-right">57</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org0ce6468" class="outline-4">
<h4 id="org0ce6468">Save the grouped-up data</h4>
<div class="outline-text-4" id="text-org0ce6468">
<p>
I'm calling it <code>grouped_months_data.pkl</code>, but since the name is in the <code>Pickles</code> class, I'll just have to remember to use <code>grouped</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org75c74a7" class="outline-2">
<h2 id="org75c74a7">Creating the Validation Set</h2>
<div class="outline-text-2" id="text-org75c74a7">
<p>
To make my validation and training set I'm going to use sklearn's <a href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html">train_test_split</a>. 
</p>
</div>
<div id="outline-container-org6542f5b" class="outline-3">
<h3 id="org6542f5b">Targets and Features</h3>
<div class="outline-text-3" id="text-org6542f5b">
<p>
First we need to split the data up into inputs and targets
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TrainValidation</span><span class="p">:</span>
    <span class="sd">"""Makes the training and validation sets</span>

<span class="sd">    Args:</span>
<span class="sd">     test_size: fraction of data to use as validaiton data</span>
<span class="sd">     seed: random seed</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2018</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="n">test_size</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_features</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_x_train</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_x_test</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_y_test</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chunked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the data chunked by month"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span> <span class="o">=</span> <span class="n">MergeChunked</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunked</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the target data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="p">[</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The feature data"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="p">[</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span>
		    <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">chunked</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">,</span>
						<span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span><span class="p">])]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_train</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_train</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_test</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_test</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_test</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_test</span>

    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_x_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
	    <span class="n">test_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">test_size</span><span class="p">,</span>
	    <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
	<span class="p">)</span>
	<span class="k">return</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""stores the data-files"""</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">x_train</span><span class="p">)</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">x_test</span><span class="p">)</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
	<span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_it</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">Pickles</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span>
	<span class="k">return</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""checks the columns for the data"""</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"Features has target"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"x_train has target"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"x_test has target"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"Features has day count"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"x_train has day count"</span>
	<span class="k">assert</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">day_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">"x_test has day count"</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">,</span> <span class="s2">"Target not month count"</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">,</span> <span class="s2">"y-test not month count"</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">DataKeys</span><span class="o">.</span><span class="n">month_count</span><span class="p">,</span> <span class="s2">"y-train not month count"</span>
	<span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

<p>
(1609124,)
(1609124, 7)
</p>
</div>
</div>

<div id="outline-container-org3c6f7d6" class="outline-3">
<h3 id="org3c6f7d6">Make Like a Banana</h3>
<div class="outline-text-3" id="text-org3c6f7d6">
<p>
I'm going to create a training set with 80% of the data and leave the other 20% as the validation data.
</p>

<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">TrainValidation</span><span class="p">()</span>
    <span class="n">data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

<p>
(1287299, 7)
(321825, 7)
(1287299,)
(321825,)
</p>

<p>
So now we're set to get started.
</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/feature-extraction-from-text-and-images/" class="u-url">Feature Extraction From Text and Images</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/feature-extraction-from-text-and-images/" rel="bookmark"><time class="published dt-published" datetime="2018-08-13T07:17:52-07:00" title="2018-08-13 07:17">2018-08-13 07:17</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/feature-extraction-from-text-and-images/#orge77c640">How do you convert text to data?</a></li>
</ul>
</div>
</div>

<div id="outline-container-orge77c640" class="outline-2">
<h2 id="orge77c640">How do you convert text to data?</h2>
<div class="outline-text-2" id="text-orge77c640">
</div>
<div id="outline-container-org2cffd91" class="outline-3">
<h3 id="org2cffd91">Two Main Methods</h3>
<div class="outline-text-3" id="text-org2cffd91">
</div>
<div id="outline-container-orgbf5f834" class="outline-4">
<h4 id="orgbf5f834">Bag Of Words</h4>
<div class="outline-text-4" id="text-orgbf5f834">
</div>
<ul class="org-ul">
<li>
<a id="orgab37c14"></a>Vectorization<br><div class="outline-text-5" id="text-orgab37c14">
<p>
This method counts the number of occurrences of each word in the source. For each word it creates a column and then in the row puts the counts for that instance of data.
</p>
<ul class="org-ul">
<li>Sklearn implements this with <a href="http://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">CountVectorizer</a>
</li>
</ul>
</div>
</li>
<li>
<a id="org03155df"></a>Term Frequency/Inverse Document Frequency (TF/IDF)<br><div class="outline-text-5" id="text-org03155df">
<p>
This method tries to make word counts comparable even if the texts are of different sizes and also to emphasize more important words.
</p>
<ul class="org-ul">
<li>Term Frequency: Normalize rows so all values are from 0 to 1 to make texts of different sizes comparable</li>
<li>Inverse Document Frequency: Normalize columns to make emphasize more important features</li>
<li>Sklearn implements this with <a href="http://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html">TfidVectorizer</a>
</li>
</ul>
</div>
</li>
<li>
<a id="orgc61dfb1"></a>N-Grams<br><div class="outline-text-5" id="text-orgc61dfb1">
<p>
This m
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgf207144" class="outline-4">
<h4 id="orgf207144">Embeddings (e.g. Word2Vec)</h4>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/first-naive-try/" class="u-url">First Naive Try</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/first-naive-try/" rel="bookmark"><time class="published dt-published" datetime="2018-08-11T19:37:37-07:00" title="2018-08-11 19:37">2018-08-11 19:37</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/first-naive-try/#org09f68a6">Introduction</a></li>
<li><a href="posts/first-naive-try/#org988476c">Imports</a></li>
<li><a href="posts/first-naive-try/#org708798b">Loading the Data</a></li>
<li><a href="posts/first-naive-try/#orga228bba">The Linear Model</a></li>
</ul>
</div>
</div>
<div id="outline-container-org09f68a6" class="outline-2">
<h2 id="org09f68a6">Introduction</h2>
<div class="outline-text-2" id="text-org09f68a6">
<p>
This is going to be a naive attempt to get this project running. If you look at the <a href="http://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">sklearn flowchart</a> and follow the path through regression with more than 100,000 samples (we have 1,287,299 entries in the training set (after splitting out the validation set from it)) you end up with two cases:
</p>

<ul class="org-ul">
<li>a few important features
<ul class="org-ul">
<li>lasso</li>
<li>electric net</li>
</ul>
</li>
<li>Many important Features
<ul class="org-ul">
<li>ridge regression</li>
<li>svr</li>
<li>ensemble regressors</li>
</ul>
</li>
</ul>
<p>
I kind of think there won't be too many important features, although I might be wrong. This chart might not be up-to-date, since it says that the ensemble regressors don't work, but I'm pretty sure Random Forest Regression is implemented. In any case, I'm going to see what each of the models does if I just use the defaults in order to get a baseline.
</p>
</div>
</div>
<div id="outline-container-org988476c" class="outline-2">
<h2 id="org988476c">Imports</h2>
<div class="outline-text-2" id="text-org988476c">
<div class="highlight"><pre><span></span># python standard library
import warnings
import os
import pickle

warnings.filterwarnings("ignore", message="numpy.dtype size changed")
warnings.filterwarnings("ignore", message="numpy.ufunc size changed")

# from pypi
import numpy
import pandas
from sklearn.metrics import mean_squared_error
from sklearn.model_selection import cross_val_score
from sklearn.ensemble import RandomTreesRegressor
from tabulate import tabulate

# this project
from helpers.helpers import (
    Helpers,
    DataSource,
    DataKeys,
    Pickles,
    )
</pre></div>
</div>
</div>
<div id="outline-container-org708798b" class="outline-2">
<h2 id="org708798b">Loading the Data</h2>
<div class="outline-text-2" id="text-org708798b">
<div class="highlight"><pre><span></span>DataSource = Helpers.unpickle("DataSource")
</pre></div>

<p>
This probably doesn't make sense anymore. Better to just get the random seed and use <code>train_test_split</code>, maybe.
</p>
<div class="highlight"><pre><span></span>x_train = Helpers.unpickle(Pickles.x_train)
x_test = Helpers.unpickle(Pickles.x_test)
y_train = Helpers.unpickle(Pickles.y_train)
y_test = Helpers.unpickle(Pickles.y_test)
</pre></div>

<div class="highlight"><pre><span></span>Helpers.print_head(x_train)
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_category_id</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">11</td>
<td class="org-right">15</td>
<td class="org-right">1324</td>
<td class="org-right">499</td>
<td class="org-left">ARMSTRONG LOUIS  Essential Collection  3CD</td>
<td class="org-right">55</td>
<td class="org-right">12</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">18</td>
<td class="org-right">31</td>
<td class="org-right">19981</td>
<td class="org-right">499</td>
<td class="org-left">Толстой Л.Н.  Война и мир  Роман-эпопея  4CD (mp3-CD) (Jewel)</td>
<td class="org-right">43</td>
<td class="org-right">07</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">32</td>
<td class="org-right">28</td>
<td class="org-right">7934</td>
<td class="org-right">398</td>
<td class="org-left">XOne: Пульт дистанционного управления для Xbox One [6DV-00006]</td>
<td class="org-right">7</td>
<td class="org-right">09</td>
<td class="org-right">2015</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">43</td>
<td class="org-right">13518</td>
<td class="org-right">1499</td>
<td class="org-left">Комплект Прогулки с динозаврами (только для PS Move) [PS3, русская версия] + Wonderbook</td>
<td class="org-right">19</td>
<td class="org-right">01</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">28</td>
<td class="org-right">25</td>
<td class="org-right">19927</td>
<td class="org-right">329</td>
<td class="org-left">Таривердиев М. Инструментальные кинохиты (подар. уп.) (mp3-CD) (Jewel)</td>
<td class="org-right">57</td>
<td class="org-right">05</td>
<td class="org-right">2015</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orga228bba" class="outline-2">
<h2 id="orga228bba">The Linear Model</h2>
<div class="outline-text-2" id="text-orga228bba">
<p>
What happens if we just use the default linear regression model? The first problem we have is that we have both non-numeric data and categorical data. I think removing the <code>item_name</code> variable seems reasonable at this point, since we have unique <code>item_id</code> values for each item, although it's possible that some text-mining might reveal something in the names, because this is just a naive approach that will use linear regression.
</p>

<div class="highlight"><pre><span></span>del(x_train[DataKeys.name])
</pre></div>

<div class="highlight"><pre><span></span>regression = linear_model.LinearRegression()
regression.fit(x_train, y_train)
</pre></div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/exploring-the-data/" class="u-url">Exploring The Data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/exploring-the-data/" rel="bookmark"><time class="published dt-published" datetime="2018-08-11T15:26:40-07:00" title="2018-08-11 15:26">2018-08-11 15:26</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/exploring-the-data/#org445c4f5">Imports</a></li>
<li><a href="posts/exploring-the-data/#org4618c3b">The Tangle</a></li>
<li><a href="posts/exploring-the-data/#org8c85771">Helpers</a></li>
<li><a href="posts/exploring-the-data/#org103e9bf">Constants</a></li>
<li><a href="posts/exploring-the-data/#orge3f8d10">The Files</a></li>
<li><a href="posts/exploring-the-data/#orgba3f6c4">Some Counts</a></li>
<li><a href="posts/exploring-the-data/#org9166d52">The Official Feature Descriptions</a></li>
<li><a href="posts/exploring-the-data/#orgf25c73a">The Training Set</a></li>
</ul>
</div>
</div>
<div id="outline-container-org445c4f5" class="outline-2">
<h2 id="org445c4f5">Imports</h2>
<div class="outline-text-2" id="text-org445c4f5">
</div>
<div id="outline-container-orgb2ca5ed" class="outline-3">
<h3 id="orgb2ca5ed">Suppressing the Numpy Warnings</h3>
<div class="outline-text-3" id="text-orgb2ca5ed">
<p>
When you import pandas you get some warnings:
</p>

<pre class="example">
/usr/lib/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility. Expected 96, got 88
  return f(*args, **kwds)
/usr/lib/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility. Expected 96, got 88
  return f(*args, **kwds)
</pre>

<p>
According to <a href="https://stackoverflow.com/questions/40845304/runtimewarning-numpy-dtype-size-changed-may-indicate-binary-incompatibility">Stack Overflow</a>, this is because <a href="https://www.scipy.org/">scipy</a> is built against an older version of <a href="http://www.numpy.org/">numpy</a>, but it shouldn't actually affect the way it works, so we should just suppress it.
</p>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.dtype size changed"</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">"numpy.ufunc size changed"</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4f223d3" class="outline-3">
<h3 id="org4f223d3">The rest of the imports</h3>
<div class="outline-text-3" id="text-org4f223d3">
<div class="highlight"><pre><span></span><span class="c1"># python standard library</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="c1"># from pypi</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org4618c3b" class="outline-2">
<h2 id="org4618c3b">The Tangle</h2>
<div class="outline-text-2" id="text-org4618c3b">
<p>
Exports so some of this can be re-used.
</p>
</div>
</div>

<div id="outline-container-org8c85771" class="outline-2">
<h2 id="org8c85771">Helpers</h2>
<div class="outline-text-2" id="text-org8c85771">
<p>
Just some functions that keep coming up.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Helpers</span><span class="p">:</span>
    <span class="sd">"""Helper functions"""</span>
    <span class="n">pickle_target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">"~/projects/kaggle-competitions/pickles/"</span><span class="p">)</span>
    <span class="n">pickle_target_string</span> <span class="o">=</span> <span class="n">pickle_target</span> <span class="o">+</span> <span class="s2">"{}.pkl"</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">print_head</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">"""prints the head of the given data frame</span>

<span class="sd">	Args:</span>
<span class="sd">	 frame (pandas.DataFrame): data frame to print as a table</span>
<span class="sd">	 showindex (bool): whether to print the index</span>
<span class="sd">	"""</span>
	<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span>
		       <span class="n">showindex</span><span class="o">=</span><span class="n">showindex</span><span class="p">))</span>
	<span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">print_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
	<span class="sd">"""print the data</span>

<span class="sd">	Args:</span>
<span class="sd">	 data: some kind of data-frame</span>
<span class="sd">	"""</span>
	<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span>
		       <span class="n">showindex</span><span class="o">=</span><span class="n">showindex</span><span class="p">))</span>
	<span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">pickle_it</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">"""save the object to a pickle in the data folder</span>

<span class="sd">	Args:</span>
<span class="sd">	 thing: object to pickle</span>
<span class="sd">	 name: thing to call the pickle</span>
<span class="sd">	"""</span>
	<span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">thing</span><span class="o">.</span><span class="vm">__name__</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
		<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
		    <span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_target_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
		<span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">pickler</span><span class="p">:</span>
	    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">pickler</span><span class="p">)</span>
	<span class="k">return</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">unpickle</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
	<span class="sd">"""loads the pickled object from the data folder</span>

<span class="sd">	Args:</span>
<span class="sd">	 name: name of the pickle without the folder or extension</span>

<span class="sd">	Returns:</span>
<span class="sd">	 object: the un-pickled object</span>
<span class="sd">	"""</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_target_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
		  <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">unpickler</span><span class="p">:</span>
	    <span class="n">unpickled</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">unpickler</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">unpickled</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
	<span class="sd">"""checks if the thing is already a pickle</span>

<span class="sd">	Args:</span>
<span class="sd">	 name: name of the pickle without folder or extension</span>

<span class="sd">	Returns:</span>
<span class="sd">	 bool: True if the pickle exists</span>
<span class="sd">	"""</span>
	<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">Helpers</span><span class="o">.</span><span class="n">pickle_target_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org103e9bf" class="outline-2">
<h2 id="org103e9bf">Constants</h2>
<div class="outline-text-2" id="text-org103e9bf">
<p>
As always, I'll try to put constants in the same place.
</p>
</div>
<div id="outline-container-org2908de0" class="outline-3">
<h3 id="org2908de0">Data Names</h3>
<div class="outline-text-3" id="text-org2908de0">
<p>
This is just a re-mapping of the file-names since I keep forgetting them.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataNames</span><span class="p">:</span>
    <span class="sd">"""thing with the data-file-names (without extensions) as attributes"""</span>
    <span class="n">training</span> <span class="o">=</span> <span class="s2">"sales_train"</span>
    <span class="n">items</span> <span class="o">=</span> <span class="s2">"items"</span>
    <span class="n">item_categories</span> <span class="o">=</span> <span class="s2">"item_categories"</span>
    <span class="n">shops</span> <span class="o">=</span> <span class="s2">"shops"</span>
</pre></div>
</div>
</div>

<div id="outline-container-org5c71afe" class="outline-3">
<h3 id="org5c71afe">Data Source</h3>
<div class="outline-text-3" id="text-org5c71afe">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataSource</span><span class="p">:</span>
    <span class="sd">"""Strings for the files</span>

<span class="sd">    Args:</span>
<span class="sd">     directory: path to the data-folder</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s2">"~/projects/kaggle-competitions/data/"</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_file_names</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_file_name_paths</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The path to the data"""</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span>

    <span class="nd">@directory.setter</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
	<span class="sd">"""expands the user and saves the path</span>

<span class="sd">	Args:</span>
<span class="sd">	 path (str): path to the data folder</span>
<span class="sd">	"""</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="p">):</span>
	    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
		<span class="s2">"This file doesn't exist: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="p">))</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""list of file names in the data directory"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_names</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_file_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""list of paths to the file names"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
		    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">]</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_name_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""dict of name: path"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name_paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_file_name_paths</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">)}</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name_paths</span>

    <span class="k">def</span> <span class="nf">set_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""attaches the file names to this object"""</span>
	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">:</span>
	    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
	<span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd944e36" class="outline-3">
<h3 id="orgd944e36">Data Keys</h3>
<div class="outline-text-3" id="text-orgd944e36">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataKeys</span><span class="p">:</span>
    <span class="sd">"""Column names/keys for the data."""</span>
    <span class="n">item_category</span> <span class="o">=</span> <span class="s2">"item_category_id"</span>
    <span class="n">shop</span> <span class="o">=</span> <span class="s2">"shop_id"</span>
    <span class="n">item</span> <span class="o">=</span> <span class="s2">"item_id"</span>
    <span class="n">date</span> <span class="o">=</span> <span class="s2">"date"</span>
    <span class="n">date_block</span> <span class="o">=</span> <span class="s2">"date_block_num"</span>
    <span class="n">price</span> <span class="o">=</span> <span class="s2">"item_price"</span>
    <span class="n">day_count</span> <span class="o">=</span> <span class="s2">"item_cnt_day"</span>
    <span class="n">month_count</span> <span class="o">=</span> <span class="s1">'item_count_month'</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"item_name"</span>
    <span class="n">day</span> <span class="o">=</span> <span class="s2">"day"</span>
    <span class="n">month</span> <span class="o">=</span> <span class="s2">"month"</span>
    <span class="n">year</span> <span class="o">=</span> <span class="s2">"year"</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">data_source</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">()</span>
<span class="n">data_source</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orge3f8d10" class="outline-2">
<h2 id="orge3f8d10">The Files</h2>
<div class="outline-text-2" id="text-orge3f8d10">
<p>
These are the files we are given.
</p>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_source</span><span class="o">.</span><span class="n">file_names</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">" - {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</pre></div>

<ul class="org-ul">
<li>item_categories.csv</li>
<li>items.csv</li>
<li>sales_train.csv.gz</li>
<li>sample_submission.csv.gz</li>
<li>shops.csv</li>
<li>test.csv.gz</li>
</ul>
<p>
I was originally thinking I would need to unzip the gzipped files but apparently the <a href="https://pandas.pydata.org/pandas-docs/stable/io.html#io-read-csv-table"><code>Pandas.read_csv</code></a> function will decompress them automagically, so I guess I can leave them.
</p>

<div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="p">{</span><span class="n">data_source</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	  <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_source</span><span class="o">.</span><span class="n">paths</span><span class="p">)}</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">** {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="n">Helpers</span><span class="o">.</span><span class="n">print_head</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>

<div id="outline-container-orge3f710f" class="outline-3">
<h3 id="orge3f710f">item_categories.csv</h3>
<div class="outline-text-3" id="text-orge3f710f">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_category_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">PC - Гарнитуры/Наушники</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PSP</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 84 entries, 0 to 83
Data columns (total 2 columns):
item_category_name    84 non-null object
item_category_id      84 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.4+ KB
None
</p>
</div>
</div>

<div id="outline-container-org8f10a2d" class="outline-3">
<h3 id="org8f10a2d">items.csv</h3>
<div class="outline-text-3" id="text-org8f10a2d">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 22170 entries, 0 to 22169
Data columns (total 3 columns):
item_name           22170 non-null object
item_id             22170 non-null int64
item_category_id    22170 non-null int64
dtypes: int64(2), object(1)
memory usage: 519.7+ KB
None
</p>
</div>
</div>

<div id="outline-container-org21902bc" class="outline-3">
<h3 id="org21902bc">sales_train.csv.gz</h3>
<div class="outline-text-3" id="text-org21902bc">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2935849 entries, 0 to 2935848
Data columns (total 6 columns):
date              object
date_block_num    int64
shop_id           int64
item_id           int64
item_price        float64
item_cnt_day      float64
dtypes: float64(2), int64(3), object(1)
memory usage: 134.4+ MB
None
</p>
</div>
</div>

<div id="outline-container-orgb97e85d" class="outline-3">
<h3 id="orgb97e85d">sample_submission.csv.gz</h3>
<div class="outline-text-3" id="text-orgb97e85d">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">item_cnt_month</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">0.5</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 2 columns):
ID                214200 non-null int64
item_cnt_month    214200 non-null float64
dtypes: float64(1), int64(1)
memory usage: 3.3 MB
None
</p>
</div>
</div>

<div id="outline-container-orgf6165d3" class="outline-3">
<h3 id="orgf6165d3">shops.csv</h3>
<div class="outline-text-3" id="text-orgf6165d3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">shop_name</th>
<th scope="col" class="org-right">shop_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">!Якутск Орджоникидзе, 56 фран</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">!Якутск ТЦ "Центральный" фран</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Адыгея ТЦ "Мега"</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Балашиха ТРК "Октябрь-Киномир"</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Волжский ТЦ "Волга Молл"</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 60 entries, 0 to 59
Data columns (total 2 columns):
shop_name    60 non-null object
shop_id      60 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.0+ KB
None
</p>
</div>
</div>

<div id="outline-container-org0d8d3d1" class="outline-3">
<h3 id="org0d8d3d1">test.csv.gz</h3>
<div class="outline-text-3" id="text-org0d8d3d1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">5</td>
<td class="org-right">5037</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">5320</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">5</td>
<td class="org-right">5233</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">5</td>
<td class="org-right">5232</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">5268</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 3 columns):
ID         214200 non-null int64
shop_id    214200 non-null int64
item_id    214200 non-null int64
dtypes: int64(3)
memory usage: 4.9 MB
None
</p>
</div>
</div>

<div id="outline-container-org4a75ad4" class="outline-3">
<h3 id="org4a75ad4">sample_submission.csv.gz</h3>
<div class="outline-text-3" id="text-org4a75ad4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">item_cnt_month</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">0.5</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 2 columns):
ID                214200 non-null int64
item_cnt_month    214200 non-null float64
dtypes: float64(1), int64(1)
memory usage: 3.3 MB
None
</p>
</div>
</div>

<div id="outline-container-org3ecc92c" class="outline-3">
<h3 id="org3ecc92c">shops.csv</h3>
<div class="outline-text-3" id="text-org3ecc92c">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">shop_name</th>
<th scope="col" class="org-right">shop_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">!Якутск Орджоникидзе, 56 фран</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">!Якутск ТЦ "Центральный" фран</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Адыгея ТЦ "Мега"</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Балашиха ТРК "Октябрь-Киномир"</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Волжский ТЦ "Волга Молл"</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 60 entries, 0 to 59
Data columns (total 2 columns):
shop_name    60 non-null object
shop_id      60 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.0+ KB
None
</p>
</div>
</div>

<div id="outline-container-org32fa315" class="outline-3">
<h3 id="org32fa315">items.csv</h3>
<div class="outline-text-3" id="text-org32fa315">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 22170 entries, 0 to 22169
Data columns (total 3 columns):
item_name           22170 non-null object
item_id             22170 non-null int64
item_category_id    22170 non-null int64
dtypes: int64(2), object(1)
memory usage: 519.7+ KB
None
</p>
</div>
</div>

<div id="outline-container-org7aa20c5" class="outline-3">
<h3 id="org7aa20c5">sales_train.csv.gz</h3>
<div class="outline-text-3" id="text-org7aa20c5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2935849 entries, 0 to 2935848
Data columns (total 6 columns):
date              object
date_block_num    int64
shop_id           int64
item_id           int64
item_price        float64
item_cnt_day      float64
dtypes: float64(2), int64(3), object(1)
memory usage: 134.4+ MB
None
</p>
</div>
</div>

<div id="outline-container-org8a0c218" class="outline-3">
<h3 id="org8a0c218">item_categories.csv</h3>
<div class="outline-text-3" id="text-org8a0c218">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_category_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">PC - Гарнитуры/Наушники</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PSP</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 84 entries, 0 to 83
Data columns (total 2 columns):
item_category_name    84 non-null object
item_category_id      84 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.4+ KB
None
</p>
</div>
</div>

<div id="outline-container-org601ead6" class="outline-3">
<h3 id="org601ead6">test.csv.gz</h3>
<div class="outline-text-3" id="text-org601ead6">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">5</td>
<td class="org-right">5037</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">5320</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">5</td>
<td class="org-right">5233</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">5</td>
<td class="org-right">5232</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">5268</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 3 columns):
ID         214200 non-null int64
shop_id    214200 non-null int64
item_id    214200 non-null int64
dtypes: int64(3)
memory usage: 4.9 MB
None
</p>
</div>
</div>

<div id="outline-container-org2733569" class="outline-3">
<h3 id="org2733569">sample_submission.csv.gz</h3>
<div class="outline-text-3" id="text-org2733569">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">item_cnt_month</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">0.5</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 2 columns):
ID                214200 non-null int64
item_cnt_month    214200 non-null float64
dtypes: float64(1), int64(1)
memory usage: 3.3 MB
None
</p>
</div>
</div>

<div id="outline-container-org8ec6997" class="outline-3">
<h3 id="org8ec6997">shops.csv</h3>
<div class="outline-text-3" id="text-org8ec6997">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">shop_name</th>
<th scope="col" class="org-right">shop_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">!Якутск Орджоникидзе, 56 фран</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">!Якутск ТЦ "Центральный" фран</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Адыгея ТЦ "Мега"</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Балашиха ТРК "Октябрь-Киномир"</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Волжский ТЦ "Волга Молл"</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 60 entries, 0 to 59
Data columns (total 2 columns):
shop_name    60 non-null object
shop_id      60 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.0+ KB
None
</p>
</div>
</div>

<div id="outline-container-org892eb7b" class="outline-3">
<h3 id="org892eb7b">items.csv</h3>
<div class="outline-text-3" id="text-org892eb7b">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 22170 entries, 0 to 22169
Data columns (total 3 columns):
item_name           22170 non-null object
item_id             22170 non-null int64
item_category_id    22170 non-null int64
dtypes: int64(2), object(1)
memory usage: 519.7+ KB
None
</p>
</div>
</div>

<div id="outline-container-orgdc3f76d" class="outline-3">
<h3 id="orgdc3f76d">sales_train.csv.gz</h3>
<div class="outline-text-3" id="text-orgdc3f76d">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2935849 entries, 0 to 2935848
Data columns (total 6 columns):
date              object
date_block_num    int64
shop_id           int64
item_id           int64
item_price        float64
item_cnt_day      float64
dtypes: float64(2), int64(3), object(1)
memory usage: 134.4+ MB
None
</p>
</div>
</div>

<div id="outline-container-org6e84b6c" class="outline-3">
<h3 id="org6e84b6c">item_categories.csv</h3>
<div class="outline-text-3" id="text-org6e84b6c">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_category_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">PC - Гарнитуры/Наушники</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PSP</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 84 entries, 0 to 83
Data columns (total 2 columns):
item_category_name    84 non-null object
item_category_id      84 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.4+ KB
None
</p>
</div>
</div>

<div id="outline-container-org2633e5e" class="outline-3">
<h3 id="org2633e5e">test.csv.gz</h3>
<div class="outline-text-3" id="text-org2633e5e">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">5</td>
<td class="org-right">5037</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">5320</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">5</td>
<td class="org-right">5233</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">5</td>
<td class="org-right">5232</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">5268</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 3 columns):
ID         214200 non-null int64
shop_id    214200 non-null int64
item_id    214200 non-null int64
dtypes: int64(3)
memory usage: 4.9 MB
None
</p>
</div>
</div>

<div id="outline-container-org1656326" class="outline-3">
<h3 id="org1656326">sample_submission.csv.gz</h3>
<div class="outline-text-3" id="text-org1656326">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">item_cnt_month</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0.5</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">0.5</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 2 columns):
ID                214200 non-null int64
item_cnt_month    214200 non-null float64
dtypes: float64(1), int64(1)
memory usage: 3.3 MB
None
</p>
</div>
</div>

<div id="outline-container-org6bec7ca" class="outline-3">
<h3 id="org6bec7ca">shops.csv</h3>
<div class="outline-text-3" id="text-org6bec7ca">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">shop_name</th>
<th scope="col" class="org-right">shop_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">!Якутск Орджоникидзе, 56 фран</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">!Якутск ТЦ "Центральный" фран</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Адыгея ТЦ "Мега"</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Балашиха ТРК "Октябрь-Киномир"</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Волжский ТЦ "Волга Молл"</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 60 entries, 0 to 59
Data columns (total 2 columns):
shop_name    60 non-null object
shop_id      60 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.0+ KB
None
</p>
</div>
</div>

<div id="outline-container-org7033e83" class="outline-3">
<h3 id="org7033e83">items.csv</h3>
<div class="outline-text-3" id="text-org7033e83">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 22170 entries, 0 to 22169
Data columns (total 3 columns):
item_name           22170 non-null object
item_id             22170 non-null int64
item_category_id    22170 non-null int64
dtypes: int64(2), object(1)
memory usage: 519.7+ KB
None
</p>
</div>
</div>

<div id="outline-container-org8fd843c" class="outline-3">
<h3 id="org8fd843c">sales_train.csv.gz</h3>
<div class="outline-text-3" id="text-org8fd843c">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2935849 entries, 0 to 2935848
Data columns (total 6 columns):
date              object
date_block_num    int64
shop_id           int64
item_id           int64
item_price        float64
item_cnt_day      float64
dtypes: float64(2), int64(3), object(1)
memory usage: 134.4+ MB
None
</p>
</div>
</div>

<div id="outline-container-orgc30ecc8" class="outline-3">
<h3 id="orgc30ecc8">item_categories.csv</h3>
<div class="outline-text-3" id="text-orgc30ecc8">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_category_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">PC - Гарнитуры/Наушники</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PSP</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 84 entries, 0 to 83
Data columns (total 2 columns):
item_category_name    84 non-null object
item_category_id      84 non-null int64
dtypes: int64(1), object(1)
memory usage: 1.4+ KB
None
</p>
</div>
</div>

<div id="outline-container-orga64fe3b" class="outline-3">
<h3 id="orga64fe3b">test.csv.gz</h3>
<div class="outline-text-3" id="text-orga64fe3b">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">5</td>
<td class="org-right">5037</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">5320</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">5</td>
<td class="org-right">5233</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">5</td>
<td class="org-right">5232</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">5268</td>
</tr>
</tbody>
</table>
<p>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 214200 entries, 0 to 214199
Data columns (total 3 columns):
ID         214200 non-null int64
shop_id    214200 non-null int64
item_id    214200 non-null int64
dtypes: int64(3)
memory usage: 4.9 MB
None
</p>
</div>
</div>
</div>

<div id="outline-container-orgba3f6c4" class="outline-2">
<h2 id="orgba3f6c4">Some Counts</h2>
<div class="outline-text-2" id="text-orgba3f6c4">
</div>
<div id="outline-container-org1b27b37" class="outline-3">
<h3 id="org1b27b37">How much data is there in the training set?</h3>
<div class="outline-text-3" id="text-org1b27b37">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {:,} rows in the training set."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">])))</span>
</pre></div>

<p>
There are 2,935,849 rows in the training set.
</p>
</div>
</div>

<div id="outline-container-org963fae3" class="outline-3">
<h3 id="org963fae3">How many shops are there?</h3>
<div class="outline-text-3" id="text-org963fae3">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {} shops."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">shops</span><span class="p">])))</span>
</pre></div>

<p>
There are 60 shops.
</p>
</div>
</div>

<div id="outline-container-orgc87eddf" class="outline-3">
<h3 id="orgc87eddf">How Many Items Are There?</h3>
<div class="outline-text-3" id="text-orgc87eddf">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {:,} items."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">items</span><span class="p">])))</span>
</pre></div>

<p>
There are 22,170 items.
</p>
</div>
</div>

<div id="outline-container-org401d931" class="outline-3">
<h3 id="org401d931">How Many Item Categories are there?</h3>
<div class="outline-text-3" id="text-org401d931">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {:,} categories."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">item_categories</span><span class="p">])))</span>
</pre></div>

<p>
There are 84 categories.
</p>
</div>
</div>

<div id="outline-container-org4f0f275" class="outline-3">
<h3 id="org4f0f275">How many date-blocks are there?</h3>
<div class="outline-text-3" id="text-org4f0f275">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"There are {} date-blocks."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">][</span><span class="n">DataKeys</span><span class="o">.</span><span class="n">date_block</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())))</span>
</pre></div>

<p>
There are 34 date-blocks.
</p>
</div>
</div>
</div>

<div id="outline-container-org9166d52" class="outline-2">
<h2 id="org9166d52">The Official Feature Descriptions</h2>
<div class="outline-text-2" id="text-org9166d52">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Column Name</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">ID</td>
<td class="org-left">an Id that represents a (Shop, Item) tuple within the test set</td>
</tr>
<tr>
<td class="org-left">shop_id</td>
<td class="org-left">unique identifier of a shop</td>
</tr>
<tr>
<td class="org-left">item_id</td>
<td class="org-left">unique identifier of a product</td>
</tr>
<tr>
<td class="org-left">item_category_id</td>
<td class="org-left">unique identifier of item category</td>
</tr>
<tr>
<td class="org-left">item_cnt_day</td>
<td class="org-left">number of products sold. You are predicting a monthly amount of this measure</td>
</tr>
<tr>
<td class="org-left">item_price</td>
<td class="org-left">current price of an item</td>
</tr>
<tr>
<td class="org-left">date</td>
<td class="org-left">date in format dd/mm/yyyy</td>
</tr>
<tr>
<td class="org-left">date_block_num</td>
<td class="org-left">a consecutive month number, used for convenience. January 2013 is 0, February 2013 is 1,…, October 2015 is 33</td>
</tr>
<tr>
<td class="org-left">item_name</td>
<td class="org-left">name of item</td>
</tr>
<tr>
<td class="org-left">shop_name</td>
<td class="org-left">name of shop</td>
</tr>
<tr>
<td class="org-left">item_category_name</td>
<td class="org-left">name of item category</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgf25c73a" class="outline-2">
<h2 id="orgf25c73a">The Training Set</h2>
<div class="outline-text-2" id="text-orgf25c73a">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>

<p>
date               object
date_block_num      int64
shop_id             int64
item_id             int64
item_price        float64
item_cnt_day      float64
dtype: object
</p>
</div>

<div id="outline-container-org26679fc" class="outline-3">
<h3 id="org26679fc">Numeric Features</h3>
<div class="outline-text-3" id="text-org26679fc">
<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_table</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left"> </th>
<th scope="col" class="org-right">count</th>
<th scope="col" class="org-right">mean</th>
<th scope="col" class="org-right">std</th>
<th scope="col" class="org-right">min</th>
<th scope="col" class="org-right">25%</th>
<th scope="col" class="org-right">50%</th>
<th scope="col" class="org-right">75%</th>
<th scope="col" class="org-right">max</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">date_block_num</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">14.5699</td>
<td class="org-right">9.42299</td>
<td class="org-right">0</td>
<td class="org-right">7</td>
<td class="org-right">14</td>
<td class="org-right">23</td>
<td class="org-right">33</td>
</tr>
<tr>
<td class="org-left">shop_id</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">33.0017</td>
<td class="org-right">16.227</td>
<td class="org-right">0</td>
<td class="org-right">22</td>
<td class="org-right">31</td>
<td class="org-right">47</td>
<td class="org-right">59</td>
</tr>
<tr>
<td class="org-left">item_id</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">10197.2</td>
<td class="org-right">6324.3</td>
<td class="org-right">0</td>
<td class="org-right">4476</td>
<td class="org-right">9343</td>
<td class="org-right">15684</td>
<td class="org-right">22169</td>
</tr>
<tr>
<td class="org-left">item_price</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">890.853</td>
<td class="org-right">1729.8</td>
<td class="org-right">-1</td>
<td class="org-right">249</td>
<td class="org-right">399</td>
<td class="org-right">999</td>
<td class="org-right">307980</td>
</tr>
<tr>
<td class="org-left">item_cnt_day</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">1.24264</td>
<td class="org-right">2.61883</td>
<td class="org-right">-22</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">2169</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgbfaf455" class="outline-3">
<h3 id="orgbfaf455">Categorical Features</h3>
<div class="outline-text-3" id="text-orgbfaf455">
<div class="highlight"><pre><span></span><span class="n">Helpers</span><span class="o">.</span><span class="n">print_table</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">data_source</span><span class="o">.</span><span class="n">sales_train</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Categorical</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left"> </th>
<th scope="col" class="org-right">count</th>
<th scope="col" class="org-right">unique</th>
<th scope="col" class="org-right">top</th>
<th scope="col" class="org-right">freq</th>
</tr></thead>
<tbody><tr>
<td class="org-left">date</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">1034</td>
<td class="org-right">28.12.2013</td>
<td class="org-right">9434</td>
</tr></tbody>
</table>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/set-up-the-kaggle-command-line-command/" class="u-url">Set Up the Kaggle Command-Line Command</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/set-up-the-kaggle-command-line-command/" rel="bookmark"><time class="published dt-published" datetime="2018-08-11T13:37:44-07:00" title="2018-08-11 13:37">2018-08-11 13:37</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/set-up-the-kaggle-command-line-command/#org615e90f">Install the Command</a></li>
<li><a href="posts/set-up-the-kaggle-command-line-command/#org91e3109">Get Your Credentials</a></li>
<li><a href="posts/set-up-the-kaggle-command-line-command/#org2df4a2d">Test it out</a></li>
<li><a href="posts/set-up-the-kaggle-command-line-command/#org27c7035">The Actual API</a></li>
</ul>
</div>
</div>

<p>
These are my notes as I set up the command-line interface. The official instructions are in the <a href="https://github.com/Kaggle/kaggle-api">README on github</a>.
</p>

<div id="outline-container-org615e90f" class="outline-2">
<h2 id="org615e90f">Install the Command</h2>
<div class="outline-text-2" id="text-org615e90f">
<p>
The code is available through <a href="https://pypi.org/project/kaggle/">pypi</a> so you can install it through pip. Their instructions say to install it at the user-level but I'm doing it in a <code>virtualenv</code> so that actually doesn't work for me, instead I did a regular <code>pip</code> install (after installing <code>wheel</code>).
</p>

<pre class="example">
pip install kaggle
</pre>
</div>
</div>

<div id="outline-container-org91e3109" class="outline-2">
<h2 id="org91e3109">Get Your Credentials</h2>
<div class="outline-text-2" id="text-org91e3109">
</div>
<div id="outline-container-org003b2cb" class="outline-3">
<h3 id="org003b2cb">Download the JSON File From Kaggle</h3>
<div class="outline-text-3" id="text-org003b2cb">
<p>
Log in to your kaggle account and click on the <i>Account</i> menu (it's hidden until you hover over the drop-down widget).
</p>


<div class="figure">
<p><img src="posts/set-up-the-kaggle-command-line-command/kaggle_account_menu.png" alt="kaggle_account_menu.png"></p>
</div>

<p>
Scroll down to the <i>API</i> box and click on <b>Create New API Token</b>.
</p>


<div class="figure">
<p><img src="posts/set-up-the-kaggle-command-line-command/api_box.png" alt="api_box.png"></p>
</div>

<p>
This will start a file download, if it prompts you save it to your computer.
</p>


<div class="figure">
<p><img src="posts/set-up-the-kaggle-command-line-command/download_json.png" alt="download_json.png"></p>
</div>
</div>
</div>

<div id="outline-container-orga2349fb" class="outline-3">
<h3 id="orga2349fb">Set Up the File</h3>
<div class="outline-text-3" id="text-orga2349fb">
<p>
Store this file in a folder named <code>.kaggle</code>.
</p>

<pre class="example">
mkdir ~/.kaggle
mv ~/Downloads/kaggle.json ~/.kaggle/
</pre>

<p>
To be on the safe side, change the permissions on the file so that other users can't read it.
</p>

<pre class="example">
chmod 600 ~/.kaggle/kaggle.json
</pre>

<p>
If you look in the file you'll see that it just has a JSON object with your username and API key.
</p>

<pre class="example">
{"username":"bumblebee","key":"8b970a13a2cfcfb7a77bdb8b4effaebc"}
</pre>

<p>
The instructions say you could also export the values as environment variables, but I'll leave it like this for now.
</p>
</div>
</div>
</div>

<div id="outline-container-org2df4a2d" class="outline-2">
<h2 id="org2df4a2d">Test it out</h2>
<div class="outline-text-2" id="text-org2df4a2d">
<p>
It's a python command that uses the basic help system you would expect if you've used python command-line programs before.
</p>

<div class="highlight"><pre><span></span>kaggle --help
</pre></div>

<pre class="example">
usage: kaggle [-h] [-v] {competitions,c,datasets,d,kernels,k,config} ...

optional arguments:
  -h, --help            show this help message and exit
  -v, --version         show program's version number and exit

commands:
  {competitions,c,datasets,d,kernels,k,config}
                        Use one of:
                        competitions {list, files, download, submit, submissions, leaderboard}
                        datasets {list, files, download, create, version, init, metadata, status}
                        config {view, set, unset}
    competitions (c)    Commands related to Kaggle competitions
    datasets (d)        Commands related to Kaggle datasets
    kernels (k)         Commands related to Kaggle kernels
    config              Configuration settings
</pre>

<p>
For this project you would download the data like this (downloading to a folder named <code>data</code>).
</p>

<pre class="example">
kaggle competitions download -c competitive-data-science-final-project data
</pre>
</div>
</div>
<div id="outline-container-org27c7035" class="outline-2">
<h2 id="org27c7035">The Actual API</h2>
<div class="outline-text-2" id="text-org27c7035">
<p>
If you look under the hood the command is just doing REST calls. To make it programattic you could probably use <a href="http://docs.python-requests.org/en/master/">requests</a> or something similar to interact with it directly. You can see the calls you need to make by looking at the <a href="https://github.com/Kaggle/kaggle-api/blob/master/KaggleSwagger.yaml">swagger file</a>.
</p>
</div>

<div id="outline-container-orgdbc496b" class="outline-3">
<h3 id="orgdbc496b">How the CLI does it</h3>
<div class="outline-text-3" id="text-orgdbc496b">
<p>
If you look in the <code>kaggle.__init__.py</code> file in the repository you'll see these imports.
</p>

<div class="highlight"><pre><span></span>from kaggle.api.kaggle_api_extended import KaggleApi
from kaggle.api_client import ApiClient
</pre></div>

<p>
Then when the command-line is called to download the data set it does this.
</p>

<div class="highlight"><pre><span></span>api = KaggleApi(ApiClient())
api.competition_download_cli(competition=None, competition_opt="competitive-data-science-final-project", path="data")
</pre></div>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/the-competition/" class="u-url">The Competition</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/the-competition/" rel="bookmark"><time class="published dt-published" datetime="2018-08-11T13:14:17-07:00" title="2018-08-11 13:14">2018-08-11 13:14</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/the-competition/#org27bcc63">What is this about?</a></li>
<li><a href="posts/the-competition/#orgd03b9d3">What is the data made up of?</a></li>
<li><a href="posts/the-competition/#org5359997">How will you be evaluated?</a></li>
</ul>
</div>
</div>

<div id="outline-container-org27bcc63" class="outline-2">
<h2 id="org27bcc63">What is this about?</h2>
<div class="outline-text-2" id="text-org27bcc63">
<p>
This is about the <a href="https://www.kaggle.com/c/competitive-data-science-final-project">kaggle competition</a> to predict future sales based on prior sale data. You are given a data set made up of prior sales and asked to predict how much each product will sell over the next month.
</p>
</div>
</div>

<div id="outline-container-orgd03b9d3" class="outline-2">
<h2 id="orgd03b9d3">What is the data made up of?</h2>
<div class="outline-text-2" id="text-orgd03b9d3">
</div>
<div id="outline-container-orgd0c46e6" class="outline-3">
<h3 id="orgd0c46e6">The Source</h3>
<div class="outline-text-3" id="text-orgd0c46e6">
<p>
The data comes from the <a href="http://1c.ru/eng/title.htm">1C Company</a>, a Russian company that describes themselves on their website like this.
</p>

<blockquote>
<p>
Founded in 1991 1C Company specializes in development, distribution, publishing and support of mass-market software.
</p>

<p>
At present 8000 dealers from 600 cities cooperate with 1C. About 7500 teams constitute the 1C:Franchising partner network,which is a main channel of value-adding for 1C products. Service-partners provide regular information and technological support for 1C software customers. The network of authorized training centers is also operating.
</p>

<p>
1C is the official distributor of such world-famous vendors as Microsoft, Novell, Borland, Symantec, ABBYY, Kaspersky Lab, ProMT, Eset Software and over 100 other software vendors. 1C offers more than 10 000 titles of software for office and home use. 
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org6b6b951" class="outline-3">
<h3 id="org6b6b951">Getting it</h3>
<div class="outline-text-3" id="text-org6b6b951">
<p>
It looks like the data-set is the same one that I used for the Pandas example, but I'll download it anyway to be safe.
</p>

<pre class="example">
mkdir data
kaggle competitions download competitive-data-science-final-project --path data
</pre>
</div>
</div>

<div id="outline-container-org3ee4d72" class="outline-3">
<h3 id="org3ee4d72">The Description</h3>
<div class="outline-text-3" id="text-org3ee4d72">
<blockquote>
<p>
You are provided with daily historical sales data. The task is to forecast the total amount of products sold in every shop for the test set. Note that the list of shops and products slightly changes every month. Creating a robust model that can handle such situations is part of the challenge.
</p>
</blockquote>
</div>


<div id="outline-container-org79c6f85" class="outline-4">
<h4 id="org79c6f85">Files</h4>
<div class="outline-text-4" id="text-org79c6f85">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">File Name</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">sales_train.csv</td>
<td class="org-left">the training set. Daily historical data from January 2013 to October 2015.</td>
</tr>
<tr>
<td class="org-left">test.csv</td>
<td class="org-left">the test set. You need to forecast the sales for these shops and products for November 2015.</td>
</tr>
<tr>
<td class="org-left">sample_submission.csv</td>
<td class="org-left">a sample submission file in the correct format.</td>
</tr>
<tr>
<td class="org-left">items.csv</td>
<td class="org-left">supplemental information about the items/products.</td>
</tr>
<tr>
<td class="org-left">item_categories.csv</td>
<td class="org-left">supplemental information about the items categories.</td>
</tr>
<tr>
<td class="org-left">shops.csv</td>
<td class="org-left">supplemental information about the shops.</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orgb7e49e4" class="outline-4">
<h4 id="orgb7e49e4">Features</h4>
<div class="outline-text-4" id="text-orgb7e49e4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Column Name</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">ID</td>
<td class="org-left">an Id that represents a (Shop, Item) tuple within the test set</td>
</tr>
<tr>
<td class="org-left">shop_id</td>
<td class="org-left">unique identifier of a shop</td>
</tr>
<tr>
<td class="org-left">item_id</td>
<td class="org-left">unique identifier of a product</td>
</tr>
<tr>
<td class="org-left">item_category_id</td>
<td class="org-left">unique identifier of item category</td>
</tr>
<tr>
<td class="org-left">item_cnt_day</td>
<td class="org-left">number of products sold. You are predicting a monthly amount of this measure</td>
</tr>
<tr>
<td class="org-left">item_price</td>
<td class="org-left">current price of an item</td>
</tr>
<tr>
<td class="org-left">date</td>
<td class="org-left">date in format dd/mm/yyyy</td>
</tr>
<tr>
<td class="org-left">date_block_num</td>
<td class="org-left">a consecutive month number, used for convenience. January 2013 is 0, February 2013 is 1,…, October 2015 is 33</td>
</tr>
<tr>
<td class="org-left">item_name</td>
<td class="org-left">name of item</td>
</tr>
<tr>
<td class="org-left">shop_name</td>
<td class="org-left">name of shop</td>
</tr>
<tr>
<td class="org-left">item_category_name</td>
<td class="org-left">name of item category</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

<div id="outline-container-org5359997" class="outline-2">
<h2 id="org5359997">How will you be evaluated?</h2>
<div class="outline-text-2" id="text-org5359997">
</div>
<div id="outline-container-org3f66cd1" class="outline-3">
<h3 id="org3f66cd1">Submission Format</h3>
<div class="outline-text-3" id="text-org3f66cd1">
<p>
You will submit a comma-separated file with two columns, the product ID and the total number of sales. It should look like this.
</p>

<pre class="example">
ID,item_cnt_month
0,5
1,3
2,6
</pre>
</div>
</div>


<div id="outline-container-org59f4c28" class="outline-3">
<h3 id="org59f4c28">Scoring</h3>
<div class="outline-text-3" id="text-org59f4c28">
<p>
You will be scored base on the <a href="https://en.wikipedia.org/wiki/Root-mean-square_deviation">Root Mean Square Error (RMSE)</a>. The page says that the true target values are clipped to the <code>[0,20]</code> range and the example given shows <code>0.5</code> as the <code>item_cnt_month</code> values, neither of which makes any sense to me at the moment.
</p>
</div>
</div>


<div id="outline-container-org6852184" class="outline-3">
<h3 id="org6852184">The meaning of the target</h3>
<div class="outline-text-3" id="text-org6852184">
<p>
According to <a href="https://www.kaggle.com/c/competitive-data-science-final-project/discussion/48251">this thread</a> you need to <a href="https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.clip.html">clip</a> the predictions back to that range (make anything less than zero a zero and anything more than twenty a twenty).
</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/feature-preprocessing/" class="u-url">Feature Preprocessing</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/feature-preprocessing/" rel="bookmark"><time class="published dt-published" datetime="2018-08-07T21:41:10-07:00" title="2018-08-07 21:41">2018-08-07 21:41</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/feature-preprocessing/#org02e9aab">Preprocessing</a></li>
<li><a href="posts/feature-preprocessing/#orgd328052">Numeric Feature Preprocessing</a></li>
<li><a href="posts/feature-preprocessing/#orgb26fe51">Categorical And Ordinal Features</a></li>
<li><a href="posts/feature-preprocessing/#org9e98319">Dates and Times</a></li>
<li><a href="posts/feature-preprocessing/#org6778d35">Coordinates</a></li>
<li><a href="posts/feature-preprocessing/#orgc44ddc3">Missing Data</a></li>
<li><a href="posts/feature-preprocessing/#orgd645cf5">Links</a></li>
</ul>
</div>
</div>
<div id="outline-container-org02e9aab" class="outline-2">
<h2 id="org02e9aab">Preprocessing</h2>
<div class="outline-text-2" id="text-org02e9aab">
<p>
In every competition you need to:
</p>

<ul class="org-ul">
<li>pre-process the data</li>
<li>generate new features from the existing ones</li>
</ul>
</div>
</div>
<div id="outline-container-orgd328052" class="outline-2">
<h2 id="orgd328052">Numeric Feature Preprocessing</h2>
<div class="outline-text-2" id="text-orgd328052">
<p>
Some models (e.g. Linear Classification) need you to convert numeric-looking data to categorical data. Tree-based models don't need pre-processing as much as non tree-based models do.
</p>
</div>

<div id="outline-container-org53b35fd" class="outline-3">
<h3 id="org53b35fd">Scaling</h3>
<div class="outline-text-3" id="text-org53b35fd">
<p>
If features have different value ranges then the model will  treat them differently.
</p>
<ul class="org-ul">
<li>
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html">sklearn.preprocessing.MinMaxScalar</a>
Scale by the range of values</li>
<li>
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html">sklearn.preprocessing.StandardScalar</a>
Scale the data to have a mean of 0 and a standard deviation of 1</li>
</ul>
</div>
</div>
<div id="outline-container-org5a81a46" class="outline-3">
<h3 id="org5a81a46">Outliers</h3>
<div class="outline-text-3" id="text-org5a81a46">
<ul class="org-ul">
<li>Clip (<a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.clip.html">numpy.clip</a>)values to get rid of unusual values that mess with the model. (Winsorization)</li>
<li>Rank Transform them (<a href="https://docs.scipy.org/doc/scipy-0.16.0/reference/generated/scipy.stats.rankdata.html">scipy.stats.rankdata</a>) so that they</li>
</ul>
</div>
</div>
<div id="outline-container-org9a96563" class="outline-3">
<h3 id="org9a96563">Transformation</h3>
<div class="outline-text-3" id="text-org9a96563">
<p>
For linear models and neural networks, transforming the data can sometimes help.
</p>
<ul class="org-ul">
<li>Log Transform: <a href="https://duckduckgo.com/?q=numpy+log&amp;t=canonical&amp;ia=web">numpy.log(1 + x)</a>
</li>
<li>Power Less Than 1 Transform: <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.sqrt.html">numpy.sqrt(x + 2/3)</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-org52607ae" class="outline-3">
<h3 id="org52607ae">Feature Generation</h3>
<div class="outline-text-3" id="text-org52607ae">
<p>
Sometimes you can convert separate columns to get new ones. This requires exploratory data analysis.
</p>
<ul class="org-ul">
<li>Fractional Parts: people perceive numbers with fractions differently so sometime separating out the fractional part makes the model perform better because it is the more important part</li>
<li>You can derive new values mathematically (e.g. distance using height and width)</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgb26fe51" class="outline-2">
<h2 id="orgb26fe51">Categorical And Ordinal Features</h2>
<div class="outline-text-2" id="text-orgb26fe51">
<ul class="org-ul">
<li>Ordinal Features have an ordering but even if they are labeled numerically (e.g. 1, 2, 3) they aren't numeric because there is no implication about the distance between each</li>
<li>label and frequency encoding are commonly used for tree-based models</li>
<li>one-hot encoding is more common for non-tree-based models</li>
</ul>
</div>
<div id="outline-container-orgc322d7b" class="outline-3">
<h3 id="orgc322d7b">Label Encoding</h3>
<div class="outline-text-3" id="text-orgc322d7b">
<p>
Some models need numeric values or numeric values that don't have implied ordering so you want to encode them.
</p>
<ul class="org-ul">
<li>
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.LabelEncoder.html">sklearn.preprocessing.LabelEncoder</a>
Sorts the labels then encodes them as integers</li>
<li>
<a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.factorize.html">Pandas.factorize</a>
Encodes the labels in the order they appear. This makes more sense if there is a meaning to the order in which labels appear.</li>
<li>This is more commonly used with tree-based methods.</li>
</ul>
</div>
</div>
<div id="outline-container-org53bb997" class="outline-3">
<h3 id="org53bb997">Frequency Encoding</h3>
<div class="outline-text-3" id="text-org53bb997">
<p>
Encode the values to a fraction of all the labels. Can work with linear models if the frequency is correlated with the target value.
</p>
<ul class="org-ul">
<li><code>titanic.groupby("Embarked").size()/len(titanic)</code></li>
<li><code>from scipy.stats import rankedata</code></li>
<li>More common with tree-based methods</li>
</ul>
</div>
</div>
<div id="outline-container-org8aed5ab" class="outline-3">
<h3 id="org8aed5ab">One Hot Encoding</h3>
<div class="outline-text-3" id="text-org8aed5ab">
<p>
Creates one column for each label and puts a 1 in the column that matches. Works with both linear and tree-based models, but can be inefficient with tree-based models.
</p>
<ul class="org-ul">
<li>
<a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.get_dummies.html">pandas.get_dummies</a> - converts strings into column encodings</li>
<li>
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html">sklearn.preprocessing.OneHotEncoder</a> - converts numeric categorical data into column encodings</li>
<li>One hot encoding is better for non-tree models.</li>
<li>This allows easier feature interactions (encode combined features (e.g. gender and class) rather than encoding them separately) 
<ul class="org-ul">
<li>This is more common with linear models and KNN</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org9e98319" class="outline-2">
<h2 id="org9e98319">Dates and Times</h2>
<div class="outline-text-2" id="text-org9e98319">
<p>
When working with seasonal data, sometimes the relative date-stamps are more important than the actual dates (how close to Christmas?).
Sometimes you want the time between events.
</p>
</div>
</div>
<div id="outline-container-org6778d35" class="outline-2">
<h2 id="org6778d35">Coordinates</h2>
<div class="outline-text-2" id="text-org6778d35">
<p>
Sometimes you want exact coordinates, but most times you want distances to some center.
</p>
</div>
</div>
<div id="outline-container-orgc44ddc3" class="outline-2">
<h2 id="orgc44ddc3">Missing Data</h2>
<div class="outline-text-2" id="text-orgc44ddc3">
<ul class="org-ul">
<li>"missing" data might mean outliers - values that are probably wrong</li>
<li>avoid replacing missing values before feature engineering - it can throw off what you do</li>
<li>Gradient Boost Trees can handle isNaN, so you don't have to do anything</li>
</ul>
</div>
<div id="outline-container-org064dc8f" class="outline-3">
<h3 id="org064dc8f">Numeric</h3>
<div class="outline-text-3" id="text-org064dc8f">
</div>
<div id="outline-container-org1473416" class="outline-4">
<h4 id="org1473416">Fill NA Approaches</h4>
<div class="outline-text-4" id="text-org1473416">
<ul class="org-ul">
<li>-999, -1, other numbers
<ul class="org-ul">
<li>lets you categorize missing values</li>
<li>throws some models off (e.g. linear models and neural networks)</li>
<li>one solution is to create a new feature for missing values, but this has now increased the amount of data you need (curse of dimensionality)</li>
</ul>
</li>
<li>mean, median, some central tendency
<ul class="org-ul">
<li>This can throw the model off</li>
<li>it is sometimes better to ignore missing data</li>
</ul>
</li>
<li>recronstructed valud</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd645cf5" class="outline-2">
<h2 id="orgd645cf5">Links</h2>
<div class="outline-text-2" id="text-orgd645cf5">
</div>
<div id="outline-container-org0e28f21" class="outline-3">
<h3 id="org0e28f21">Feature Pre-processing</h3>
<div class="outline-text-3" id="text-org0e28f21">
<ul class="org-ul">
<li><a href="http://scikit-learn.org/stable/modules/preprocessing.html">SKlearn's Preprocessing Documentation</a></li>
<li><a href="https://www.coursera.org/learn/machine-learning/lecture/xx3Da/gradient-descent-in-practice-i-feature-scaling">Andrew Ng on Feature Scaling and its effect on Gradient Descent</a></li>
<li><a href="http://sebastianraschka.com/Articles/2014_about_feature_scaling.html">Sebastian Raschka on Feature Scaling</a></li>
</ul>
</div>
</div>
<div id="outline-container-org3b24ea9" class="outline-3">
<h3 id="org3b24ea9">Feature Engineering</h3>
<div class="outline-text-3" id="text-org3b24ea9">
<ul class="org-ul">
<li><a href="https://machinelearningmastery.com/discover-feature-engineering-how-to-engineer-features-and-how-to-get-good-at-it/">Machine Learning Mastery on Feature Engineering</a></li>
<li><a href="https://www.quora.com/What-are-some-best-practices-in-Feature-Engineering">Quora: What are some best practices in Feature Engineering?</a></li>
</ul>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/pandas-basics/" class="u-url">Revisiting Pandas (Yet Again)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/pandas-basics/" rel="bookmark"><time class="published dt-published" datetime="2018-08-05T12:56:23-07:00" title="2018-08-05 12:56">2018-08-05 12:56</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/pandas-basics/#orgd99f624">Description</a></li>
<li><a href="posts/pandas-basics/#org571f3bb">Pandas Functions and Methods Used</a></li>
<li><a href="posts/pandas-basics/#orgee5c745">Imports</a></li>
<li><a href="posts/pandas-basics/#org5867c2f">Confirmed</a></li>
<li><a href="posts/pandas-basics/#orge840081">The Data</a></li>
<li>
<a href="posts/pandas-basics/#org5ade478">Data Description</a>
<ul>
<li><a href="posts/pandas-basics/#orgd8f2c37">File descriptions</a></li>
<li><a href="posts/pandas-basics/#orgd123c34">Data Fields</a></li>
</ul>
</li>
<li>
<a href="posts/pandas-basics/#orgf474240">A Warm Up</a>
<ul>
<li><a href="posts/pandas-basics/#orgdba352f">transactions</a></li>
<li><a href="posts/pandas-basics/#orge102f77">items</a></li>
<li><a href="posts/pandas-basics/#org1775ea5">item_categories</a></li>
<li><a href="posts/pandas-basics/#orgd395f4c">shops</a></li>
</ul>
</li>
<li>
<a href="posts/pandas-basics/#org8a18f8b">Questions</a>
<ul>
<li><a href="posts/pandas-basics/#org91d7be2">Question 1: <b>What was the maximum total revenue among all the shops in September, 2014?</b></a></li>
<li><a href="posts/pandas-basics/#org79e58e8">Question 2: <b>What item category generated the highest revenue in the Summer of 2014?</b></a></li>
<li><a href="posts/pandas-basics/#orgf281da6">Question 3: <b>How many items have the same price throughout the data set?</b></a></li>
<li><a href="posts/pandas-basics/#org61e053f">Question 4: <b>What was the variance of the number of items sold per day for shop 25 in December, 2014?</b></a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgd99f624" class="outline-2">
<h2 id="orgd99f624">Description</h2>
<div class="outline-text-2" id="text-orgd99f624">
<p>
This is a review of Pandas' Basics with an emphasis on using <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.groupby.html">groupby</a>.
</p>
</div>
</div>

<div id="outline-container-org571f3bb" class="outline-2">
<h2 id="org571f3bb">Pandas Functions and Methods Used</h2>
<div class="outline-text-2" id="text-org571f3bb">
<ul class="org-ul">
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.describe.html"><code>describe</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.groupby.html"><code>groupby</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.head.html"><code>head</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.idxmax.html"><code>idxmax</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.isin.html"><code>isin</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.loc.html"><code>loc</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.var.html"><code>var</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.abs.html"><code>abs</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.nunique.html"><code>nunique</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.str.extract.html"><code>str.extract</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.concat.html"><code>concat</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.core.groupby.DataFrameGroupBy.agg.html"><code>agg</code></a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html"><code>read_csv</code></a></li>
</ul>
</div>
</div>
<div id="outline-container-orgee5c745" class="outline-2">
<h2 id="orgee5c745">Imports</h2>
<div class="outline-text-2" id="text-orgee5c745">
<p>
Here's our dependencies.
</p>

<div class="highlight"><pre><span></span><span class="c1"># python standard library</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">seaborn</span>

<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">get_python</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">'matplotlib'</span><span class="p">,</span> <span class="s1">'inline'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-org5867c2f" class="outline-2">
<h2 id="org5867c2f">Confirmed</h2>
<div class="outline-text-2" id="text-org5867c2f">
<p>
These are values that we know to be correct so you can use them to check the outcomes.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Confirmed</span><span class="p">:</span>
    <span class="sd">"""This holds confirmed values"""</span>
    <span class="n">september_max_revenue</span> <span class="o">=</span> <span class="mf">7982852.199999956</span>
    <span class="n">september_max_category_id</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">number_of_items_whose_price_didnt_change</span> <span class="o">=</span> <span class="mi">5926</span>
    <span class="n">variance_per_day</span> <span class="o">=</span> <span class="mf">117167.70229885059</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge840081" class="outline-2">
<h2 id="orge840081">The Data</h2>
<div class="outline-text-2" id="text-orge840081">
<p>
We have four data-sets to load, all of them in csv format, although the file with all the transactions is compressed.
</p>

<div class="highlight"><pre><span></span><span class="n">DATA_FOLDER</span> <span class="o">=</span> <span class="s1">'../readonly/final_project_data/'</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">transactions</span>    <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
					       <span class="s1">'sales_train.csv.gz'</span><span class="p">))</span>
<span class="n">items</span>           <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
					       <span class="s1">'items.csv'</span><span class="p">))</span>
<span class="n">item_categories</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
					       <span class="s1">'item_categories.csv'</span><span class="p">))</span>
<span class="n">shops</span>           <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
					       <span class="s1">'shops.csv'</span><span class="p">))</span>
</pre></div>

<p>
The <code>frames</code> dictionary is just a convenience thing to make printing the descriptive tables below a little easier.
</p>

<div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">transactions</span><span class="o">=</span><span class="n">transactions</span><span class="p">,</span>
	      <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
	      <span class="n">item_categories</span><span class="o">=</span><span class="n">item_categories</span><span class="p">,</span>
	      <span class="n">shops</span><span class="o">=</span><span class="n">shops</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org5ade478" class="outline-2">
<h2 id="org5ade478">Data Description</h2>
<div class="outline-text-2" id="text-org5ade478">
<p>
The dataset we loaded is taken from a kaggle competititon. You can find complete data description at the <a href="https://www.kaggle.com/c/competitive-data-science-final-project/data">competition web page</a>. To join the competition use <a href="https://www.kaggle.com/t/1ea93815dca248e99221df42ebde3540">this link</a>. The descriptions below cover all the files, not just the ones we use here.
</p>

<blockquote>
<p>
You are provided with daily historical sales data from what appears to be a software retailer, although that isn't explicitly stated. The task is to forecast the total amount of products sold in every shop for the test set. Note that the list of shops and products changes slightly every month. Creating a robust model that can handle such situations is part of the challenge.
</p>
</blockquote>
</div>

<div id="outline-container-orgd8f2c37" class="outline-3">
<h3 id="orgd8f2c37">File descriptions</h3>
<div class="outline-text-3" id="text-orgd8f2c37">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">File Name</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">sales_train.csv</td>
<td class="org-left">the training set. Daily historical data from January 2013 to October 2015.</td>
</tr>
<tr>
<td class="org-left">test.csv</td>
<td class="org-left">the test set. You need to forecast the sales for these shops and products for November 2015.</td>
</tr>
<tr>
<td class="org-left">sample_submission.csv</td>
<td class="org-left">a sample submission file in the correct format.</td>
</tr>
<tr>
<td class="org-left">items.csv</td>
<td class="org-left">supplemental information about the items/products.</td>
</tr>
<tr>
<td class="org-left">item_categories.csv</td>
<td class="org-left">supplemental information about the items categories.</td>
</tr>
<tr>
<td class="org-left">shops.csv</td>
<td class="org-left">supplemental information about the shops.</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgd123c34" class="outline-3">
<h3 id="orgd123c34">Data Fields</h3>
<div class="outline-text-3" id="text-orgd123c34">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Column</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">ID</td>
<td class="org-left">an Id that represents a (Shop, Item) tuple within the test set</td>
</tr>
<tr>
<td class="org-left">shop_id</td>
<td class="org-left">unique identifier of a shop</td>
</tr>
<tr>
<td class="org-left">item_id</td>
<td class="org-left">unique identifier of a product</td>
</tr>
<tr>
<td class="org-left">item_category_id</td>
<td class="org-left">unique identifier of item category</td>
</tr>
<tr>
<td class="org-left">item_cnt_day</td>
<td class="org-left">number of products sold. You are predicting a monthly amount of this measure</td>
</tr>
<tr>
<td class="org-left">item_price</td>
<td class="org-left">current price of an item</td>
</tr>
<tr>
<td class="org-left">date</td>
<td class="org-left">date in format dd/mm/yyyy</td>
</tr>
<tr>
<td class="org-left">date_block_num</td>
<td class="org-left">a consecutive month number, used for convenience. January 2013 is 0, February 2013 is 1,…, October 2015 is 33</td>
</tr>
<tr>
<td class="org-left">item_name</td>
<td class="org-left">name of item</td>
</tr>
<tr>
<td class="org-left">shop_name</td>
<td class="org-left">name of shop</td>
</tr>
<tr>
<td class="org-left">item_category_name</td>
<td class="org-left">name of item category</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgf474240" class="outline-2">
<h2 id="orgf474240">A Warm Up</h2>
<div class="outline-text-2" id="text-orgf474240">
<p>
Let's start with a simple task. 
</p>

<p>
Print the shape of the loaded dataframes and use the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.head.html"><code>df.head</code></a> function to print several rows. Examine the features you are given.
</p>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"| DataFrame | Rows| Columns|"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"|-+-+-|"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"|{}| {}|{}|"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">DataFrame</th>
<th scope="col" class="org-right">Rows</th>
<th scope="col" class="org-right">Columns</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">transactions</td>
<td class="org-right">2935849</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">items</td>
<td class="org-right">22170</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">item_categories</td>
<td class="org-right">84</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">shops</td>
<td class="org-right">60</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"** {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
</pre></div>
</div>
<div id="outline-container-orgdba352f" class="outline-3">
<h3 id="orgdba352f">transactions</h3>
<div class="outline-text-3" id="text-orgdba352f">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orge102f77" class="outline-3">
<h3 id="orge102f77">items</h3>
<div class="outline-text-3" id="text-orge102f77">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_name</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">! ВО ВЛАСТИ НАВАЖДЕНИЯ (ПЛАСТ.)         D</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">!ABBYY FineReader 12 Professional Edition Full [PC, Цифровая версия]</td>
<td class="org-right">1</td>
<td class="org-right">76</td>
</tr>
<tr>
<td class="org-left">***В ЛУЧАХ СЛАВЫ   (UNV)                    D</td>
<td class="org-right">2</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***ГОЛУБАЯ ВОЛНА  (Univ)                      D</td>
<td class="org-right">3</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">***КОРОБКА (СТЕКЛО)                       D</td>
<td class="org-right">4</td>
<td class="org-right">40</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org1775ea5" class="outline-3">
<h3 id="org1775ea5">item_categories</h3>
<div class="outline-text-3" id="text-org1775ea5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">item_category_name</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">PC - Гарнитуры/Наушники</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PS4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Аксессуары - PSP</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgd395f4c" class="outline-3">
<h3 id="orgd395f4c">shops</h3>
<div class="outline-text-3" id="text-orgd395f4c">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">shop_name</th>
<th scope="col" class="org-right">shop_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">!Якутск Орджоникидзе, 56 фран</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">!Якутск ТЦ "Центральный" фран</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Адыгея ТЦ "Мега"</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Балашиха ТРК "Октябрь-Киномир"</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">Волжский ТЦ "Волга Молл"</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>
Unexpectedly, the names are all in <a href="https://en.wikipedia.org/wiki/Cyrillic_script">cyrillic</a>, so I guess this will be a black-box in more ways than is usual
</p>
</div>
</div>
</div>

<div id="outline-container-org8a18f8b" class="outline-2">
<h2 id="org8a18f8b">Questions</h2>
<div class="outline-text-2" id="text-org8a18f8b">
</div>
<div id="outline-container-org91d7be2" class="outline-3">
<h3 id="org91d7be2">Question 1: <b>What was the maximum total revenue among all the shops in September, 2014?</b>
</h3>
<div class="outline-text-3" id="text-org91d7be2">
<p>
From here on out <b>revenue</b> refers to total sales minus value of goods returned.
</p>

<ul class="org-ul">
<li>Sometimes items are returned, find such examples in the dataset.</li>
<li>It is handy to split `date` field into [`day`, `month`, `year`] components and use ` df.year <code>= 14` and `df.month =</code> 9` in order to select target subset of dates.</li>
<li>You may work with `date` feature as with srings, or you may first convert it to ` pd.datetime` type with `pd.to_datetime` function, but do not forget to set correct <code>format</code> argument.</li>
</ul>
</div>

<div id="outline-container-orgb783586" class="outline-4">
<h4 id="orgb783586">Answer</h4>
<div class="outline-text-4" id="text-orgb783586">
</div>
<ul class="org-ul">
<li>
<a id="orge59bac5"></a>Sales Per Item<br><div class="outline-text-5" id="text-orge59bac5">
<p>
First I'll add a column with the total revenue for each item (the \(price \times \textit{number sold}\)).
</p>

<div class="highlight"><pre><span></span><span class="n">transactions</span><span class="p">[</span><span class="s2">"item_revenue"</span><span class="p">]</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">item_price</span> <span class="o">*</span> <span class="n">transactions</span><span class="o">.</span><span class="n">item_cnt_day</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left"> </th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_revenue</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">count</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">2.93585e+06</td>
<td class="org-right">2.93585e+06</td>
</tr>
<tr>
<td class="org-left">mean</td>
<td class="org-right">14.5699</td>
<td class="org-right">33.0017</td>
<td class="org-right">10197.2</td>
<td class="org-right">890.853</td>
<td class="org-right">1.24264</td>
<td class="org-right">1157.73</td>
</tr>
<tr>
<td class="org-left">std</td>
<td class="org-right">9.42299</td>
<td class="org-right">16.227</td>
<td class="org-right">6324.3</td>
<td class="org-right">1729.8</td>
<td class="org-right">2.61883</td>
<td class="org-right">5683.6</td>
</tr>
<tr>
<td class="org-left">min</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-22</td>
<td class="org-right">-68970</td>
</tr>
<tr>
<td class="org-left">25%</td>
<td class="org-right">7</td>
<td class="org-right">22</td>
<td class="org-right">4476</td>
<td class="org-right">249</td>
<td class="org-right">1</td>
<td class="org-right">249</td>
</tr>
<tr>
<td class="org-left">50%</td>
<td class="org-right">14</td>
<td class="org-right">31</td>
<td class="org-right">9343</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">449</td>
</tr>
<tr>
<td class="org-left">75%</td>
<td class="org-right">23</td>
<td class="org-right">47</td>
<td class="org-right">15684</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
<td class="org-right">1078.2</td>
</tr>
<tr>
<td class="org-left">max</td>
<td class="org-right">33</td>
<td class="org-right">59</td>
<td class="org-right">22169</td>
<td class="org-right">307980</td>
<td class="org-right">2169</td>
<td class="org-right">1.82999e+06</td>
</tr>
</tbody>
</table>
</div>
</li>


<li>
<a id="org63df0a8"></a>Filter Out the Month<br><div class="outline-text-5" id="text-org63df0a8">
<p>
I was originally filtering using a regular expression, but the other questions use date-filtering too so I decided to create the extra day, month, and year columns once to avoid the extra regular expression overhead later on. The <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.str.extract.html"><code>str.extract</code></a> method uses python regular expression groups to pull out values and create columns in a DataFrame. If you use named expressions (as I do here) then it will use the names as the column-names in the dataframe.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Dates</span><span class="p">:</span>
    <span class="n">date_expression</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'(?P&lt;day&gt;\d{2})\.(?P&lt;month&gt;\d{2})\.(?P&lt;year&gt;\d{4})'</span>
    <span class="n">september</span> <span class="o">=</span> <span class="s1">'09'</span>
    <span class="n">december</span> <span class="o">=</span> <span class="s1">'12'</span>
    <span class="n">summer</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'06'</span><span class="p">,</span> <span class="s1">'07'</span><span class="p">,</span> <span class="s1">'08'</span><span class="p">]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">dates</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">Dates</span><span class="o">.</span><span class="n">date_expression</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">dates</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="s1">'never'</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">'orgtbl'</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">03</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">05</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">06</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">15</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
<p>
Now we can smash our new data frame onto the transactions using the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.concat.html">concat</a> function. by default it will try to add the rows from the second data frame to the rows of the first, but since we're adding new columns we need to pass in the <code>axis='columns'</code> argument.
</p>

<div class="highlight"><pre><span></span><span class="n">transactions</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">transactions</span><span class="p">,</span> <span class="n">dates</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="s1">'columns'</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">transactions</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="s2">"never"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_revenue</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">02.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">59</td>
<td class="org-right">22154</td>
<td class="org-right">999</td>
<td class="org-right">1</td>
<td class="org-right">999</td>
<td class="org-right">02</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">03.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
<td class="org-right">899</td>
<td class="org-right">03</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">05.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2552</td>
<td class="org-right">899</td>
<td class="org-right">-1</td>
<td class="org-right">-899</td>
<td class="org-right">05</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">06.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2554</td>
<td class="org-right">1709.05</td>
<td class="org-right">1</td>
<td class="org-right">1709.05</td>
<td class="org-right">06</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
<tr>
<td class="org-right">15.01.2013</td>
<td class="org-right">0</td>
<td class="org-right">25</td>
<td class="org-right">2555</td>
<td class="org-right">1099</td>
<td class="org-right">1</td>
<td class="org-right">1099</td>
<td class="org-right">15</td>
<td class="org-right">01</td>
<td class="org-right">2013</td>
</tr>
</tbody>
</table>
<p>
first, as a sanity check, we'll make sure that all the date cells have values.
</p>

<div class="highlight"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">transactions</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">hasnans</span>
</pre></div>

<p>
now let's filter on the date-expression we created for september. the next <i>Question</i> also uses 2014 so I'll preserve that as a separate sub-set.
</p>

<div class="highlight"><pre><span></span><span class="n">twenty_fourteen</span> <span class="o">=</span> <span class="n">transactions</span><span class="p">[</span><span class="n">transactions</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">"2014"</span><span class="p">])]</span>
<span class="n">september</span> <span class="o">=</span> <span class="n">twenty_fourteen</span><span class="p">[</span><span class="n">twenty_fourteen</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">Dates</span><span class="o">.</span><span class="n">september</span><span class="p">])]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">september</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right"> </th>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_revenue</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">1953691</td>
<td class="org-right">24.09.2014</td>
<td class="org-right">20</td>
<td class="org-right">5</td>
<td class="org-right">1039</td>
<td class="org-right">899</td>
<td class="org-right">1</td>
<td class="org-right">899</td>
<td class="org-right">24</td>
<td class="org-right">09</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">1953692</td>
<td class="org-right">27.09.2014</td>
<td class="org-right">20</td>
<td class="org-right">5</td>
<td class="org-right">1015</td>
<td class="org-right">449</td>
<td class="org-right">1</td>
<td class="org-right">449</td>
<td class="org-right">27</td>
<td class="org-right">09</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">1953693</td>
<td class="org-right">07.09.2014</td>
<td class="org-right">20</td>
<td class="org-right">5</td>
<td class="org-right">1329</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">07</td>
<td class="org-right">09</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">1953694</td>
<td class="org-right">27.09.2014</td>
<td class="org-right">20</td>
<td class="org-right">5</td>
<td class="org-right">984</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">27</td>
<td class="org-right">09</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">1953695</td>
<td class="org-right">08.09.2014</td>
<td class="org-right">20</td>
<td class="org-right">5</td>
<td class="org-right">984</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">08</td>
<td class="org-right">09</td>
<td class="org-right">2014</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">twenty_fourteen</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="s2">"2014"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">september</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="s2">"09"</span><span class="p">)</span>
</pre></div>

<p>
That seems like a lot of transactions. What fraction of the total is it?
</p>

<div class="highlight"><pre><span></span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">september</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"{:.2f} %"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">rows</span><span class="o">/</span><span class="n">transactions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>

<p>
2.49 %
</p>

<p>
Not as much as I would have thought, <code>transactions</code> is much larger than I first took it to be.
</p>

<div class="highlight"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">september</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"shop_id"</span><span class="p">])</span>
<span class="n">summed</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">item_revenue</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">summed</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

<pre class="example">
shop_id
2    1473540.00
3    1228425.00
4    1211556.00
5    1350828.02
6    3480397.00
Name: item_revenue, dtype: float64

</pre>

<div class="highlight"><pre><span></span><span class="n">max_revenue</span> <span class="o">=</span> <span class="n">summed</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">summed</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Highest Revenue Earned by a shop in September of 2014: $ {:,.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_revenue</span><span class="p">))</span>
</pre></div>

<p>
Highest Revenue Earned by a shop in September of 2014: $ 7,982,852.20
</p>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org79e58e8" class="outline-3">
<h3 id="org79e58e8">Question 2: <b>What item category generated the highest revenue in the Summer of 2014?</b>
</h3>
<div class="outline-text-3" id="text-org79e58e8">
<ul class="org-ul">
<li>Submit the <code>id</code> of the category found.</li>
<li>Here we call "summer" the period from June to August.</li>
</ul>
<p>
<b>Hints:</b>
</p>

<p>
Note, that for an object `x` of type `pd.Series`: `x.argmax()` returns <b><b>index</b></b> of the maximum element. `pd.Series` can have non-trivial index (not `[1, 2, 3, … ]`).
</p>
</div>
<div id="outline-container-orgc158e04" class="outline-4">
<h4 id="orgc158e04">Get the Summer months</h4>
<div class="outline-text-4" id="text-orgc158e04">
<p>
To filter what we want I'll use the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.isin.html"><code>isin</code></a> method to remove every row that has a value that isn't in <code>Dates.summer</code>.
</p>
<div class="highlight"><pre><span></span><span class="n">summer</span> <span class="o">=</span> <span class="n">twenty_fourteen</span><span class="p">[</span><span class="n">twenty_fourteen</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">Dates</span><span class="o">.</span><span class="n">summer</span><span class="p">)]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">'orgtbl'</span><span class="p">))</span>
<span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">summer</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">Dates</span><span class="o">.</span><span class="n">summer</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right"> </th>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_revenue</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">1705909</td>
<td class="org-right">15.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9532</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">15</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">30</td>
</tr>
<tr>
<td class="org-right">1705910</td>
<td class="org-right">10.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9507</td>
<td class="org-right">149</td>
<td class="org-right">1</td>
<td class="org-right">149</td>
<td class="org-right">10</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-right">1705911</td>
<td class="org-right">13.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9509</td>
<td class="org-right">246.32</td>
<td class="org-right">1</td>
<td class="org-right">246.32</td>
<td class="org-right">13</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">37</td>
</tr>
<tr>
<td class="org-right">1705912</td>
<td class="org-right">03.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9532</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">03</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">30</td>
</tr>
<tr>
<td class="org-right">1705913</td>
<td class="org-right">08.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9532</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">08</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">30</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org707817f" class="outline-4">
<h4 id="org707817f">Map in the Category IDs</h4>
<div class="outline-text-4" id="text-org707817f">
<p>
If you look at <code>items.item_id</code> you can see that the id's are really just the numerical index to the <code>items.item_category_id</code> series. I was originally add the category ids for all the transactions but it takes a long time so I'm just adding it to this group.
</p>

<div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">item_id</span> <span class="o">==</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)))</span>
</pre></div>

<p>
So we can map them back into our summer transactions.
</p>

<div class="highlight"><pre><span></span><span class="n">summer</span><span class="p">[</span><span class="s2">"item_category_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">summer</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item</span><span class="p">,</span> <span class="s1">'item_category_id'</span><span class="p">])</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="s1">'keys'</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right"> </th>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_revenue</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">item_category_id</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">1705909</td>
<td class="org-right">15.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9532</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">15</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">30</td>
</tr>
<tr>
<td class="org-right">1705910</td>
<td class="org-right">10.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9507</td>
<td class="org-right">149</td>
<td class="org-right">1</td>
<td class="org-right">149</td>
<td class="org-right">10</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-right">1705911</td>
<td class="org-right">13.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9509</td>
<td class="org-right">246.32</td>
<td class="org-right">1</td>
<td class="org-right">246.32</td>
<td class="org-right">13</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">37</td>
</tr>
<tr>
<td class="org-right">1705912</td>
<td class="org-right">03.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9532</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">03</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">30</td>
</tr>
<tr>
<td class="org-right">1705913</td>
<td class="org-right">08.06.2014</td>
<td class="org-right">17</td>
<td class="org-right">26</td>
<td class="org-right">9532</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">08</td>
<td class="org-right">06</td>
<td class="org-right">2014</td>
<td class="org-right">30</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="n">categories</span> <span class="o">=</span> <span class="n">summer</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"item_category_id"</span><span class="p">])</span>
<span class="n">categories_summed</span> <span class="o">=</span> <span class="n">categories</span><span class="o">.</span><span class="n">item_revenue</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">categories_summed</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

<pre class="example">
item_category_id
2    2755520.0
3    6854669.8
4      38833.2
5     418233.1
6    3360382.5
Name: item_revenue, dtype: float64

</pre>

<div class="highlight"><pre><span></span><span class="n">category_id_with_max_revenue</span> <span class="o">=</span> <span class="n">categories_summed</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"Category Id with the Maximum Value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">category_id_with_max_revenue</span><span class="p">))</span>
</pre></div>

<p>
Category Id with the Maximum Value: 20
</p>
</div>
</div>
</div>

<div id="outline-container-orgf281da6" class="outline-3">
<h3 id="orgf281da6">Question 3: <b>How many items have the same price throughout the data set?</b>
</h3>
<div class="outline-text-3" id="text-orgf281da6">
<p>
How many items are there, such that their price stays constant (to the best of our knowledge) during the whole period of time?
</p>

<p>
Let's assume, that the items are returned for the same price as they had been sold.
</p>
</div>

<div id="outline-container-orgbb20b94" class="outline-4">
<h4 id="orgbb20b94">Isolate the ID and Price</h4>
<div class="outline-text-4" id="text-orgbb20b94">
<div class="highlight"><pre><span></span><span class="n">id_price</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">"item_id"</span><span class="p">,</span> <span class="s2">"item_price"</span><span class="p">]]</span>
<span class="n">id_price</span><span class="p">[</span><span class="s2">"item_price"</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_price</span><span class="o">.</span><span class="n">item_price</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">id_price</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"item_id"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">item_price</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="n">constant_prices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">constant_prices</span> <span class="o">==</span> <span class="n">Confirmed</span><span class="o">.</span><span class="n">number_of_items_whose_price_didnt_change</span>
<span class="k">print</span><span class="p">(</span><span class="n">constant_prices</span><span class="p">)</span>
</pre></div>

<p>
5926
</p>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"Number of items whose price didn't change: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">constant_prices</span><span class="p">))</span>
</pre></div>

<p>
Number of items whose price didn't change: 5926
</p>
</div>
</div>
</div>

<div id="outline-container-org61e053f" class="outline-3">
<h3 id="org61e053f">Question 4: <b>What was the variance of the number of items sold per day for shop 25 in December, 2014?</b>
</h3>
<div class="outline-text-3" id="text-org61e053f">
<p>
Remember, the data can sometimes be noisy.
Do not count the items, that were sold but returned back later.
</p>

<ul class="org-ul">
<li>Fill <code>total_num_items_sold</code> and <code>days</code> arrays, and plot the sequence with the code below.</li>
<li>Then compute variance. Remember, there can be differences in how you normalize variance (biased or unbiased estimate, see <a href="https://math.stackexchange.com/questions/496627/the-difference-between-unbiased-biased-estimator-variance">this Stack Overflow post</a>). Compute the <b><b><b>unbiased</b></b></b> estimate (use the right value for <code>ddof</code> argument in <code>pd.var</code> or <code>np.var</code>).</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">shop_id</span> <span class="o">=</span> <span class="mi">25</span>
</pre></div>
</div>

<div id="outline-container-orgfb1544b" class="outline-4">
<h4 id="orgfb1544b">Filter to the Shop and Dates</h4>
<div class="outline-text-4" id="text-orgfb1544b">
<div class="highlight"><pre><span></span><span class="n">twenty_fives</span> <span class="o">=</span> <span class="n">twenty_fourteen</span><span class="p">[(</span><span class="n">transactions</span><span class="o">.</span><span class="n">shop_id</span><span class="o">==</span><span class="n">shop_id</span><span class="p">)</span>
				<span class="o">&amp;</span> <span class="p">(</span><span class="n">transactions</span><span class="o">.</span><span class="n">month</span><span class="o">==</span><span class="n">Dates</span><span class="o">.</span><span class="n">december</span><span class="p">)]</span>
<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">twenty_fives</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="s1">'keys'</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">'orgtbl'</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">twenty_fives</span><span class="o">.</span><span class="n">shop_id</span> <span class="o">==</span> <span class="n">shop_id</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right"> </th>
<th scope="col" class="org-right">date</th>
<th scope="col" class="org-right">date_block_num</th>
<th scope="col" class="org-right">shop_id</th>
<th scope="col" class="org-right">item_id</th>
<th scope="col" class="org-right">item_price</th>
<th scope="col" class="org-right">item_cnt_day</th>
<th scope="col" class="org-right">item_revenue</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">year</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2295837</td>
<td class="org-right">14.12.2014</td>
<td class="org-right">23</td>
<td class="org-right">25</td>
<td class="org-right">21752</td>
<td class="org-right">399</td>
<td class="org-right">1</td>
<td class="org-right">399</td>
<td class="org-right">14</td>
<td class="org-right">12</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">2295838</td>
<td class="org-right">13.12.2014</td>
<td class="org-right">23</td>
<td class="org-right">25</td>
<td class="org-right">21752</td>
<td class="org-right">399</td>
<td class="org-right">3</td>
<td class="org-right">1197</td>
<td class="org-right">13</td>
<td class="org-right">12</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">2295839</td>
<td class="org-right">26.12.2014</td>
<td class="org-right">23</td>
<td class="org-right">25</td>
<td class="org-right">21733</td>
<td class="org-right">149</td>
<td class="org-right">1</td>
<td class="org-right">149</td>
<td class="org-right">26</td>
<td class="org-right">12</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">2295840</td>
<td class="org-right">31.12.2014</td>
<td class="org-right">23</td>
<td class="org-right">25</td>
<td class="org-right">21732</td>
<td class="org-right">149</td>
<td class="org-right">1</td>
<td class="org-right">149</td>
<td class="org-right">31</td>
<td class="org-right">12</td>
<td class="org-right">2014</td>
</tr>
<tr>
<td class="org-right">2295841</td>
<td class="org-right">30.12.2014</td>
<td class="org-right">23</td>
<td class="org-right">25</td>
<td class="org-right">21726</td>
<td class="org-right">149</td>
<td class="org-right">1</td>
<td class="org-right">149</td>
<td class="org-right">30</td>
<td class="org-right">12</td>
<td class="org-right">2014</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orga85c1c4" class="outline-4">
<h4 id="orga85c1c4">Group by date</h4>
<div class="outline-text-4" id="text-orga85c1c4">
<div class="highlight"><pre><span></span><span class="n">shop_grouped</span> <span class="o">=</span> <span class="n">twenty_fives</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"date"</span><span class="p">)</span>
<span class="n">count_per_day</span> <span class="o">=</span> <span class="n">shop_grouped</span><span class="o">.</span><span class="n">item_cnt_day</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">count_per_day</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

<pre class="example">
date
01.12.2014    153.0
02.12.2014    169.0
03.12.2014    195.0
04.12.2014    164.0
05.12.2014    300.0
Name: item_cnt_day, dtype: float64

</pre>
</div>
</div>

<div id="outline-container-org9413ad7" class="outline-4">
<h4 id="org9413ad7">Add a date-time to make it sortable for print</h4>
<div class="outline-text-4" id="text-org9413ad7">
<div class="highlight"><pre><span></span><span class="n">pandas</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">count_per_day</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">count_per_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"</span><span class="si">%d</span><span class="s2">.%m.%Y"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">count_per_day</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

<pre class="example">
date
2014-12-01    153.0
2014-12-02    169.0
2014-12-03    195.0
2014-12-04    164.0
2014-12-05    300.0
Name: item_cnt_day, dtype: float64

</pre>


<div class="highlight"><pre><span></span><span class="n">figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">count_per_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">count_per_day</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Num items'</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Day'</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">count_per_day</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">count_per_day</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Daily revenue for shop_id = 25"</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/files/posts/pandas-basics/items_per_day.png" alt="items_per_day.png"></p>
</div>


<div class="figure">
<p><img src="posts/pandas-basics/items_per_day.png" alt="items_per_day.png"></p>
</div>

<div class="highlight"><pre><span></span><span class="c1"># pandas uses 1/n-1 by default, numpy uses 1/n</span>
<span class="n">total_num_items_sold_var</span> <span class="o">=</span> <span class="n">count_per_day</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Variance for items sold per day: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_num_items_sold_var</span><span class="p">))</span>
</pre></div>

<p>
Variance for items sold per day: 117167.70229885059
</p>
</div>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/" class="u-url">Will a GBDT's performance drop if we remove the first tree?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/" rel="bookmark"><time class="published dt-published" datetime="2018-08-04T19:02:32-07:00" title="2018-08-04 19:02">2018-08-04 19:02</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/#orgaa1041c">Define the Sigmoid</a></li>
<li><a href="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/#orgadc9caa">Make the dataset</a></li>
<li><a href="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/#org3838d1c">A Decision Tree Classifier</a></li>
<li><a href="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/#org9230eaf">A Gradient Boosting Classifier</a></li>
<li><a href="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/#orgb1d899d">A More Realistic Data Set</a></li>
<li><a href="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/#orgf80a937">Source</a></li>
</ul>
</div>
</div>

<p>
We'll look at how <a href="http://blog.kaggle.com/2017/01/23/a-kaggle-master-explains-gradient-boosting/"><b>Gradient Boosting</b></a> works and  answer the question:
</p>

<blockquote>
<p>
Will the performance of a  GBDT model drop dramatically if we remove the first tree?
</p>
</blockquote>

<div class="highlight"><pre><span></span><span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">seaborn</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">log_loss</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_hastie_10_2</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
</pre></div>

<div id="outline-container-orgaa1041c" class="outline-2">
<h2 id="orgaa1041c">Define the Sigmoid</h2>
<div class="outline-text-2" id="text-orgaa1041c">
<p>
This is a function to calculate the <a href="https://en.wikipedia.org/wiki/Sigmoid_function">sigmoid</a> which we'll use to convert probabilities to classifications.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgadc9caa" class="outline-2">
<h2 id="orgadc9caa">Make the dataset</h2>
<div class="outline-text-2" id="text-orgadc9caa">
<p>
This will be a very simple synthetic dataset. We'll use numpy's <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.randn.html">randn</a> function to generate a dataset of random values that come from a normal distribution and then predict that the class is <i>1</i> if the value is positive and that it is <i>0</i> otherwise.
</p>
</div>

<div id="outline-container-orgaa034a9" class="outline-3">
<h3 id="orgaa034a9">Generating the Random Data</h3>
<div class="outline-text-3" id="text-orgaa034a9">
<p>
First we'll generate an array of 5000 random numbers taken from a normal distribution.
</p>

<div class="highlight"><pre><span></span><span class="n">X_all</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

<p>
Next we'll create a target array which will have 1's for all non-negative numbers and 0's otherwise.
</p>

<div class="highlight"><pre><span></span><span class="n">y_all</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_all</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>

<p>
Now we'll use sklearn's <a href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html">train_test_split</a> function to create the training and testing data, with half the data using for training and half for testing.
</p>

<div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_all</span><span class="p">,</span> <span class="n">y_all</span><span class="p">,</span>
						    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
						    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org3838d1c" class="outline-2">
<h2 id="org3838d1c">A Decision Tree Classifier</h2>
<div class="outline-text-2" id="text-org3838d1c">
<p>
We'll build a <a href="https://en.wikipedia.org/wiki/Decision_tree">Decision Tree</a> using sklearn's <a href="http://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html">Decision Tree Classifier</a> for this model.
</p>
</div>

<div id="outline-container-orge40b432" class="outline-3">
<h3 id="orge40b432">Building and Training the Model</h3>
<div class="outline-text-3" id="text-orge40b432">
<p>
This will be a very simple tree with a depth of 1 (a <a href="https://en.wikipedia.org/wiki/Decision_stump">decision stump</a>).
</p>

<div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3159d01" class="outline-3">
<h3 id="org3159d01">Measuring the Accuracy</h3>
<div class="outline-text-3" id="text-org3159d01">
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">'Accuracy for a single decision stump: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>

<p>
Accuracy for a single decision stump: 1.0
</p>


<p>
The 'tree' was able to classify all the testing data correctly.
</p>
</div>
</div>
</div>

<div id="outline-container-org9230eaf" class="outline-2">
<h2 id="org9230eaf">A Gradient Boosting Classifier</h2>
<div class="outline-text-2" id="text-org9230eaf">
<p>
While the Decision Tree Classifier only needed 1 layer, We will need 800 trees in the Gradient Boosting Classifier for it to classify the data correctly.
</p>

<p>
For convenience we will use sklearn's <a href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html">GradientBoostingClassifier</a>, the situation will be similar if you use <a href="https://xgboost.readthedocs.io/en/latest/">XGBoost</a> or other Gradient Boosting implementations.
</p>
</div>

<div id="outline-container-org52c039c" class="outline-3">
<h3 id="org52c039c">Training and Fitting the Model</h3>
<div class="outline-text-3" id="text-org52c039c">
<div class="highlight"><pre><span></span><span class="n">gbc_model</span> <span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
				 <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
				 <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">gbc_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">'Accuracy for Gradient Booing: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gbc_model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>

<p>
Accuracy for Gradient Booing: 1.0
</p>
</div>
</div>

<div id="outline-container-org68e96a9" class="outline-3">
<h3 id="org68e96a9">Checking the log Loss Metric</h3>
<div class="outline-text-3" id="text-org68e96a9">
<p>
The <a href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html#sklearn.ensemble.GradientBoostingClassifier.predict_proba"><code>predict_proba</code></a> method will give us the probabilities that a data-point belongs to a class.
</p>

<div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">gbc_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>

<p>
We'll use <a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.log_loss.html">log loss</a> as our metric to see how the model did.
</p>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"Test logloss: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_loss</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
</pre></div>

<p>
Test logloss: 0.0003138777469167194
</p>
</div>
</div>

<div id="outline-container-org9d44ec5" class="outline-3">
<h3 id="org9d44ec5">Some Helper Functions</h3>
<div class="outline-text-3" id="text-org9d44ec5">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_loss</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">predicted_probabilities</span><span class="p">):</span>
    <span class="sd">"""applies sigmoid to predictions before calling log_loss</span>

<span class="sd">    Args:</span>
<span class="sd">     y_true: the actual classifications</span>
<span class="sd">     predicted_probabilities: probabilities that class was 1</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">log_loss</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">predicted_probabilities</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_loss</span><span class="p">(</span><span class="n">cumulative_predictions</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="sd">"""prints the log-loss for the predictions</span>

<span class="sd">    Args:</span>
<span class="sd">     cumulative_predictions (numpy.Array): The cumulative predictions for the model</span>
<span class="sd">    """</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">" - Logloss using all trees:           {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
	<span class="n">compute_loss</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">cumulative_predictions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">" - Logloss using all trees but last:  {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
	<span class="n">compute_loss</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">cumulative_predictions</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">" - Logloss using all trees but first: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
	<span class="n">compute_loss</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">cumulative_predictions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">cumulative_predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga09a0e8" class="outline-3">
<h3 id="orga09a0e8">Checking The loss</h3>
<div class="outline-text-3" id="text-orga09a0e8">
<p>
Now we get the cummulative sum of the <b>decision function</b> (<a href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html#sklearn.ensemble.GradientBoostingClassifier.staged_decision_function"><code>staged_decision_function</code></a>) for our trees. The <i>i</i>-th element is a sum of trees \[0 \ldots i-1\]. We cannot use <a href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html#sklearn.ensemble.GradientBoostingClassifier.staged_predict_proba">staged_predict_proba</a>, since we want to maniputate raw scores
(not probabilities). And only in the end convert the scores to probabilities using the <code>sigmoid</code>.
</p>

<div class="highlight"><pre><span></span><span class="n">gbc_cumulative_predictions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gbc_model</span><span class="o">.</span><span class="n">staged_decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)])[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> 
</pre></div>

<p>
Here we'll use the <code>compute_loss</code> function that we defined above to find the log loss with and without some trees.
</p>

<div class="highlight"><pre><span></span><span class="n">print_loss</span><span class="p">(</span><span class="n">gbc_cumulative_predictions</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>

<ul class="org-ul">
<li>Logloss using all trees:           0.0003138777469167194</li>
<li>Logloss using all trees but last:  0.0003138777469168316</li>
<li>Logloss using all trees but first: 0.0003202438533122706</li>
</ul>
<p>
You can see that when you remove the first tree there is a difference, but not as much as you might expect. Of particular note is that if we get rid of the last tree the model performs the same as is does with it. 
</p>

<p>
Let's take a look at the plot of the cummulative decision function with differing numbers of trees. We'll plot the Cumulative Decision Score when predicting the classification of 1 as the number of stages (trees?) increases.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_predictions</span><span class="p">(</span><span class="n">cumulative_predictions</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
    <span class="sd">"""plots the cumulative predictions</span>

<span class="sd">    Args:</span>
<span class="sd">     identifier (str): something to identify the model</span>
<span class="sd">     cumulative_predictions: predictions from trees</span>
<span class="sd">    """</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cumulative_predictions</span><span class="p">[:,</span> <span class="n">y_test</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"({}) Score vs Trees"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Number of Trees'</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Cumulative Decision Score'</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">plot_predictions</span><span class="p">(</span><span class="n">gbc_cumulative_predictions</span><span class="p">,</span> <span class="s2">"eta=0.01"</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/cumulative_plot.png" alt=" cumulative_plot.png"></p>
</div>


<p>
You can see that the decision function improves almost linearly until about the 800th iteration and then the improvement stops. The slope of this line is connected to the learning rate, which we set in the Gradient Boosting machine.
</p>

<p>
If you remember the main formula for boosting, it is written something like this:
</p>

<p>
\[ F(x) = const + \sum\limits_{i=1}^{n}\gamma_i h_i(x) \]
</p>

<p>
In our case, \(\gamma_i\) are constant and equal to the learning rate \[\eta = 0.01\] It takes about <i>800</i> iterations to get a score of <i>8</i>, which means at every iteration the score goes up about <i>0.01</i>. This means that the first 800 terms are approximately equal to <i>0.01</i>, and the rest are almost <i>0</i>. 
</p>

<p>
Which in turn means that if we drop the last tree we lower \(F(x)\) by <i>0</i> and if we drop the first tree we lower \(F(x)\) by <i>0.01</i>, which results in a very, very small performance drop. So, even in the case of a simple dataset which can be solved with a single decision stump, with a Gradient Boosting Machine we need to sum a lot of trees (roughly \(\frac{1}{\eta}\)) to approximate our golden single decision stump.
</p>
</div>

<div id="outline-container-org1b9d6bd" class="outline-4">
<h4 id="org1b9d6bd">A Bigger \(\eta\)</h4>
<div class="outline-text-4" id="text-org1b9d6bd">
<p>
To prove that last point let's try a larger learning rate of <i>8</i>.
</p>

<div class="highlight"><pre><span></span><span class="n">big_eta</span> <span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
				     <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">big_eta</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">big_eta</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Test logloss: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_loss</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
</pre></div>

<p>
Test logloss: 3.0443902682648675e-06
</p>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">'Accuracy for Big Eta: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">big_eta</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>

<p>
Accuracy for Big Eta: 1.0
</p>

<div class="highlight"><pre><span></span><span class="n">big_eta_cumulative_predictions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">big_eta</span><span class="o">.</span><span class="n">staged_decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)])[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> 
</pre></div>

<div class="highlight"><pre><span></span><span class="n">print_loss</span><span class="p">(</span><span class="n">big_eta_cumulative_predictions</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>

<ul class="org-ul">
<li>Logloss using all trees:           3.0443902682648675e-06</li>
<li>Logloss using all trees but last:  3.0836959336434695e-06</li>
<li>Logloss using all trees but first: 2.0247047109196954</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">plot_predictions</span><span class="p">(</span><span class="n">big_eta_cumulative_predictions</span><span class="p">,</span> <span class="s2">"eta=8"</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/will-a-gbdt-performance-drop-if-we-remove-the-first-tree/big_eta_plot.png" alt="big_eta_plot.png"></p>
</div>

<p>
Now we see that it is crucial to have the first tree in the ensemble, the last one maybe not so much.
</p>

<p>
Even though the dataset is synthetic, a similar intuition will work with real data, except the Gradient Boosting Machine can diverge with higher learning rates and a more complex dataset. 
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb1d899d" class="outline-2">
<h2 id="orgb1d899d">A More Realistic Data Set</h2>
<div class="outline-text-2" id="text-orgb1d899d">
<p>
Sklearn's <a href="http://scikit-learn.org/stable/modules/generated/sklearn.datasets.make_hastie_10_2.html">make_hastie_10_2</a> function makes a ten-dimensional data set with two classifications as targets.
</p>
</div>
<div id="outline-container-orga5a49ed" class="outline-3">
<h3 id="orga5a49ed">Building the Data Set</h3>
<div class="outline-text-3" id="text-orga5a49ed">
<div class="highlight"><pre><span></span><span class="n">X_hastie</span><span class="p">,</span> <span class="n">y_hastie</span> <span class="o">=</span> <span class="n">make_hastie_10_2</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_train_hastie</span><span class="p">,</span> <span class="n">X_test_hastie</span><span class="p">,</span> <span class="n">y_train_hastie</span><span class="p">,</span> <span class="n">y_test_hastie</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_hastie</span><span class="p">,</span>
    <span class="n">y_hastie</span><span class="p">,</span>
    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org962c0b2" class="outline-3">
<h3 id="org962c0b2">Our Decision Stump Again</h3>
<div class="outline-text-3" id="text-org962c0b2">
<p>
Let's try the decision stump on the new dataset.
</p>
<div class="highlight"><pre><span></span><span class="n">stump</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">stump</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_hastie</span><span class="p">,</span> <span class="n">y_train_hastie</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">'Accuracy for a single decision stump: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">stump</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_hastie</span><span class="p">,</span> <span class="n">y_test_hastie</span><span class="p">)))</span>
</pre></div>

<p>
Accuracy for a single decision stump: 0.5405
</p>

<p>
It dids't do quite so well, what about a decision tree in general?
</p>

<div class="highlight"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>
<span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_hastie</span><span class="p">,</span> <span class="n">y_train_hastie</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'Accuracy for the Decision Tree: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_hastie</span><span class="p">,</span> <span class="n">y_test_hastie</span><span class="p">)))</span>
</pre></div>

<p>
Accuracy for the Decision Tree: 0.7765
</p>

<p>
It does a little better, anyway.
</p>
</div>
</div>

<div id="outline-container-org1130326" class="outline-3">
<h3 id="org1130326">The Gradient Boosting Classifier</h3>
<div class="outline-text-3" id="text-org1130326">
<div class="highlight"><pre><span></span><span class="n">gbc2_model</span> <span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
					<span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
					<span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">gbc2_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_hastie</span><span class="p">,</span> <span class="n">y_train_hastie</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">gbc2_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test_hastie</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">'Accuracy for Gradient Boosting: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">gbc2_model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_hastie</span><span class="p">,</span> <span class="n">y_test_hastie</span><span class="p">)))</span>
</pre></div>

<p>
Accuracy for Gradient Boosting: 0.9436666666666667
</p>

<div class="highlight"><pre><span></span><span class="n">gbc2_cumulative_predictions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gbc2_model</span><span class="o">.</span><span class="n">staged_decision_function</span><span class="p">(</span><span class="n">X_test_hastie</span><span class="p">)])[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">print_loss</span><span class="p">(</span><span class="n">gbc2_cumulative_predictions</span><span class="p">,</span> <span class="n">y_test_hastie</span><span class="p">)</span>
</pre></div>

<ul class="org-ul">
<li>Logloss using all trees:           0.18059661273530772</li>
<li>Logloss using all trees but last:  0.180624604367416</li>
<li>Logloss using all trees but first: 0.18064882642423313</li>
</ul>
<p>
In this case, although there is a difference, removing the last doesn't seem to be much better than removing the first.
</p>
</div>
</div>

<div id="outline-container-org7fb9524" class="outline-3">
<h3 id="org7fb9524">XGBoost</h3>
<div class="outline-text-3" id="text-org7fb9524">
<p>
We stated earlier that the result should be the same with other implementations of Gradient Boosting so let's see what happens if we use XGBoost instead.
</p>

<div class="highlight"><pre><span></span><span class="n">xg_model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">xg_model</span><span class="p">)</span>
<span class="n">xg_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_hastie</span><span class="p">,</span> <span class="n">y_train_hastie</span><span class="p">)</span>
</pre></div>

<pre class="example">
XGBClassifier(base_score=0.5, booster='gbtree', colsample_bylevel=1,
       colsample_bytree=1, gamma=0, learning_rate=0.01, max_delta_step=0,
       max_depth=3, min_child_weight=1, missing=None, n_estimators=5000,
       n_jobs=1, nthread=None, objective='binary:logistic', random_state=0,
       reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
       silent=True, subsample=1)

</pre>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">'Accuracy for XGBoost: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xg_model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_hastie</span><span class="p">,</span> <span class="n">y_test_hastie</span><span class="p">)))</span>
</pre></div>

<p>
Accuracy for XGBoost: 0.9408333333333333
</p>

<div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">xg_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test_hastie</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">xg_cumulative_predictions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xg_model</span><span class="o">.</span><span class="n">staged_decision_function</span><span class="p">(</span><span class="n">X_test_hastie</span><span class="p">)])[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">print_loss</span><span class="p">(</span><span class="n">xg_cumulative_loss</span><span class="p">)</span>
</pre></div>

<p>
If you read the documentation for the python package for <a href="https://xgboost.readthedocs.io/en/latest/python/index.html">xgboost</a> you'll see that they didn't implement the <code>staged_decision_function</code> for the <code>XGBClassifier</code> so you can't actually run the previous block. The XGBoost classifier ran much faster than the sklearn version did, and did almost as well in accuracy.
</p>
</div>
</div>
</div>

<div id="outline-container-orgf80a937" class="outline-2">
<h2 id="orgf80a937">Source</h2>
<div class="outline-text-2" id="text-orgf80a937">
<ul class="org-ul">
<li>“Will Performance of GBDT Model Drop Dramatically If We Remove the First Tree?” Coursera. Accessed August 5, 2018. <a href="https://www.coursera.org/learn/competitive-data-science/home/welcome">https://www.coursera.org/learn/competitive-data-science/home/welcome</a>.</li>
</ul>
</div>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-1.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2018         <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
